System.register("chunks:///_virtual/AttackedHint.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r,n,s,o,a;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){r=t.cclegacy,n=t.Label,s=t._decorator,o=t.Component,a=t.Vec3}],execute:function(){var c,l,u,d,p;r._RF.push({},"04300DjBaxAc55DG9ImdLUJ","AttackedHint",void 0);const{ccclass:h,property:m}=s;t("AttackedHint",(c=h("AttackedHint"),l=m(n),c((p=e((d=class extends o{constructor(){super(...arguments),i(this,"damage",p,this),this.player=null,this.timer=0}start(){}update(t){this.timer<1?(this.timer+=t,this.node.setPosition(this.player.getPosition().add(new a(0,100*this.timer,0)))):this.node.destroy()}}).prototype,"damage",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=d))||u));r._RF.pop()}}}));

System.register("chunks:///_virtual/Box.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./BoxContent.ts","./Sound.ts","./GeneralUI.ts"],(function(t){var e,i,a,n,o,s,l,r,c,d,u,h,p,b,m,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){a=t.cclegacy,n=t.Node,o=t.Prefab,s=t.Label,l=t.SpriteFrame,r=t._decorator,c=t.Component,d=t.director,u=t.instantiate,h=t.color},function(t){p=t.Manager},function(t){b=t.BoxContent},function(t){m=t.Sound},function(t){f=t.GeneralUI}],execute:function(){var g,y,D,N,x,S,C,v,B,L,A,F,z,w,I,P,M;a._RF.push({},"de4ddI+l85D0KnrS5OS7/+Q","Box",void 0);const{ccclass:U,property:_}=r;t("Box",(g=U("Box"),y=_(f),D=_(n),N=_(o),x=_(n),S=_(s),C=_(s),v=_([l]),g((A=e((L=class extends c{constructor(){super(...arguments),i(this,"generalUI",A,this),i(this,"contentNode",F,this),i(this,"boxContentPrefab",z,this),i(this,"selectAllNode",w,this),i(this,"coinNumLabel",I,this),i(this,"diamondNumLabel",P,this),i(this,"spriteFrames",M,this),this.boxContents=[],this.totalCoins=0,this.totalDiamonds=0}start(){m.instance.moveAudio.stop(),m.instance.stayAudio.stop(),m.instance.boostAudio.stop(),d.preloadScene("Menu"),this.initBox()}updateDataDisplay(){this.generalUI.updateDisplay()}initBox(){this.updateDataDisplay();for(let t=0;t<p.boxData.data.length;t++){let e=u(this.boxContentPrefab),i=p.boxData.data[t],a=e.getComponent(b);for(let t=0;t<p.fishBaseData.data.length;t++)i.fishNameEn==p.fishBaseData.data[t].fishNameEn&&(a.sprite.spriteFrame=this.spriteFrames[t]);for(let t=0;t<p.rarityBaseData.data.length;t++)i.rarity==p.rarityBaseData.data[t].rarity&&(a.rarityLabel.string=p.rarityBaseData.data[t].rarity,a.rarityLabel.outlineColor=h(p.rarityBaseData.data[t].color),a.rarityLabel.node.setScale(p.rarityBaseData.data[t].size,p.rarityBaseData.data[t].size,1));a.box=this,a.identifier=i.identifiers,a.fishNameLabel.string=i.fishNameEn.toString(),a.weightNumLabel.string=i.weight.toFixed(2),a.priceNumLabel.string=i.price.toString(),"diamonds"==i.type?(a.diamondSprite.active=!0,a.goldSprite.active=!1,a.diamond=i.price):(a.diamondSprite.active=!1,a.goldSprite.active=!0,a.coin=i.price),this.boxContents.push(a),this.contentNode.addChild(e)}}select(t){m.instance.buttonAudio.play(),1==t.selecting?(t.selecting=!1,t.selectNode.active=!1,this.updateSellNum(-t.coin,-t.diamond),this.selectAllNode.active=!1):(t.selecting=!0,t.selectNode.active=!0,this.updateSellNum(t.coin,t.diamond))}selectAll(){if(m.instance.buttonAudio.play(),1==this.selectAllNode.active){this.selectAllNode.active=!1;for(const t of this.boxContents)t.selecting=!1,t.selectNode.active=!1,this.updateSellNum(-t.coin,-t.diamond)}else{this.selectAllNode.active=!0;for(const t of this.boxContents)t.selecting=!0,t.selectNode.active=!0,this.updateSellNum(t.coin,t.diamond)}}updateSellNum(t,e){this.totalCoins+=t,this.coinNumLabel.string="+"+this.totalCoins.toString(),this.totalDiamonds+=e,this.diamondNumLabel.string="+"+this.totalDiamonds.toString()}sell(){m.instance.buttonAudio.play(),this.coinNumLabel.string="+0",this.diamondNumLabel.string="+0",this.selectAllNode.active=!1,p.userData.data.coins+=this.totalCoins,p.userData.data.diamonds+=this.totalDiamonds,this.updateDataDisplay(),p.sellFishData={userId:p.userData.data.userId,identifiers:[]};for(let t=this.boxContents.length-1;t>=0;t--){const e=this.boxContents[t];if(1==e.selecting){let i=e.getComponent(b).identifier;p.sellFishData.identifiers.push(i),e.node.destroy(),p.boxData.data.splice(t,1),this.boxContents.splice(t,1)}}p.sellFishData.identifiers.length>0&&p.getInstance().post("https://api.xdiving.io/api/fish-catch/unified-sell",p.sellFishData,(t=>{console.log("卖鱼数据:",t),console.log(p.sellFishData)}),(t=>{console.log(`卖鱼数据POST失败: ${t}`)}))}back(){m.instance.buttonAudio.play(),d.loadScene("Menu")}update(t){}}).prototype,"generalUI",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(L.prototype,"contentNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(L.prototype,"boxContentPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(L.prototype,"selectAllNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(L.prototype,"coinNumLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(L.prototype,"diamondNumLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(L.prototype,"spriteFrames",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B=L))||B));a._RF.pop()}}}));

System.register("chunks:///_virtual/BoxContent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,r,n,l,o,a,u;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){r=e.cclegacy,n=e.Sprite,l=e.Label,o=e.Node,a=e._decorator,u=e.Component}],execute:function(){var s,c,p,b,h,f,m,d,g,y,w,L,z,N,x,S,B,C,v;r._RF.push({},"d11947GZiFMfZY0iiZJ0uDi","BoxContent",void 0);const{ccclass:D,property:_}=a;e("BoxContent",(s=D("BoxContent"),c=_(n),p=_(l),b=_(l),h=_(l),f=_(l),m=_(o),d=_(o),g=_(o),s((L=i((w=class extends u{constructor(){super(...arguments),this.box=null,t(this,"sprite",L,this),t(this,"fishNameLabel",z,this),t(this,"weightNumLabel",N,this),t(this,"priceNumLabel",x,this),t(this,"rarityLabel",S,this),t(this,"diamondSprite",B,this),t(this,"goldSprite",C,this),t(this,"selectNode",v,this),this.identifier="",this.selecting=!1,this.diamond=0,this.coin=0}select(){this.box.select(this)}}).prototype,"sprite",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(w.prototype,"fishNameLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(w.prototype,"weightNumLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=i(w.prototype,"priceNumLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=i(w.prototype,"rarityLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=i(w.prototype,"diamondSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(w.prototype,"goldSprite",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(w.prototype,"selectNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=w))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/CameraFollow.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,s,o,r,a,n,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){s=t.cclegacy,o=t.Node,r=t._decorator,a=t.Component,n=t.Vec3,l=t.view}],execute:function(){var p,h,u,c,y,f,b,m,d;s._RF.push({},"169b7/Kp6NLbalALZybudJF","CameraFollow",void 0);const{ccclass:g,property:k}=r;t("CameraFollow",(p=g("CameraFollow"),h=k(o),u=k(o),c=k(o),p((b=i((f=class extends a{constructor(){super(...arguments),e(this,"player",b,this),e(this,"background",m,this),e(this,"map",d,this),this.shakeOffset=new n(0,0,0)}start(){}update(t){this.background.setPosition(.2*-this.player.position.x,.2*-this.player.position.y,0),this.player.position.x>-(3341.5-l.getVisibleSize().width/2)&&this.player.position.x<3341.5-l.getVisibleSize().width/2&&this.map.setPosition(-this.player.position.x+this.shakeOffset.x,this.map.position.y+this.shakeOffset.y,0),this.player.position.y>-(7413-l.getVisibleSize().height/2)&&this.player.position.y<7413-l.getVisibleSize().height/2&&this.map.setPosition(this.map.position.x,-this.player.position.y+this.shakeOffset.y,0)}shake(t,i){void 0===t&&(t=20),void 0===i&&(i=180);const e=i/6;for(let i=0;i<6;i++)setTimeout((()=>{const e=t*(1-i/5);this.shakeOffset.set((Math.random()-.5)*e,(Math.random()-.5)*e,0),5===i&&this.shakeOffset.set(0,0,0)}),i*e)}}).prototype,"player",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(f.prototype,"background",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=i(f.prototype,"map",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=f))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/CheckInContent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Menu.ts","./Manager.ts","./Sound.ts"],(function(t){var e,a,n,i,r,c,o,s,u,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){n=t.cclegacy,i=t.Node,r=t.Label,c=t.Button,o=t._decorator,s=t.Component},function(t){u=t.Menu},function(t){l=t.Manager},function(t){h=t.Sound}],execute:function(){var d,b,p,y,f,k,D,g,C,m,v,w,I,L,z,S,M;n._RF.push({},"aa71bBOoFFCHKiH/Ay4QIQ/","CheckInContent",void 0);const{ccclass:F,property:Q}=o;t("CheckInContent",(d=F("CheckInContent"),b=Q(i),p=Q(i),y=Q(r),f=Q(r),k=Q(c),D=Q(u),g=Q(Number),d((v=e((m=class extends s{constructor(){super(...arguments),a(this,"received",v,this),a(this,"frame",w,this),a(this,"dayLabel",I,this),a(this,"rewardLabel",L,this),a(this,"button",z,this),a(this,"menu",S,this),a(this,"day",M,this)}start(){this.dayLabel.string="Day"+this.day.toString();for(const t of l.checkInData.data.rewards)t.checkDay==this.day&&(7==t.checkDay?this.rewardLabel.string="X"+t.propQuantity.toString():this.rewardLabel.string="X"+t.coinReward.toString())}checkIn(){h.instance.buttonAudio.play();let t="https://api.xdiving.io/api/checkin/"+l.userData.data.userId.toString();l.getInstance().post(t,l.startData,(t=>{console.log("签到数据:",t),console.log(l.startData)}),(t=>{console.log(`'签到数据POST失败: ${t}`)}));let e=l.checkInData.data;l.userData.data.coins+=e.rewards[e.currentCheckDays-1].coinReward,l.propData.data[0].quantity+=e.rewards[e.currentCheckDays-1].propQuantity,7==e.currentCheckDays?e.currentCheckDays=1:e.currentCheckDays++,e.isCheckedToday=!0,this.menu.updateDataDisplay()}updateCheckIn(){1==l.checkInData.data.currentCheckDays&&1==l.checkInData.data.isCheckedToday?(this.received.active=!0,this.frame.active=!0,this.button.interactable=!1):(l.checkInData.data.currentCheckDays>this.day?this.received.active=!0:this.received.active=!1,l.checkInData.data.currentCheckDays==this.day&&0==l.checkInData.data.isCheckedToday?(this.frame.active=!1,this.button.interactable=!0):(this.frame.active=!0,this.button.interactable=!1))}}).prototype,"received",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(m.prototype,"frame",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(m.prototype,"dayLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(m.prototype,"rewardLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(m.prototype,"button",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(m.prototype,"menu",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(m.prototype,"day",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),C=m))||C));n._RF.pop()}}}));

System.register("chunks:///_virtual/Entry.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts"],(function(t){var e,r,s,n,i,o,a,u,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.initializerDefineProperty},function(t){s=t.cclegacy,n=t.ProgressBar,i=t.EditBox,o=t._decorator,a=t.Component,u=t.director},function(t){c=t.Manager}],execute:function(){var l,p,d,h,g,f,I;s._RF.push({},"ecbf1UfLbZD2J6nj6/Kv3wT","Entry",void 0);const{ccclass:y,property:b}=o;t("Entry",(l=y("Entry"),p=b(n),d=b(i),l((f=e((g=class extends a{constructor(){super(...arguments),r(this,"pBar",f,this),r(this,"userIdInput",I,this),this.progressTimer=0,this.firstload=!1,this.resourceProgress=0,this.tonConnectTimeout=10,this.tonConnectStartTime=0}start(){u.preloadScene("Menu",((t,e)=>{this.resourceProgress=t/e}),(t=>{t&&console.error("预加载失败:",t)}))}update(t){this.pBar.progress=this.resourceProgress,0==this.firstload&&c.getInstance().getFinish()&&(this.firstload=!0,u.loadScene("Menu"))}displayEditBox(){this.userIdInput.node.active=!this.userIdInput.node.active}initUser(){let t=parseInt(this.userIdInput.string);this.userIdInput.node.active=!1,this.firstload=!1,c.loadFinish=0,0==t?c.getInstance().initTGUser():c.getInstance().initFakeUser(t)}}).prototype,"pBar",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(g.prototype,"userIdInput",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=g))||h));s._RF.pop()}}}));

System.register("chunks:///_virtual/Equip.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./EquipContent.ts","./Sound.ts","./GeneralUI.ts"],(function(t){var a,e,n,o,i,s,r,u,l,p,c;return{setters:[function(t){a=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){n=t.cclegacy,o=t._decorator,i=t.Component,s=t.director,r=t.color},function(t){u=t.Manager},function(t){l=t.EquipContent},function(t){p=t.Sound},function(t){c=t.GeneralUI}],execute:function(){var h,d,g,b,D,v,x,m,q,C,k;n._RF.push({},"26432zVb8dGmbWZFc0RG8nz","Equip",void 0);const{ccclass:L,property:f}=o;t("Equip",(h=L("Equip"),d=f(c),g=f(l),b=f(l),D=f(l),h((m=a((x=class extends i{constructor(){super(...arguments),e(this,"generalUI",m,this),e(this,"harpoonContent",q,this),e(this,"tankContent",C,this),e(this,"boxContent",k,this),this.harpoonEnough=!0,this.tankEnough=!0,this.boxEnough=!0}start(){this.updateHarpoon(),this.updateBox(),this.updateTank(),this.updateDataDisplay(),s.preloadScene("Menu")}updateDataDisplay(){this.generalUI.updateDisplay(),u.userData.data.coins<u.harpoons[u.equipmentData.data[0].level-1].cost&&(this.harpoonContent.costLabel.color=r(255,0,0),this.harpoonEnough=!1),u.userData.data.coins<u.tanks[u.equipmentData.data[1].level-1].cost&&(this.tankContent.costLabel.color=r(255,0,0),this.tankEnough=!1),u.userData.data.coins<u.boxs[u.equipmentData.data[2].level-1].cost&&(this.boxContent.costLabel.color=r(255,0,0),this.boxEnough=!1)}upgradePost(){if(this.updateDataDisplay(),1==u.questData.data[1].questStatus){u.questData.data[1].questStatus=3,u.questData.data[1].progress++;const t={identifier:9007};u.getInstance().post("https://api.xdiving.io/api/quest/user/progress",t,(a=>{console.log("任务更新:",a),console.log(t)}),(t=>{console.log(`任务更新失败: ${t}`)}))}p.instance.buttonAudio.play(),console.log(u.sellFishData),u.getInstance().post("https://api.xdiving.io/api/equipment/user/"+u.userData.data.userId.toString()+"/upgrade",u.upgradeData,(t=>{console.log("升级数据:",t),console.log(u.upgradeData)}),(t=>{console.log(`升级数据POST失败: ${t}`)}))}upgradeHarpoon(){this.harpoonEnough&&(p.instance.buttonAudio.play(),u.upgradeData.equipmentId=1,u.userData.data.coins-=u.harpoons[u.equipmentData.data[0].level-1].cost,u.equipmentData.data[0].level++,this.updateHarpoon(),this.upgradePost())}updateHarpoon(){let t=u.equipmentData.data[0].level,a=u.harpoons[t-1];this.harpoonContent.curLabel.string="Lv."+t+" Deals "+a.attribute+" damage to fish",t==u.harpoons.length?(this.harpoonContent.upgrade.active=!1,this.harpoonContent.maxLevel.active=!0):(this.harpoonContent.costLabel.string=a.cost.toString(),t++,a=u.harpoons[t-1],this.harpoonContent.nextLabel.string="Lv."+t+" Deals "+a.attribute+" damage to fish")}upgradeTank(){this.tankEnough&&(p.instance.buttonAudio.play(),u.upgradeData.equipmentId=2,u.userData.data.coins-=u.tanks[u.equipmentData.data[1].level-1].cost,u.equipmentData.data[1].level++,this.updateTank(),this.upgradePost())}updateTank(){let t=u.equipmentData.data[1].level,a=u.tanks[t-1];this.tankContent.curLabel.string="Lv."+t+" Air capacity "+a.attribute+" bar",t==u.tanks.length?(this.tankContent.upgrade.active=!1,this.tankContent.maxLevel.active=!0):(this.tankContent.costLabel.string=a.cost.toString(),t++,a=u.tanks[t-1],this.tankContent.nextLabel.string="Lv."+t+" Air capacity "+a.attribute+" bar")}upgradeBox(){this.boxEnough&&(p.instance.buttonAudio.play(),u.upgradeData.equipmentId=3,u.userData.data.coins-=u.boxs[u.equipmentData.data[2].level-1].cost,u.equipmentData.data[2].level++,this.updateBox(),this.upgradePost())}updateBox(){let t=u.equipmentData.data[2].level,a=u.boxs[t-1];this.boxContent.curLabel.string="Lv."+t+" Max Haul "+a.attribute+" kg",t==u.boxs.length?(this.boxContent.upgrade.active=!1,this.boxContent.maxLevel.active=!0):(this.boxContent.costLabel.string=a.cost.toString(),t++,a=u.boxs[t-1],this.boxContent.nextLabel.string="Lv."+t+" Max Haul "+a.attribute+" kg")}back(){p.instance.buttonAudio.play(),s.loadScene("Menu")}update(t){}}).prototype,"generalUI",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=a(x.prototype,"harpoonContent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=a(x.prototype,"tankContent",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=a(x.prototype,"boxContent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=x))||v));n._RF.pop()}}}));

System.register("chunks:///_virtual/EquipContent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,n,l,o,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){i=e.cclegacy,n=e.Node,l=e.Label,o=e._decorator,u=e.Component}],execute:function(){var a,c,s,p,b,f,h,d,g,y,L,m,v;i._RF.push({},"559d0cr6qFEB50Etz7a+vYK","EquipContent",void 0);const{ccclass:z,property:x}=o;e("EquipContent",(a=z("EquipContent"),c=x(n),s=x(n),p=x(l),b=x(l),f=x(l),a((g=t((d=class extends u{constructor(){super(...arguments),r(this,"upgrade",g,this),r(this,"maxLevel",y,this),r(this,"costLabel",L,this),r(this,"curLabel",m,this),r(this,"nextLabel",v,this)}start(){}update(e){}}).prototype,"upgrade",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(d.prototype,"maxLevel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(d.prototype,"costLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(d.prototype,"curLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(d.prototype,"nextLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=d))||h));i._RF.pop()}}}));

System.register("chunks:///_virtual/Fish.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts","./AttackedHint.ts"],(function(t){var e,i,s,n,h,a,o,r,l,d,u,g,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){s=t.cclegacy,n=t.sp,h=t.Node,a=t._decorator,o=t.Component,r=t.Vec3,l=t.randomRange,d=t.instantiate,u=t.misc},function(t){g=t.default},function(t){c=t.AttackedHint}],execute:function(){var m,S,p,T,k,y,x;s._RF.push({},"791edwEzVtBI4A8t+1W+Xda","Fish",void 0);const{ccclass:f,property:v}=a;t("Fish",(m=f("Fish"),S=v(n.Skeleton),p=v(h),m((y=e((k=class extends o{constructor(){super(...arguments),i(this,"bloodSkeleton",y,this),i(this,"stunHint",x,this),this.bloodTimer=1,this.timer=0,this.turnTimer=0,this.struggleSpeed=300,this.struggleTimer=0,this.stunShakeSpeed=60,this.stunShakeTimer=0,this.index=void 0,this.rarityIndex=0,this.precent=1,this.attack=0,this.health=1,this.maxHealth=1,this.speed=.15,this.maxSpeed=.15,this.beingCatched=!1,this.utSize=void 0,this.oldPos=new r,this.game=null,this.healthDisplaying=!1,this.healthTimer=2,this.healthBar=null,this.attacking=!1,this.attackTimer=0,this.attackHint=null,this.stunTimer=0,this.stunHintScaleTimer=0,this.waitingTimer=0,this.spawnBoundary=null,this.originScale=void 0,this.reverseScale=void 0}start(){this.turnTimer=l(-1.8,-3.2),this.oldPos=this.node.getPosition(),this.originScale=new r(this.node.scale.x,this.node.scale.y,1),this.reverseScale=new r(this.node.scale.x,-this.node.scale.y,1),this.reverse()}catched(t){this.struggleTimer+=t,this.struggleTimer>.15&&(this.struggleTimer-=.15,this.struggleSpeed=-this.struggleSpeed),this.node.angle+=t*this.struggleSpeed}reverse(){this.node.angle>90&&this.node.angle<270||this.node.angle<-90?this.node.scale=this.reverseScale:this.node.scale=this.originScale}move(t){this.waitingTimer>0?this.waitingTimer-=t:(this.timer+=t,this.attackTimer+=t,this.turnTimer+=t,this.updateangle(),this.node.setPosition(this.node.getPosition().add(new r(-Math.cos(this.node.angle*(Math.PI/180))*t*this.speed*670,-Math.sin(this.node.angle*(Math.PI/180))*t*this.speed*670,0))))}stuned(t){this.stunTimer-=t,this.stunHintScaleTimer+=5*t;const e=this.utSize/500*(1+.1*Math.sin(this.stunHintScaleTimer));this.stunHint.setScale(e,e,1),this.stunShakeTimer+=t,this.stunShakeTimer>.15&&(this.stunShakeTimer-=.15,this.stunShakeSpeed=-this.stunShakeSpeed),this.node.angle+=t*this.stunShakeSpeed*.5,this.stunTimer<=0&&(this.stunTimer=0,this.stunHintScaleTimer=0,this.stunShakeTimer=0,this.stunShakeSpeed=60,this.stunHint.active=!1,this.getComponent(n.Skeleton).timeScale=1/this.precent)}updateangle(){if(this.timer>0){this.timer-=.2;let t=this.node.getPosition(),e=t.x-this.utSize,i=t.x+this.utSize,s=t.y+this.utSize,n=t.y-this.utSize;for(const t of this.game.wallBoundarys)if(i>t.left&&e<t.right&&n<t.up&&s>t.down){let e=this.oldPos.x-this.utSize,i=this.oldPos.x+this.utSize,s=this.oldPos.y+this.utSize,n=this.oldPos.y-this.utSize;return i<t.left?this.node.angle=l(-45,45):s<t.down?this.node.angle=l(45,135):e>t.right?this.node.angle=l(135,225):n>t.up&&(this.node.angle=l(225,315)),this.reverse(),this.attacking&&(this.attacking=!1,this.speed=.15,this.attack>0&&this.attackHint.destroy()),this.attackTimer=-2,void(this.turnTimer=l(-3.2,-6.4))}this.oldPos=this.node.getPosition()}if(this.attackTimer>0){this.attackTimer-=.2;let t=this.game.playerNode.getPosition(),e=this.node.getPosition(),i=e.x-this.utSize,s=e.x+this.utSize,n=e.y+this.utSize,h=e.y-this.utSize;if(this.attacking){if(s>t.x-10&&i<t.x+10&&h<t.y+10&&n>t.y-10){let t=this.game.playerNode.getComponent(g);if(t.firstDie&&t.firstWin){let e=d(this.game.attackedHint);this.game.tempNode.addChild(e),e.getComponent(c).damage.string="-"+this.attack.toString(),e.getComponent(c).player=this.game.playerNode,t.bloodSkeleton.node.active=!0,t.bloodSkeleton.clearTracks(),t.bloodSkeleton.setAnimation(0,"dongqilai",!1),t.bloodTimer=1,t.oxygen>this.attack?t.oxygen-=this.attack:(t.oxygen=0,t.oxygenNotIncluded());let i=Math.round(t.oxygen);t.oxygenNumLabel.string=i.toString(),this.game.redOxygen.active=!0,this.game.redOxygenTimer=0,this.waitingTimer=2}}else{const e=t.x-this.node.x,i=t.y-this.node.y;let s=Math.atan2(-i,-e);this.node.angle=u.radiansToDegrees(s)+l(-10,10),this.reverse()}return}{let e=t.x-250,a=t.x+250,o=t.y+250,r=t.y-250;if(s>e&&i<a&&h<o&&n>r){const e=t.x-this.node.x,i=t.y-this.node.y;let s=Math.atan2(i,e);if(this.attack>0){s=Math.atan2(-i,-e),this.attacking=!0,this.waitingTimer=1,this.speed=this.maxSpeed;let t=d(this.game.attackHint);this.game.tempNode.addChild(t),this.attackHint=t}else.32==this.maxSpeed?(this.attackTimer=-1,this.turnTimer=l(-3.2,-6.4)):(this.attackTimer=-10,this.turnTimer=l(-3.2,-6.4));return this.node.angle=u.radiansToDegrees(s)+l(-10,10),void this.reverse()}this.turnTimer>0&&(this.turnTimer=l(-3.2,-6.4),i>this.spawnBoundary.right?this.node.angle=l(-90,90):h>this.spawnBoundary.up?this.node.angle=l(0,180):s<this.spawnBoundary.left?this.node.angle=l(90,270):n<this.spawnBoundary.down?this.node.angle=l(180,360):this.node.angle=l(0,360),this.reverse())}}}update(t){this.beingCatched?this.catched(t):this.move(t),this.stunTimer>0&&this.stuned(t),this.healthDisplaying&&(this.healthBar.node.setPosition(this.node.getPosition().add(new r(0,this.utSize-10,0))),this.healthTimer-=t,this.healthTimer<0&&(this.healthDisplaying=!1,this.healthBar.node.destroy())),this.bloodSkeleton.node.active&&(this.bloodTimer>0?this.bloodTimer-=t:(this.bloodTimer=1,this.bloodSkeleton.node.active=!1)),this.attacking&&this.attack>0&&this.attackHint.setPosition(this.node.getPosition().add(new r(0,this.utSize+10,0)))}}).prototype,"bloodSkeleton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(k.prototype,"stunHint",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=k))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/Game.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Fish.ts","./Manager.ts","./Treasure.ts","./GeneralUI.ts","./GameContent.ts","./Sound.ts","./Player.ts"],(function(t){var e,i,n,r,o,a,s,l,u,p,h,c,d,f,b,g,m,y,w,S,z;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,r=t.SpriteFrame,o=t.sp,a=t.Prefab,s=t.Node,l=t.Sprite,u=t._decorator,p=t.Component,h=t.UITransform,c=t.instantiate,d=t.randomRange,f=t.Vec3},function(t){b=t.Fish},function(t){g=t.Manager},function(t){m=t.Treasure},function(t){y=t.GeneralUI},function(t){w=t.GameContent},function(t){S=t.Sound},function(t){z=t.default}],execute:function(){var x,P,C,N,I,k,B,v,D,H,F,G,O,M,R,U,T,J,L,_,q,A,E,j,V,K,Q,W,X,Y,Z,$,tt,et,it,nt,rt,ot,at,st,lt,ut,pt;n._RF.push({},"a8a15hfcPBHgaqOIw4mRfbm","Game",void 0);const{ccclass:ht,property:ct}=u;class dt{constructor(){this.left=0,this.right=0,this.up=0,this.down=0}}t("Game",(x=ht("Game"),P=ct(y),C=ct([r]),N=ct([o.SkeletonData]),I=ct(a),k=ct(a),B=ct([r]),v=ct(s),D=ct(w),H=ct(s),F=ct(s),G=ct(s),O=ct(s),M=ct(s),R=ct(s),U=ct(a),T=ct(a),J=ct(a),L=ct(a),_=ct(l),q=ct(s),x((j=e((E=class t extends p{constructor(){super(...arguments),i(this,"generalUI",j,this),i(this,"fishImages",V,this),i(this,"fishJsons",K,this),i(this,"fishPrefab",Q,this),i(this,"gameContentPrefab",W,this),i(this,"propSprites",X,this),i(this,"choosePropNode",Y,this),i(this,"curPropContent",Z,this),this.curPropIndex=0,i(this,"playerNode",$,this),i(this,"fishesNode",tt,this),i(this,"tempNode",et,this),i(this,"walls",it,this),this.wallBoundarys=[],i(this,"spawns",nt,this),this.spawnBoundarys=[],i(this,"treasuresNode",rt,this),this.treasureBoundarys=[],this.treasures=[],i(this,"healthBar",ot,this),this.healthBars=[],i(this,"attackHint",at,this),i(this,"attackedHint",st,this),i(this,"stunHint",lt,this),i(this,"redFrame",ut,this),i(this,"redOxygen",pt,this),this.redOxygenTimer=0}start(){this.generalUI.updateDisplay(),this.generalUI.updateLevel();for(let t=0;t<this.choosePropNode.children.length;t++){let e=this.choosePropNode.children[t].getComponent(w);e.index=t,e.game=this,e.propSprite.spriteFrame=this.propSprites[t],e.propNumLabel.string="x"+g.propData.data[t].quantity.toString()}this.curPropIndex=g.userData.data.mainPropId-1,console.log(this.curPropIndex),this.curPropContent.index=-1,this.curPropContent.game=this,this.curPropContent.propSprite.spriteFrame=this.propSprites[this.curPropIndex],this.curPropContent.propNumLabel.string="x"+g.propData.data[this.curPropIndex].quantity.toString();for(let t of this.walls.children){const e=t.getComponent(h),i=new dt;i.left=t.position.x-e.contentSize.x/2,i.right=t.position.x+e.contentSize.x/2,i.up=t.position.y+e.contentSize.y/2,i.down=t.position.y-e.contentSize.y/2,this.wallBoundarys.push(i)}this.walls.active=!1;for(let t of this.spawns.children){const e=t.getComponent(h),i=new dt;i.left=t.position.x-e.contentSize.x/2,i.right=t.position.x+e.contentSize.x/2,i.up=t.position.y+e.contentSize.y/2,i.down=t.position.y-e.contentSize.y/2,this.spawnBoundarys.push(i)}this.spawns.active=!1;for(let t of this.treasuresNode.children){const e=t.getComponent(h),i=new dt;i.left=t.position.x-e.contentSize.x/2,i.right=t.position.x+e.contentSize.x/2,i.up=t.position.y+e.contentSize.y/2,i.down=t.position.y-e.contentSize.y/2,this.treasureBoundarys.push(i),this.treasures.push(t.getComponent(m))}for(let e=0;e<this.fishJsons.length;e++){let i=g.fishBaseData.data[e];if(g.userData.data.swordfishCatched&&"Swordfish"==i.fishNameEn)break;for(let n=0;n<i.rarity;n++){let n=c(this.fishPrefab),r=n.getComponent(o.Skeleton);r.skeletonData=this.fishJsons[e];let a="animation";r.setAnimation(0,a,!0);let s=d(.8,1.2);r.timeScale=1/s,n.setScale(s,s,1),n.angle=d(-180,180);let l=n.getComponent(b);l.index=e;let u=d(0,g.totalRarity);for(let t=0;t<g.rarityBaseData.data.length;t++)if(u<g.actualRarity[t]){l.rarityIndex=t;break}l.precent=s,l.attack=Math.round(i.attack*s),l.health=Math.round(i.health*s),l.maxHealth=Math.round(i.health*s),l.maxSpeed=i.speed,"Swordfish"==i.fishNameEn?(r.premultipliedAlpha=!0,l.utSize=150):l.utSize=n.getComponent(h).contentSize.x/2*s,l.attack>0?l.speed=.15:l.speed=i.speed,l.game=this.node.getComponent(t);let p=this.spawnBoundarys[Math.round(i.spawnRegion)];l.spawnBoundary=p,l.bloodSkeleton.node.setScale(l.utSize/100,l.utSize/100,1),l.bloodSkeleton.node.active=!1,l.stunHint.setScale(.1+l.utSize/1e3,.1+l.utSize/1e3,1),l.stunHint.setPosition(l.node.getPosition().add(new f(.8*-l.utSize,.7*l.utSize,0))),l.stunHint.active=!1;let m=new f(d(p.left,p.right),d(p.down,p.up),0),y=m.x-l.utSize,w=m.x+l.utSize,S=m.y+l.utSize,z=m.y-l.utSize,x=0;for(;x<100;){x++;let t=!1;for(const e of this.wallBoundarys)w>e.left&&y<e.right&&z<e.up&&S>e.down&&(t=!0,m=new f(d(p.left,p.right),d(p.down,p.up),0),y=m.x-l.utSize,w=m.x+l.utSize,S=m.y+l.utSize,z=m.y-l.utSize);if(!t)break}n.setPosition(m),this.fishesNode.addChild(n)}}}hideProp(){S.instance.buttonAudio.play(),this.choosePropNode.active=!this.choosePropNode.active,this.curPropContent.node.active=!this.curPropContent.node.active}useProp(){this.playerNode.getComponent(z).useProp(this.curPropIndex)}update(t){this.redOxygen.active&&(this.redOxygenTimer<1?this.redOxygenTimer+=t:this.redOxygen.active=!1)}}).prototype,"generalUI",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(E.prototype,"fishImages",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),K=e(E.prototype,"fishJsons",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=e(E.prototype,"fishPrefab",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(E.prototype,"gameContentPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(E.prototype,"propSprites",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Y=e(E.prototype,"choosePropNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(E.prototype,"curPropContent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(E.prototype,"playerNode",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(E.prototype,"fishesNode",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(E.prototype,"tempNode",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(E.prototype,"walls",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=e(E.prototype,"spawns",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=e(E.prototype,"treasuresNode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(E.prototype,"healthBar",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(E.prototype,"attackHint",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(E.prototype,"attackedHint",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=e(E.prototype,"stunHint",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(E.prototype,"redFrame",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(E.prototype,"redOxygen",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=E))||A));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameContent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts"],(function(e){var t,r,i,n,o,a,p,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){i=e.cclegacy,n=e.Sprite,o=e.Label,a=e._decorator,p=e.Component},function(e){s=e.Manager}],execute:function(){var u,c,l,h,m,g,d;i._RF.push({},"99ce2DI3chKcogYvcg+VigF","GameContent",void 0);const{ccclass:b,property:f}=a;e("GameContent",(u=b("GameContent"),c=f(n),l=f(o),u((g=t((m=class e extends p{constructor(){super(...arguments),this.game=null,r(this,"propSprite",g,this),r(this,"propNumLabel",d,this),this.index=0}chooseProp(){this.index>=0?(s.userData.data.mainPropId=this.index+1,this.game.curPropIndex=this.index,this.game.curPropContent.getComponent(e).propSprite.spriteFrame=this.game.propSprites[this.index],this.game.curPropContent.getComponent(e).propNumLabel.string="x"+s.propData.data[this.index].quantity.toString(),this.game.hideProp()):this.game.useProp()}start(){}update(e){}}).prototype,"propSprite",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(m.prototype,"propNumLabel",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=m))||h));i._RF.pop()}}}));

System.register("chunks:///_virtual/GeneralUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./Sound.ts"],(function(t){var e,a,i,n,s,o,r,l,u,c,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){i=t.cclegacy,n=t.Label,s=t.ProgressBar,o=t.Node,r=t.EditBox,l=t._decorator,u=t.Component,c=t.sys},function(t){d=t.Manager},function(t){p=t.Sound}],execute:function(){var h,b,m,g,f,y,v,S,D,G,B,L,I,w,T,A,x,F,z,M,C,N,W,k,U,$,j,P,R,E,K,_,O,X,V,q,H,J,Q;i._RF.push({},"75d7bj3cyFMhoVartyIj8mm","GeneralUI",void 0);const{ccclass:Y,property:Z}=l;t("GeneralUI",(h=Y("GeneralUI"),b=Z(n),m=Z(n),g=Z(n),f=Z(s),y=Z(n),v=Z(n),S=Z(o),D=Z(o),G=Z(o),B=Z(o),L=Z(o),I=Z(o),w=Z(o),T=Z(o),A=Z(n),x=Z(r),F=Z(n),z=Z(n),h((N=e((C=class extends u{constructor(){super(...arguments),a(this,"coins",N,this),a(this,"diamonds",W,this),a(this,"level",k,this),a(this,"levelBar",U,this),a(this,"userId",$,this),a(this,"playerName",j,this),a(this,"settingFrame",P,this),a(this,"blackGround",R,this),a(this,"BGMon",E,this),a(this,"BGMoff",K,this),a(this,"BGSon",_,this),a(this,"BGSoff",O,this),a(this,"successFrame",X,this),this.successTimer=1,a(this,"failFrame",V,this),this.failTimer=1,a(this,"nameLabel",q,this),a(this,"nameInput",H,this),a(this,"statusLabel",J,this),a(this,"connectLabel",Q,this)}formatNumber(t){if(t<0)return"-"+this.formatNumber(-t);const e=[{threshold:1e15,symbol:"Qa"},{threshold:1e12,symbol:"T"},{threshold:1e9,symbol:"B"},{threshold:1e6,symbol:"M"},{threshold:1e3,symbol:"K"}];if(t<=9999)return t.toLocaleString("en-US");for(const a of e)if(t>=a.threshold){const e=t/a.threshold;let i;return i=e>=1e3?e.toFixed(0):e>=100?e%1==0?e.toFixed(0):e.toFixed(1):e>=10&&e%1==0?e.toFixed(0):e.toFixed(2).replace(/\.?0+$/,""),i+a.symbol}return t.toLocaleString("en-US")}updateDisplay(){this.coins.string=this.formatNumber(d.userData.data.coins),this.diamonds.string=d.userData.data.diamonds.toString(),this.userId.string="ID:"+d.userData.data.userId.toString(),this.playerName.string=d.userData.data.displayUsername,this.updateSetting(),this.updateWalletStatus()}updateWalletStatus(){const t=d.getInstance();if(!t)return this.statusLabel&&(this.statusLabel.string="Manager Not Initialized"),void(this.connectLabel&&(this.connectLabel.string=""));const e=t.getConnectUI();if(e)if(e.connected){const t=e.account;let a=[];if(t?.address&&a.push(`Addr: ${t.address}`),void 0!==t?.chain&&a.push(`Chain: ${t.chain}`),t?.publicKey&&a.push(`PubKey: ${t.publicKey}`),t){const e=Object.keys(t);for(const i of e)if("address"!==i&&"chain"!==i&&"publicKey"!==i){const e=t[i];if(null!=e){const t="object"==typeof e?JSON.stringify(e):String(e);a.push(`${i}: ${t}`)}}}a.push(`Connected: ${e.connected}`);const i=a.join(" | ");this.statusLabel&&(this.statusLabel.string=i),this.connectLabel&&(this.connectLabel.string="Disconnect")}else this.statusLabel&&(this.statusLabel.string="Waiting to connect wallet"),this.connectLabel&&(this.connectLabel.string="Connect Wallet");else{const e=t.getWalletInitError(),a=t.getWalletInitErrorDetails();if(this.statusLabel)if(e){let t=`Wallet Not Initialized\nError: ${e}`;a&&(a.step&&(t+=`\nStep: ${a.step}`),a.error&&(t+=`\nDetails: ${a.error}`),a.message&&(t+=`\nMessage: ${a.message}`),a.name&&(t+=`\nType: ${a.name}`)),this.statusLabel.string=t}else this.statusLabel.string="Wallet Not Initialized";this.connectLabel&&(this.connectLabel.string="Not Initialized")}}updateLevel(){this.level.string="Lv."+d.userData.data.level.toString(),d.userData.data.level<d.levelBaseData.data.length?this.levelBar.progress=d.userData.data.experience/d.levelBaseData.data[d.userData.data.level].experienceRequired:this.levelBar.progress=1}openSetting(){p.instance.buttonAudio.play(),this.settingFrame.active=!this.settingFrame.active,this.blackGround.active=!this.blackGround.active}updateSetting(){this.BGMon.active=d.userData.data.BGMopen,this.BGMoff.active=!d.userData.data.BGMopen,this.BGSon.active=d.userData.data.BGSopen,this.BGSoff.active=!d.userData.data.BGSopen,this.updateSound()}updateSound(){d.userData.data.BGMopen?(p.instance.BGM.volume=1,p.instance.stayAudio.volume=1,p.instance.moveAudio.volume=1,p.instance.boostAudio.volume=1):(p.instance.BGM.volume=0,p.instance.stayAudio.volume=0,p.instance.moveAudio.volume=0,p.instance.boostAudio.volume=0),d.userData.data.BGSopen?(p.instance.buttonAudio.volume=1,p.instance.shootAudio.volume=.5,p.instance.catchAudio.volume=1,p.instance.treasureAudio.volume=1,p.instance.backAudio.volume=1):(p.instance.buttonAudio.volume=0,p.instance.catchAudio.volume=0,p.instance.treasureAudio.volume=0,p.instance.shootAudio.volume=0,p.instance.backAudio.volume=0)}SettingBGM(){p.instance.buttonAudio.play(),d.userData.data.BGMopen=!d.userData.data.BGMopen,this.SettingPut(),this.updateSetting()}SettingBGS(){p.instance.buttonAudio.play(),d.userData.data.BGSopen=!d.userData.data.BGSopen,this.SettingPut(),this.updateSetting()}SettingPut(){d.setData.BGMopen=d.userData.data.BGMopen,d.setData.BGSopen=d.userData.data.BGSopen,d.getInstance().put("https://api.xdiving.io/api/user/"+d.userData.data.userId+"/bgm-bgs",d.setData,(t=>{console.log("设置数据:",t),console.log(d.setData)}),(t=>{console.log(`设置数据PUT失败: ${t}`)}))}jumpTG(){p.instance.buttonAudio.play();const t="https://t.me/XDivingOfficial";window.Telegram&&window.Telegram.WebApp?window.Telegram.WebApp.openTelegramLink(t):c.openURL(t)}jumpX(){p.instance.buttonAudio.play();const t="https://x.com/XDIVING_Global";window.Telegram&&window.Telegram.WebApp,c.openURL(t)}copy(){p.instance.buttonAudio.play(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(d.userData.data.userId.toString()).then((()=>{console.log("链接复制成功: "),this.successFrame.active=!0})).catch((t=>{console.error("复制失败，尝试备用方法: ",t),this.fallbackCopyTextToClipboard(d.userData.data.userId.toString())})):this.fallbackCopyTextToClipboard(d.userData.data.userId.toString())}copyStatus(){p.instance.buttonAudio.play(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(this.statusLabel.string).then((()=>{console.log("状态复制成功: ",this.statusLabel.string),this.successFrame.active=!0})).catch((t=>{console.error("复制失败，尝试备用方法: ",t),this.fallbackCopyTextToClipboard(this.statusLabel.string)})):this.fallbackCopyTextToClipboard(this.statusLabel.string)}fallbackCopyTextToClipboard(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);try{document.execCommand("copy")?(console.log("链接复制成功 (备用方法): "),this.successFrame.active=!0):(console.error("备用复制方法失败"),this.failFrame.active=!0)}catch(t){console.error("备用复制方法出错: ",t)}document.body.removeChild(e)}changeName(){p.instance.buttonAudio.play(),this.nameInput.node.active?this.confirmName():(this.nameInput.node.active=!0,this.nameInput.string=this.nameLabel.string)}confirmName(){this.nameInput.node.active=!1;let t=this.nameInput.string;t.length>0&&t.length<17&&t!=this.nameLabel.string&&(this.nameLabel.string=t,d.userData.data.displayUsername=t,d.changeNameData.displayUsername=t,d.getInstance().put("https://api.xdiving.io/api/user/"+d.userData.data.userId+"/display-name",d.changeNameData,(t=>{console.log("修改名字:",t)})))}connectWallet(){d.getInstance().connectWallet()}start(){d.onWalletStatusChange((()=>{this.updateWalletStatus()})),this.updateWalletStatus()}update(t){this.successFrame.active&&(this.successTimer>0?this.successTimer-=t:(this.successFrame.active=!1,this.successTimer=1)),this.failFrame.active&&(this.failTimer>0?this.failTimer-=t:(this.failFrame.active=!1,this.failTimer=1))}}).prototype,"coins",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(C.prototype,"diamonds",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(C.prototype,"level",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(C.prototype,"levelBar",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(C.prototype,"userId",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(C.prototype,"playerName",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(C.prototype,"settingFrame",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(C.prototype,"blackGround",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(C.prototype,"BGMon",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(C.prototype,"BGMoff",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(C.prototype,"BGSon",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(C.prototype,"BGSoff",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(C.prototype,"successFrame",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(C.prototype,"failFrame",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(C.prototype,"nameLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(C.prototype,"nameInput",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(C.prototype,"statusLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(C.prototype,"connectLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=C))||M));i._RF.pop()}}}));

System.register("chunks:///_virtual/GifPlayer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,s,n,a,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){r=e.cclegacy,s=e.SpriteFrame,n=e._decorator,a=e.Component,p=e.Sprite}],execute:function(){var o,l,c,u,h,d,f;r._RF.push({},"4b2ca25L0ZOUpa4n63YurJX","GifPlayer",void 0);const{ccclass:m,property:y}=n;e("GifPlayer",(o=m("GifPlayer"),l=y([s]),c=y([Number]),o((d=t((h=class extends a{constructor(){super(...arguments),i(this,"spriteFrames",d,this),this.sprite=null,i(this,"speed",f,this),this.index=0}start(){this.sprite=this.getComponent(p),this.schedule((()=>{this.spriteFrames.length>0&&(this.sprite.spriteFrame=this.spriteFrames[this.index],this.index=(this.index+1)%this.spriteFrames.length)}),this.speed)}}).prototype,"spriteFrames",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f=t(h.prototype,"speed",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),u=h))||u));r._RF.pop()}}}));

System.register("chunks:///_virtual/Guide.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./Sound.ts"],(function(i){var t,e,u,n,r,a,o,c;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.initializerDefineProperty},function(i){u=i.cclegacy,n=i.Node,r=i._decorator,a=i.Component},function(i){o=i.Manager},function(i){c=i.Sound}],execute:function(){var s,l,d,h,g,p,b,f,y,v,m,G,w,z,F;u._RF.push({},"bec30tGt8JLw6i6RBYbSKot","Guide",void 0);const{ccclass:k,property:A}=r;i("Guide",(s=k("Guide"),l=A(n),d=A(n),h=A(n),g=A(n),p=A(n),b=A(n),s((v=t((y=class extends a{constructor(){super(...arguments),e(this,"blackGround",v,this),e(this,"guide1",m,this),e(this,"guide2",G,this),e(this,"guide3",w,this),e(this,"guide4",z,this),e(this,"goFishing",F,this),this.cur=0}start(){0==o.userData.data.guideFinish&&(this.cur++,this.blackGround.active=!0,this.guide1.active=!0)}update(i){}next(){1==this.cur?(c.instance.buttonAudio.play(),this.guide1.active=!1,this.guide2.active=!0,this.cur++):2==this.cur?(c.instance.buttonAudio.play(),this.guide2.active=!1,this.guide3.active=!0,this.cur++):3==this.cur?(c.instance.buttonAudio.play(),this.guide3.active=!1,this.guide4.active=!0,this.cur++):4==this.cur&&(c.instance.buttonAudio.play(),this.guide4.active=!1,this.goFishing.active=!0,this.cur++)}}).prototype,"blackGround",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(y.prototype,"guide1",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(y.prototype,"guide2",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(y.prototype,"guide3",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(y.prototype,"guide4",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(y.prototype,"goFishing",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=y))||f));u._RF.pop()}}}));

System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts"],(function(t){var i,e,o,n,s,r,a,c,l,h,p,u,y,d,T,g,f,b;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){o=t.cclegacy,n=t.EventTarget,s=t.Node,r=t.Enum,a=t.Vec3,c=t.Vec2,l=t.CCInteger,h=t._decorator,p=t.Component,u=t.UITransform,y=t.Size,d=t.UIOpacity,T=t.SystemEventType,g=t.misc},function(t){f=t.default,b=t.PlayerState}],execute:function(){var m,L,_,O,E,S,C,k,P,v,w,F,z,D,I,N,U,A,R,J,H;o._RF.push({},"73162lxt5BLxbtr/vpxLfXd","Joystick",void 0);const{ccclass:M,property:j}=h,x=t("instance",new n),W=t("SET_JOYSTICK_TYPE","SET_JOYSTICK_TYPE");let X=t("DirectionType",function(t){return t[t.FOUR=0]="FOUR",t[t.EIGHT=1]="EIGHT",t[t.ALL=2]="ALL",t}({})),V=t("SpeedType",function(t){return t[t.STOP=0]="STOP",t[t.NORMAL=1]="NORMAL",t[t.FAST=2]="FAST",t}({})),B=t("JoystickType",function(t){return t[t.FIXED=0]="FIXED",t[t.FOLLOW=1]="FOLLOW",t}({}));t("Joystick",(m=M("Joystick"),L=j({type:s,displayName:"Dot",tooltip:"摇杆操纵点"}),_=j({type:s,displayName:"Ring",tooltip:"摇杆背景节点"}),O=j(f),E=j({type:s,displayName:"Bg",tooltip:"摇杆背景"}),S=j({type:r(B),displayName:"Touch Type",tooltip:"触摸类型"}),C=j({type:r(X),displayName:"Direction Type",tooltip:"方向类型"}),k=j({type:a,tooltip:"摇杆所在位置"}),P=j({type:c,tooltip:"触摸位置"}),v=j({type:l,displayName:"Ring Radius",tooltip:"半径"}),m((z=i((F=class extends p{constructor(){super(...arguments),e(this,"dot",z,this),e(this,"ring",D,this),e(this,"player",I,this),e(this,"bg",N,this),e(this,"joystickType",U,this),e(this,"directionType",A,this),e(this,"_stickPos",R,this),e(this,"_touchLocation",J,this),e(this,"radius",H,this)}onLoad(){if(!this.dot)return void console.warn("Joystick Dot is null!");if(!this.ring)return void console.warn("Joystick Ring is null!");const t=this.ring.getComponent(u),i=2*this.radius,e=new y(i,i);t?.setContentSize(e),this.ring.getChildByName("bg").getComponent(u)?.setContentSize(e),this._initTouchEvent();const o=this.node.getComponent(d);this.joystickType===B.FOLLOW&&o&&(o.opacity=0)}onEnable(){x.on(W,this._onSetJoystickType,this)}onDisable(){x.off(W,this._onSetJoystickType,this)}_onSetJoystickType(t){this.joystickType=t;const i=this.node.getComponent(d);i&&(i.opacity=t===B.FIXED?255:0)}_initTouchEvent(){this.node.on(T.TOUCH_START,this._touchStartEvent,this),this.node.on(T.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(T.TOUCH_END,this._touchEndEvent,this),this.node.on(T.TOUCH_CANCEL,this._touchEndEvent,this)}_touchStartEvent(t){if(!this.ring||!this.dot)return;if(this.player.playerState==b.CATCH)return;x.emit(T.TOUCH_START,t);const i=t.getUILocation(),e=new a(i.x,i.y);if(this.joystickType===B.FIXED){this._stickPos=this.ring.getPosition();const t=e.subtract(this.ring.getPosition()),i=t.length();this.radius>i&&this.dot.setPosition(t)}else this.joystickType===B.FOLLOW&&(this._stickPos=e,this.node.getComponent(d).opacity=255,this._touchLocation=t.getUILocation(),this.ring.setPosition(e),this.dot.setPosition(new a))}_touchMoveEvent(t){if(!this.dot||!this.ring)return;if(this.joystickType===B.FOLLOW&&this._touchLocation===t.getUILocation())return!1;const i=t.getUILocation(),e=new a(i.x,i.y).subtract(this.ring.getPosition()),o=e.length();let n=V.NORMAL;this.radius>o?(this.dot.setPosition(e),n=V.NORMAL):(this.dot.setPosition(e.normalize().multiplyScalar(this.radius)),n=V.FAST),this.bg.angle=g.radiansToDegrees(Math.atan2(e.normalize().y,e.normalize().x))-90,x.emit(T.TOUCH_MOVE,t,{speedType:n,moveVec:e.normalize()})}_touchEndEvent(t){this.dot&&this.ring&&(this.dot.setPosition(new a),this.joystickType===B.FOLLOW&&(this.node.getComponent(d).opacity=0),x.emit(T.TOUCH_END,t,{speedType:V.STOP}))}}).prototype,"dot",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(F.prototype,"ring",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=i(F.prototype,"player",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(F.prototype,"bg",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(F.prototype,"joystickType",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B.FIXED}}),A=i(F.prototype,"directionType",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.ALL}}),R=i(F.prototype,"_stickPos",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new a}}),J=i(F.prototype,"_touchLocation",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c}}),H=i(F.prototype,"radius",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),w=F))||w));o._RF.pop()}}}));

System.register("chunks:///_virtual/Load.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,s,o,t,i,a,c;return{setters:[function(r){e=r.applyDecoratedDescriptor,s=r.initializerDefineProperty},function(r){o=r.cclegacy,t=r.ProgressBar,i=r._decorator,a=r.Component,c=r.director}],execute:function(){var n,p,u,l,d;o._RF.push({},"f36084wZCpEOq9m0ogiT/uW","Load",void 0);const{ccclass:h,property:g}=i;r("Load",(n=h("Load"),p=g(t),n((d=e((l=class extends a{constructor(){super(...arguments),s(this,"pBar",d,this),this.progressTimer=0,this.firstload=!0,this.resourceProgress=0}start(){c.preloadScene("Game",((r,e)=>{this.resourceProgress=r/e}),(r=>{r&&console.error("预加载失败:",r)}))}update(r){this.pBar.progress<this.resourceProgress&&(this.pBar.progress=this.resourceProgress),this.progressTimer>.1?this.firstload&&(this.firstload=!1,c.loadScene("Game")):this.progressTimer+=r}}).prototype,"pBar",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=l))||u));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AttackedHint.ts","./Box.ts","./BoxContent.ts","./CameraFollow.ts","./CheckInContent.ts","./Entry.ts","./Equip.ts","./EquipContent.ts","./Fish.ts","./Game.ts","./GameContent.ts","./GeneralUI.ts","./GifPlayer.ts","./Guide.ts","./Joystick.ts","./Load.ts","./Manager.ts","./Menu.ts","./Player.ts","./PropContent.ts","./Quest.ts","./QuestContent.ts","./Referral.ts","./ReferralContent.ts","./Sound.ts","./recharge-service.ts","./telegram-wallet-manager.ts","./telegram-wallet-test.ts","./telegram-wallet-ui.ts","./usdt-balance-test.ts","./Topup.ts","./TopupContent.ts","./Treasure.ts","./telegram-web.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Manager.ts",["cc","./index.mjs_cjs=&original=.js","./telegram-web.ts","./index.ts","./index.js"],(function(t){var a,e,i,s,n,o,r;return{setters:[function(t){a=t.cclegacy,e=t._decorator,i=t.Component,s=t.director},null,function(t){n=t.TelegramWebApp},function(t){o=t.TonConnectUI},function(t){r=t.default}],execute:function(){var l,c;a._RF.push({},"41798Vh5AdLzKfhi5FR0TwY","Manager",void 0);const{ccclass:h}=e;t("Manager",h("Manager")(((c=class t extends i{constructor(){super(...arguments),this.connectUI=null,this.walletInitError=null,this.walletInitErrorDetails=null}static getInstance(){return t.instance}static onWalletStatusChange(a){t.walletStatusChangeCallbacks.push(a)}static offWalletStatusChange(a){const e=t.walletStatusChangeCallbacks.indexOf(a);e>-1&&t.walletStatusChangeCallbacks.splice(e,1)}static notifyWalletStatusChange(){t.walletStatusChangeCallbacks.forEach((t=>{try{t()}catch(t){console.error("钱包状态变化回调执行失败:",t)}}))}async onLoad(){t.instance?this.destroy():(t.instance=this,s.addPersistRootNode(this.node),this.initWallet().catch((t=>console.error("钱包初始化失败:",t))),this.loadBaseData(),this.initTGUser())}postTest(t){let a={message:t};this.post("https://api.xdiving.io/api/test/simple/log",a,(t=>{console.log(a)}),(t=>{console.log(`测试数据POST失败: ${t}`)}))}getTest(t){this.get("https://api.xdiving.io/api/test/simple/array/"+t.toString(),(t=>{console.log(t)}),(t=>{console.log(`测试数据GET失败: ${t}`)}))}getData(t,a,e,i){this.get(t,(t=>{console.log(e+"数据:",t),a(t),i&&i()}),(t=>{console.log(e+`数据GET失败: ${t}`)}))}loadBaseData(){this.getData("https://api.xdiving.io/api/fish/list",(a=>t.fishBaseData=a),"鱼基础",(()=>{})),this.getData("https://api.xdiving.io/api/equipment/list",(a=>t.equipmentBaseData=a),"装备基础",(()=>this.initEquipment())),this.getData("https://api.xdiving.io/api/prop/list",(a=>t.propBaseData=a),"道具基础",(()=>{})),this.getData("https://api.xdiving.io/api/treasure/list",(a=>t.treasureBaseData=a),"宝箱基础",(()=>{})),this.getData("https://api.xdiving.io/api/shop/list",(a=>t.topupBaseData=a),"商城基础",(()=>{})),this.getData("https://api.xdiving.io/api/rarity/all",(a=>t.rarityBaseData=a),"稀有度基础",(()=>this.initRarity())),this.getData("https://api.xdiving.io/api/quest/all",(a=>t.questBaseData=a),"任务基础",(()=>{})),this.getData("https://api.xdiving.io/api/level/all",(a=>t.levelBaseData=a),"等级基础",(()=>{}))}initTGUser(){t.initRequest={initData:r.default.initData},this.initUser()}initFakeUser(a){this.postTest("ready to initFakeUser"),t.initRequest={initData:"query_id=test123&user=%7B%22id%22%3A"+a+"%2C%22first_name%22%3A%22John%22%2C%22last_name%22%3A%22Doe%22%2C%22username%22%3A%22johndoe%22%2C%22language_code%22%3A%22en%22%7D&auth_date=1662771648&hash=test"},this.initUser()}initUser(){this.post("https://api.xdiving.io/api/game/init",t.initRequest,(a=>{console.log("初始化数据:",a),t.initRespond=a,console.log(t.initRequest),t.accessToken=a.data.accessToken,console.log(t.accessToken),this.loadAllUserData(a.data.user.userId),console.log(a.data.user.userId)}),(t=>{console.log(`'初始化数据POST失败: ${t}`)}))}addFinish(){t.loadFinish++}getFinish(){return 8==t.loadFinish}loadAllUserData(a){this.getData("https://api.xdiving.io/api/user/basic-info",(a=>t.userData=a),"用户",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/equipment/user/"+a.toString(),(a=>t.equipmentData=a),"装备",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/fish-catch/user/"+a.toString()+"/box",(a=>t.boxData=a),"鱼箱",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/prop/user/"+a.toString(),(a=>t.propData=a),"道具",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/checkin/status/"+a.toString(),(a=>t.checkInData=a),"签到",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/invitation/user/"+a.toString()+"/code",(a=>t.inviteCodeData=a),"邀请码",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/invitation/user/"+a.toString()+"/invitees",(a=>t.inviteUserData=a),"邀请人",(()=>this.addFinish())),this.getData("https://api.xdiving.io/api/quest/user/list",(a=>t.questData=a),"任务",(()=>this.addFinish()))}initEquipment(){for(let a=0;a<t.equipmentBaseData.data.length;a++)"Harpoon"==t.equipmentBaseData.data[a].equipmentNameEn&&t.harpoons.push({attribute:t.equipmentBaseData.data[a].baseAttribute,cost:t.equipmentBaseData.data[a].upgradeCostGold}),"Tank"==t.equipmentBaseData.data[a].equipmentNameEn&&t.tanks.push({attribute:t.equipmentBaseData.data[a].baseAttribute,cost:t.equipmentBaseData.data[a].upgradeCostGold}),"Box"==t.equipmentBaseData.data[a].equipmentNameEn&&t.boxs.push({attribute:t.equipmentBaseData.data[a].baseAttribute,cost:t.equipmentBaseData.data[a].upgradeCostGold})}initRarity(){for(let a=0;a<t.rarityBaseData.data.length;a++){let e=t.totalRarity+t.rarityBaseData.data[a].frequency;t.totalRarity=e,t.actualRarity.push(e)}}request(a){const e=new XMLHttpRequest;if(e.open(a.method,a.url),"POST"!==a.method&&"PUT"!==a.method||e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.accessToken&&e.setRequestHeader("Authorization",`Bearer ${t.accessToken}`),a.headers)for(const t in a.headers)e.setRequestHeader(t,a.headers[t]);e.responseType="text",console.log(e.responseText),e.onload=()=>{if(e.status>=200&&e.status<300)try{const t=JSON.parse(e.responseText);a.onSuccess(t)}catch(t){a.onError("JSON解析错误: "+t)}else a.onError(`HTTP错误: ${e.status}`)},e.onerror=()=>{a.onError("网络错误")},e.ontimeout=()=>{a.onError("请求超时")},a.data?e.send(JSON.stringify(a.data)):e.send()}get(t,a,e){this.request({url:t,method:"GET",onSuccess:a,onError:e||(t=>console.error("GET请求失败:",t))})}post(t,a,e,i){this.request({url:t,method:"POST",data:a,onSuccess:e,onError:i||(t=>console.error("POST请求失败:",t))})}put(t,a,e,i){this.request({url:t,method:"PUT",data:a,onSuccess:e,onError:i||(t=>console.error("PUT请求失败:",t))})}async initWallet(){this.walletInitError=null,this.walletInitErrorDetails=null;try{const a=await n.Instance.init();console.log("Telegram initialized:",a.success),a.success||(this.walletInitError="Telegram initialization failed",this.walletInitErrorDetails={step:"Telegram init",result:a},t.notifyWalletStatusChange())}catch(a){console.error("Telegram initialization failed:",a),this.walletInitError="Telegram initialization failed",this.walletInitErrorDetails={step:"Telegram init",error:a?.toString()||String(a),stack:a?.stack},t.notifyWalletStatusChange()}try{this.connectUI=new o({manifestUrl:"https://ton-connect.github.io/demo-dapp-with-wallet/tonconnect-manifest.json"}),this.connectUI.onStatusChange((()=>{console.log("Wallet status changed:",this.connectUI?.connected?"Connected":"Disconnected"),t.notifyWalletStatusChange()})),console.log("Wallet initialized successfully"),this.walletInitError=null,this.walletInitErrorDetails=null,t.notifyWalletStatusChange()}catch(a){console.error("Wallet initialization failed:",a),this.walletInitError="Wallet initialization failed",this.walletInitErrorDetails={step:"TonConnectUI init",error:a?.toString()||String(a),message:a?.message,stack:a?.stack,name:a?.name},t.notifyWalletStatusChange()}}connectWallet(){this.connectUI?this.connectUI.connected?this.connectUI.disconnect():this.connectUI.openModal():console.log("Wallet not initialized")}isWalletConnected(){return this.connectUI?.connected||!1}getWalletAddress(){return this.connectUI?.connected&&this.connectUI.account?.address?this.connectUI.account.address:null}getConnectUI(){return this.connectUI}getWalletInitError(){return this.walletInitError}getWalletInitErrorDetails(){return this.walletInitErrorDetails}async sendTransaction(t){if(!this.connectUI)throw new Error("Wallet not initialized");if(!this.connectUI.connected)throw new Error("Wallet not connected");return await this.connectUI.sendTransaction(t)}async parseTransactionHash(t){try{const a=await fetch("https://tonapi.io/v2/boc/parse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boc:t})});if(a.ok){const t=await a.json(),e=t.hash||t.tx_hash||t.transaction_hash;if(e)return e}}catch(t){console.error("解析 BOC 失败:",t)}try{const t=this.getWalletAddress();if(t){let a=t;if(a.startsWith("0:")||a.startsWith("-1:")){const t=await fetch(`https://tonapi.io/v2/accounts/${encodeURIComponent(a)}/transactions?limit=1`);if(t.ok){const a=await t.json();if(a.transactions&&a.transactions.length>0){const t=a.transactions[0];return t.hash||t.tx_hash||null}}}else{const t=await fetch(`https://tonapi.io/v2/accounts/${a}/transactions?limit=1`);if(t.ok){const a=await t.json();if(a.transactions&&a.transactions.length>0){const t=a.transactions[0];return t.hash||t.tx_hash||null}}}}}catch(t){console.error("查询交易历史失败:",t)}return null}}).instance=null,c.fishBaseData=void 0,c.equipmentBaseData=void 0,c.propBaseData=void 0,c.treasureBaseData=void 0,c.topupBaseData=void 0,c.rarityBaseData=void 0,c.questBaseData=void 0,c.levelBaseData=void 0,c.setData={BGMopen:!0,BGSopen:!1},c.checkIn={},c.changeNameData={displayUsername:""},c.startData={},c.endData=void 0,c.sellFishData=void 0,c.upgradeData={equipmentId:1},c.boxData=void 0,c.equipmentData=void 0,c.propData=void 0,c.checkInData=void 0,c.userData=void 0,c.questData=void 0,c.inviteUserData=void 0,c.inviteCodeData=void 0,c.harpoons=[],c.tanks=[],c.boxs=[],c.totalRarity=0,c.actualRarity=[],c.loaded=!1,c.initRequest=void 0,c.initRespond=void 0,c.loadFinish=0,c.accessToken=void 0,c.walletStatusChangeCallbacks=[],l=c))||l);a._RF.pop()}}}));

System.register("chunks:///_virtual/Menu.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./CheckInContent.ts","./Sound.ts","./GeneralUI.ts","./PropContent.ts"],(function(i){var t,e,n,s,a,o,r,h,l,p,c,u,d,f,m,g;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.initializerDefineProperty},function(i){n=i.cclegacy,s=i.Node,a=i.Sprite,o=i.Label,r=i._decorator,h=i.Component,l=i.Vec3,p=i.director,c=i.Color},function(i){u=i.Manager},function(i){d=i.CheckInContent},function(i){f=i.Sound},function(i){m=i.GeneralUI},function(i){g=i.PropContent}],execute:function(){var b,y,S,O,v,w,k,M,F,z,C,D,T,P,N,I,A,E,R,U,G,L,x,B,Z,H,q,_,j,Q,V,W,X,J,K,Y,$,ii,ti,ei,ni,si,ai,oi,ri,hi,li,pi,ci,ui,di,fi,mi,gi,bi;n._RF.push({},"128f5SmRXRAv7o0vUg1Wzib","Menu",void 0);const{ccclass:yi,property:Si}=r;i("Menu",(b=yi("Menu"),y=Si(m),S=Si(s),O=Si(s),v=Si(s),w=Si(s),k=Si(s),M=Si(s),F=Si(s),z=Si(s),C=Si(s),D=Si(s),T=Si(a),P=Si(a),N=Si(s),I=Si(s),A=Si(o),E=Si(s),R=Si(s),U=Si(o),G=Si(o),L=Si(o),x=Si(o),B=Si(o),Z=Si(o),H=Si(s),q=Si(s),b((Q=t((j=class extends h{constructor(){super(...arguments),e(this,"generalUI",Q,this),e(this,"standMan",V,this),e(this,"walkMan",W,this),e(this,"dropShip",X,this),e(this,"risingShip",J,this),e(this,"riseShip",K,this),e(this,"noEmpty",Y,this),e(this,"blackFrame",$,this),e(this,"comingSoonFrame",ii,this),e(this,"checkInFrame",ti,this),e(this,"checkInContentNode",ei,this),e(this,"goFishingSprite",ni,this),e(this,"goFishingSprite2",si,this),e(this,"chooseMapNode",ai,this),e(this,"chooseMapNode2",oi,this),e(this,"availableDives",ri,this),e(this,"propFrame",hi,this),e(this,"propContentNode",li,this),e(this,"test1",pi,this),e(this,"test2",ci,this),e(this,"test3",ui,this),e(this,"test4",di,this),e(this,"test5",fi,this),e(this,"test6",mi,this),e(this,"guideGround",gi,this),e(this,"finger",bi,this),this.manOrigin=l.ZERO,this.manOffset=l.ZERO,this.walkOrigin=l.ZERO,this.shipOrigin=l.ZERO,this.shipOffset=l.ZERO,this.riseOrigin=l.ZERO,this.step=0,this.shakeUp=1,this.shakeTimer=0,this.stepTimer=0,this.mapChosed=!1,this.displayTimer=2,this.comingSoonTimer=1}start(){f.instance.moveAudio.stop(),f.instance.stayAudio.stop(),f.instance.boostAudio.stop(),this.manOrigin=this.standMan.position.clone(),this.walkOrigin=this.walkMan.position.clone(),this.shipOrigin=this.dropShip.position.clone(),this.riseOrigin=this.riseShip.position.clone(),p.preloadScene("Box"),p.preloadScene("Equip"),p.preloadScene("Referral"),p.preloadScene("Load"),p.preloadScene("Game"),this.initProp(),this.updateDataDisplay()}initProp(){for(let i=0;i<this.propContentNode.children.length;i++){let t=this.propContentNode.children[i].getComponent(g);t.index=i,t.menu=this,t.nameLabel.string=u.propBaseData.data[i].propNameEn,t.costLabel.string=u.propBaseData.data[i].costGold.toString(),t.descriptionLabel.string=u.propBaseData.data[i].description.replace("@",u.propBaseData.data[i].value.toString()),t.updateDataDisplay()}}updateDataDisplay(){this.generalUI.updateDisplay(),this.generalUI.updateLevel(),this.availableDives.string="Available dives:"+u.userData.data.remainingRounds.toString();for(const i of this.checkInContentNode.children)i.getComponent(d).updateCheckIn();for(const i of this.propContentNode.children)i.getComponent(g).updateDataDisplay()}update(i){this.blackFrame.active&&(this.displayTimer>0?this.displayTimer-=i:this.blackFrame.active=!1),this.comingSoonFrame.active&&(this.comingSoonTimer>0?this.comingSoonTimer-=i:this.comingSoonFrame.active=!1),this.shipOffset=this.shipOffset.clone().add(new l(0,this.shakeUp*i*20,0)),this.shakeTimer+=this.shakeUp*i,this.shakeTimer>.5&&(this.shakeUp=-1),this.shakeTimer<-.5&&(this.shakeUp=1),0==this.step&&this.dropShip.setPosition(this.shipOrigin.clone().add(this.shipOffset)),1==this.step&&(this.manOffset=this.manOffset.clone().add(new l(200*i,0,0)),this.dropShip.setPosition(this.shipOrigin.clone().add(this.shipOffset)),this.stepTimer+=i,this.stepTimer<.5?this.walkMan.setPosition(this.walkOrigin.clone().add(this.manOffset)):this.walkMan.setPosition(this.walkOrigin.clone().add(this.manOffset).add(this.shipOffset)),this.stepTimer>1&&(this.stepTimer=0,this.step=2,this.standMan.setPosition(this.manOrigin.clone().add(this.manOffset).add(this.shipOffset)),this.risingShip.setPosition(this.shipOrigin.clone().add(this.shipOffset)),this.standMan.active=!0,this.walkMan.active=!1,this.risingShip.active=!0,this.dropShip.active=!1,u.userData.data.guideFinish?this.chooseMapNode.active=!0:this.chooseMapNode2.active=!0)),2==this.step&&(this.standMan.setPosition(this.manOrigin.clone().add(this.manOffset).add(this.shipOffset)),this.risingShip.setPosition(this.shipOrigin.clone().add(this.shipOffset)),this.stepTimer+=i,this.stepTimer>.9&&(this.stepTimer=0,this.step=3,this.riseShip.setPosition(this.riseOrigin.clone().add(this.shipOffset)),this.risingShip.active=!1,this.riseShip.active=!0)),3==this.step&&(this.standMan.setPosition(this.manOrigin.clone().add(this.manOffset).add(this.shipOffset)),this.riseShip.setPosition(this.riseOrigin.clone().add(this.shipOffset)),this.mapChosed&&(this.step=4)),4==this.step&&(this.shipOffset=this.shipOffset.clone().add(new l(400*i,0,0)),this.standMan.setPosition(this.manOrigin.clone().add(this.manOffset).add(this.shipOffset)),this.riseShip.setPosition(this.riseOrigin.clone().add(this.shipOffset)),this.stepTimer+=i,this.stepTimer>1.25&&(this.stepTimer=-100,u.loaded?p.loadScene("Game"):(u.loaded=!0,p.loadScene("Load"))))}noEmptyHide(){f.instance.buttonAudio.play(),this.noEmpty.active=!1}comingSoonHide(){this.comingSoonFrame.active=!0,this.comingSoonTimer=1}Gofishing(){if(0==this.step)if(f.instance.buttonAudio.play(),0==u.userData.data.guideFinish&&(this.finger.active=!0),0==u.boxData.data.length)if(u.userData.data.remainingRounds>0){this.goFishingSprite2.node.active=!1;const i=this.goFishingSprite.color;this.goFishingSprite.color=new c(i.a,i.g,i.b,128),this.step=1,this.walkMan.setPosition(this.manOrigin.clone().add(this.manOffset)),this.standMan.active=!1,this.walkMan.active=!0}else this.blackFrame.active=!0,this.displayTimer=2;else this.noEmpty.active=!0}chooseMap(){0==this.mapChosed&&(f.instance.buttonAudio.play(),this.mapChosed=!0,this.chooseMapNode.active=!1,this.chooseMapNode2.active=!1)}referral(){f.instance.buttonAudio.play(),p.loadScene("Referral")}box(){f.instance.buttonAudio.play(),p.loadScene("Box")}equip(){f.instance.buttonAudio.play(),p.loadScene("Equip")}topup(){f.instance.buttonAudio.play(),p.loadScene("Topup")}quest(){f.instance.buttonAudio.play(),p.loadScene("Quest")}propHide(){f.instance.buttonAudio.play(),this.propFrame.active=!this.propFrame.active}checkInHide(){f.instance.buttonAudio.play(),this.checkInFrame.active=!this.checkInFrame.active}}).prototype,"generalUI",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(j.prototype,"standMan",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(j.prototype,"walkMan",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(j.prototype,"dropShip",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(j.prototype,"risingShip",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(j.prototype,"riseShip",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(j.prototype,"noEmpty",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(j.prototype,"blackFrame",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=t(j.prototype,"comingSoonFrame",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ti=t(j.prototype,"checkInFrame",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ei=t(j.prototype,"checkInContentNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ni=t(j.prototype,"goFishingSprite",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),si=t(j.prototype,"goFishingSprite2",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ai=t(j.prototype,"chooseMapNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=t(j.prototype,"chooseMapNode2",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ri=t(j.prototype,"availableDives",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hi=t(j.prototype,"propFrame",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),li=t(j.prototype,"propContentNode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pi=t(j.prototype,"test1",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ci=t(j.prototype,"test2",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ui=t(j.prototype,"test3",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),di=t(j.prototype,"test4",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fi=t(j.prototype,"test5",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mi=t(j.prototype,"test6",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gi=t(j.prototype,"guideGround",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi=t(j.prototype,"finger",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=j))||_));n._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Joystick.ts","./Game.ts","./Fish.ts","./GifPlayer.ts","./Manager.ts","./Sound.ts","./GameContent.ts","./CameraFollow.ts"],(function(t){var e,i,a,s,o,r,n,h,l,c,u,p,d,g,m,b,y,f,v,S,w,T,x,D,k,B,F,P,C,A,M;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){a=t.cclegacy,s=t.Node,o=t.sp,r=t.ProgressBar,n=t.Sprite,h=t.Label,l=t.SpriteFrame,c=t._decorator,u=t.Component,p=t.Vec3,d=t.SystemEventType,g=t.UITransform,m=t.director,b=t.Size,y=t.misc,f=t.randomRange,v=t.view,S=t.instantiate,w=t.math,T=t.color},function(t){x=t.SpeedType,D=t.instance},function(t){k=t.Game},function(t){B=t.Fish},function(t){F=t.GifPlayer},function(t){P=t.Manager},function(t){C=t.Sound},function(t){A=t.GameContent},function(t){M=t.CameraFollow}],execute:function(){var z,N,E,I,L,G,R,O,W,q,H,V,Q,_,U,$,J,K,j,Y,X,Z,tt,et,it,at,st,ot,rt,nt,ht,lt,ct,ut,pt,dt,gt,mt,bt,yt,ft,vt,St,wt,Tt,xt,Dt,kt,Bt,Ft,Pt,Ct,At,Mt,zt,Nt,Et,It,Lt,Gt,Rt,Ot,Wt,qt,Ht,Vt,Qt,_t,Ut,$t,Jt,Kt,jt,Yt,Xt,Zt,te,ee,ie,ae,se,oe,re,ne,he,le,ce,ue,pe,de,ge,me,be,ye,fe,ve,Se,we,Te,xe,De,ke,Be;a._RF.push({},"ba452nnVcJMPYIauwJ4Favx","Player",void 0);const{ccclass:Fe,property:Pe}=c;let Ce=t("PlayerState",function(t){return t[t.DIVE=0]="DIVE",t[t.MOVE=1]="MOVE",t[t.SHOOT=2]="SHOOT",t[t.CATCH=3]="CATCH",t[t.RETRACT=4]="RETRACT",t[t.DIE=5]="DIE",t[t.WIN=6]="WIN",t}({}));t("default",(z=Fe("Player"),N=Pe(k),E=Pe(s),I=Pe(s),L=Pe(s),G=Pe(s),R=Pe(s),O=Pe(s),W=Pe(s),q=Pe(s),H=Pe(s),V=Pe(s),Q=Pe(s),_=Pe(o.Skeleton),U=Pe(s),$=Pe(s),J=Pe(s),K=Pe(s),j=Pe(r),Y=Pe(s),X=Pe(s),Z=Pe(s),tt=Pe(s),et=Pe(n),it=Pe(h),at=Pe(h),st=Pe(h),ot=Pe(s),rt=Pe(s),nt=Pe(s),ht=Pe(n),lt=Pe([l]),ct=Pe(h),ut=Pe(h),pt=Pe(h),dt=Pe(h),gt=Pe(h),mt=Pe(h),bt=Pe(s),yt=Pe(s),ft=Pe(s),vt=Pe(s),St=Pe(s),wt=Pe(s),Tt=Pe(s),xt=Pe(s),Dt=Pe(s),kt=Pe(s),Bt=Pe(s),Ft=Pe(s),Pt=Pe(n),z((Mt=e((At=class extends u{constructor(){super(...arguments),i(this,"game",Mt,this),i(this,"map",zt,this),i(this,"moveBody",Nt,this),i(this,"shootBody",Et,this),i(this,"catchBody",It,this),i(this,"retractBody",Lt,this),i(this,"boostBody",Gt,this),i(this,"dyingBody",Rt,this),i(this,"diveBody",Ot,this),i(this,"light",Wt,this),i(this,"harpoon",qt,this),i(this,"rope",Ht,this),i(this,"bloodSkeleton",Vt,this),i(this,"boostFollow",Qt,this),i(this,"boostCanvas",_t,this),i(this,"weaponMask",Ut,this),i(this,"bar",$t,this),i(this,"pBar",Jt,this),i(this,"fishBar",Kt,this),i(this,"overFrame",jt,this),i(this,"deathFrame",Yt,this),i(this,"catchFrame",Xt,this),i(this,"catchSprite",Zt,this),i(this,"catchNameLabel",te,this),i(this,"catchWeightLabel",ee,this),i(this,"catchRarityLabel",ie,this),i(this,"treasureFrame",ae,this),i(this,"treasureGold",se,this),i(this,"treasureProp",oe,this),i(this,"treasurePropSprite",re,this),i(this,"treasurePropSprites",ne,this),i(this,"treasureCoinNumLabel",he,this),i(this,"treasureCoinNumLabel2",le,this),i(this,"treasurePropNumLabel",ce,this),i(this,"boxWeightLabel",ue,this),i(this,"depthNumLabel",pe,this),i(this,"oxygenNumLabel",de,this),i(this,"openMap",ge,this),i(this,"littleMap",me,this),i(this,"littlePos",be,this),this.cur=0,i(this,"guideGround",ye,this),i(this,"guide1",fe,this),i(this,"guide2",ve,this),i(this,"guide3",Se,this),i(this,"guide31",we,this),i(this,"guide32",Te,this),i(this,"guide4",xe,this),i(this,"guide5",De,this),i(this,"blackFrame",ke,this),i(this,"blackGround",Be,this),this.catchFishDatas=[],this.depth=0,this.maxDepth=0,this.boxWeight=0,this.boxMaxWeight=30,this.oxygen=120,this.maxOxygen=120,this.attack=1,this.baseAttack=1,this.hammerAttack=1,this.hammerTimer=0,this.boostTimer=20,this.playerState=Ce.DIVE,this._speedType=x.STOP,this.moveDir=new p(0,1,0),this._moveSpeed=0,this.fastSpeed=187,this.baseSpeed=187,this.multiplier=1,this.boosting=1,this.overWeight=1,this.fishIdentifer=0,this.harpoonOrigin=new p,this.ropeLong=0,this.ropeUT=null,this.catchProgress=.3,this.catchingFish=null,this.catchSuccess=!0,this.catchDifficulty=.3,this.originScale=void 0,this.reverseScale=void 0,this.diveTimer=0,this.shootTimer=0,this.retractTimer=.3,this.guideTimer=1,this.displayTimer=1,this.dieTimer=0,this.backTimer=0,this.blackDisplayTimer=2,this.blackGroundA=0,this.consuming=!1,this.oxygenEnough=!0,this.redFrameARise=!0,this.redFrameA=0,this.confirm=!1,this.userId=1,this.catchSwordfish=!1,this.firstWin=!0,this.firstDie=!0,this.bloodTimer=0}test1(){this.multiplier=1,this.setFastSpeed()}test4(){this.multiplier=4,this.setFastSpeed()}test16(){this.multiplier=16,this.setFastSpeed()}onLoad(){D.on(d.TOUCH_MOVE,this.onTouchMove,this),D.on(d.TOUCH_END,this.onTouchEnd,this)}start(){C.instance.BGM.pause(),P.userData.data.remainingRounds-=1,this.finishQuest(15),this.userId=P.userData.data.userId;let t="https://api.xdiving.io/api/diving-session/user/"+this.userId.toString()+"/game-start/"+1..toString();P.getInstance().post(t,P.startData,(t=>{console.log("开始数据:",t),console.log(P.startData)}),(t=>{console.log(`'开始数据POST失败: ${t}`)})),P.endData={userId:1,catches:[],treasures:[],maxDepth:0,endReason:"",mainPropId:1},this.harpoonOrigin=this.harpoon.getPosition(),this.ropeUT=this.rope.getComponent(g),this.harpoon.active=!1,this.rope.active=!1,this.bar.active=!1,this.catchFrame.active=!1,this.overFrame.active=!1,this.deathFrame.active=!1,this.originScale=new p(this.node.scale.x,this.node.scale.y,1),this.reverseScale=new p(this.node.scale.x,-this.node.scale.y,1),this.baseAttack=P.harpoons[P.equipmentData.data[0].level-1].attribute,this.oxygen=P.tanks[P.equipmentData.data[1].level-1].attribute,this.boxMaxWeight=P.boxs[P.equipmentData.data[2].level-1].attribute,this.setAttack(),this.maxOxygen=this.oxygen,this.oxygenNumLabel.string=this.oxygen.toString(),this.boxWeightLabel.string="0/"+this.boxMaxWeight.toString()+"KG",0==P.userData.data.guideFinish&&(this.guideGround.active=!0)}onTouchMove(t,e){this.playerState==Ce.MOVE&&(3==this.cur&&this.guide31.active&&(this.guide31.active=!1,this.guide32.active=!0),this._speedType=e.speedType,this.moveDir=e.moveVec,this.onSetMoveSpeed(this._speedType))}onTouchEnd(t,e){this.playerState==Ce.MOVE&&(C.instance.shootAudio.play(),3==this.cur&&(this.guide3.active=!1,this.cur++),this.shootTimer=0,this.playerState=Ce.SHOOT,this.shootBody.active=!0,this.shootBody.getComponent(F).index=0,this.moveBody.active=!1,this.boostBody.active=!1,this.harpoon.active=!0,this.rope.active=!0,this.light.active=!1,this._speedType=e.speedType,this.onSetMoveSpeed(this._speedType)),this.playerState==Ce.CATCH&&this.catch()}onSetMoveSpeed(t){switch(t){case x.STOP:this._moveSpeed=0;break;case x.NORMAL:case x.FAST:this._moveSpeed=this.fastSpeed}}dive(t){this.diveTimer+=t,this.diveTimer>2.5&&(this.moveBody.active=!0,this.diveBody.active=!1,this.light.active=!0,this.diveTimer=0,this.playerState=Ce.MOVE,0==P.userData.data.guideFinish?(this.cur++,this.guide1.active=!0):this.consuming=!0)}next(){1==this.cur?(C.instance.buttonAudio.play(),this.guide1.active=!1,this.guide2.active=!0,this.cur++):2==this.cur&&(C.instance.buttonAudio.play(),this.guide2.active=!1,this.guide3.active=!0,this.guideGround.active=!1,this.consuming=!0,this.cur++)}useProp(t){switch(t){case 0:this.pulse();break;case 1:0==this.hammerTimer&&this.hammer();break;case 2:1==this.boosting&&this.boost();break;case 3:this.firstWin&&this.capsule()}}consumeProp(t){return P.propData.data[t].quantity>0&&(C.instance.boostAudio.play(),P.propData.data[t].quantity--,this.game.curPropContent.getComponent(A).propNumLabel.string="x"+P.propData.data[t].quantity.toString(),P.getInstance().post("https://api.xdiving.io/api/prop/consume",{propId:t+1},(e=>{console.log("使用道具:",e),console.log(t+1)}),(t=>{console.log(`使用道具失败: ${t}`)})),!0)}pulse(){if(this.consumeProp(0)){m.getScene()?.getComponentInChildren(M)?.shake(20);const t=600,e=this.node.position;for(const i of this.game.fishesNode.children){const a=i.position,s=i.getComponent(B).utSize,r=e.x-a.x-s,n=e.y-a.y-s;Math.sqrt(r*r+n*n)<=t&&(i.getComponent(B).waitingTimer=3,i.getComponent(B).stunTimer=3,i.getComponent(B).stunHint.active=!0,i.getComponent(o.Skeleton).timeScale=0)}}}hammer(){this.consumeProp(1)&&(this.hammerTimer=5,this.hammerAttack=2,this.weaponMask.active=!0,this.weaponMask.getComponent(g).setContentSize(new b(200,180)),this.setAttack())}boost(){this.consumeProp(2)&&(this.boosting=2,this.setFastSpeed(),this.boostFollow.active=!0,this.boostCanvas.active=!0,this.moveBody.active&&(this.moveBody.active=!1,this.boostBody.active=!0),this.finishQuest(5))}capsule(){this.consumeProp(3)&&(this.firstWin=!1,this.back())}move(t){this.node.angle=y.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x)),this.node.angle>90&&this.node.angle<270||this.node.angle<-90?this.node.scale=this.reverseScale:this.node.scale=this.originScale;const e=this.node.getPosition(),i=this.node.getPosition().add(this.moveDir.clone().multiplyScalar(this._moveSpeed*t));let a=!0,s=!0;for(const t of this.game.wallBoundarys)i.x>t.left&&i.x<t.right&&i.y<t.up&&i.y>t.down&&((e.x<t.left||e.x>t.right)&&(a=!1),(e.y<t.down||e.y>t.up)&&(s=!1));a&&this.node.setPosition(i.x,this.node.y,0),s&&this.node.setPosition(this.node.x,i.y,0);for(let t=0;t<this.game.treasures.length;t++)if(this.game.treasures[t].close.active){const e=this.game.treasureBoundarys[t];if(i.x>e.left&&i.x<e.right&&i.y<e.up&&i.y>e.down){this.game.treasures[t].close.active=!1,this.game.treasures[t].opening.active=!0;let e=Math.round(f(.8,1.2)*P.treasureBaseData.data[t].coins),i=Math.floor(f(250,P.treasureBaseData.data[t].coins)),a=Math.floor(f(0,P.propBaseData.data.length)),s=Math.floor(i/P.propBaseData.data[a].costGold),o=e-s*P.propBaseData.data[a].costGold;return P.endData.treasures.push({rewardType:"Gold",quantity:o}),s>0?(P.endData.treasures.push({rewardType:P.propBaseData.data[a].propNameEn,quantity:s}),this.treasureGold.active=!1,this.treasureProp.active=!0,this.treasurePropSprite.spriteFrame=this.treasurePropSprites[a],this.treasureCoinNumLabel.string=o.toString(),this.treasurePropNumLabel.string=s.toString()):(this.treasureProp.active=!1,this.treasureGold.active=!0,this.treasureCoinNumLabel2.string=e.toString()),this.catchFrame.active=!1,this.treasureFrame.active=!0,C.instance.treasureAudio.play(),void this.finishQuest(3)}}this.depth=Math.round(-(this.node.position.y-4660)/60),this.depthNumLabel.string=this.depth+"m",this.littleMap.active&&this.littlePos.setPosition(new p(.02*this.node.position.x,.02*this.node.position.y-96,0)),this.depth>this.maxDepth&&(this.maxDepth=this.depth,P.questData.data[7].progress<this.depth&&this.finishQuest(7),P.questData.data[14].progress<this.depth&&this.finishQuest(14)),this.depth<1&&this.firstWin&&(this.firstWin=!1,this.back())}shoot(t){if(this.shootTimer<.3)this.shootTimer+=t;else{if(this.setharpoon(3e3*t),this.ropeLong>600)return void(this.playerState=Ce.RETRACT);let e=this.harpoon.getWorldPosition().add(new p(-this.map.position.x,-this.map.position.y,0)).add(new p(-v.getVisibleSize().width/2,-v.getVisibleSize().height/2,0));for(const t of this.game.wallBoundarys)if(e.x>t.left&&e.x<t.right&&e.y<t.up&&e.y>t.down)return void(this.playerState=Ce.RETRACT);for(const t of this.game.fishesNode.children){const i=t.position,a=t.getComponent(B).utSize,s=e.x-i.x,o=e.y-i.y;if(Math.sqrt(s*s+o*o)<=1.1*a){this.catchingFish=t;const e=this.catchingFish.getComponent(B);if(e.health>this.attack){if(this.playerState=Ce.RETRACT,e.attack>0&&!e.attacking){const i=this.node.position.x-t.position.x,a=this.node.position.y-t.position.y;let s=Math.atan2(-a,-i);t.angle=y.radiansToDegrees(s)+f(-10,10),e.reverse(),e.attacking=!0,e.speed=e.maxSpeed;let o=S(this.game.attackHint);this.game.tempNode.addChild(o),e.attackHint=o}if(e.health-=this.attack,e.bloodSkeleton.node.active=!0,e.bloodSkeleton.clearTracks(),e.bloodSkeleton.setAnimation(0,"dongqilai",!1),e.bloodTimer=1,!e.healthDisplaying){let i=S(this.game.healthBar);this.game.tempNode.addChild(i),e.healthBar=i.getComponent(r),e.healthBar.node.setPosition(t.getPosition().add(new p(0,a,0))),e.healthDisplaying=!0}e.healthBar.progress=e.health/e.maxHealth,e.healthTimer=2}else this.playerState=Ce.CATCH,this.catchDifficulty=.5*this.attack/this.catchingFish.getComponent(B).maxHealth,this.catchDifficulty>.3&&(this.catchDifficulty=.3),e.healthDisplaying&&(e.healthDisplaying=!1,e.healthBar.node.destroy()),e.attacking&&e.attack>0&&(e.attacking=!1,e.attackHint.destroy()),this.bar.active=!0,this.shootBody.active=!1,this.catchBody.active=!0,e.beingCatched=!0,e.stunTimer=.1,this.setharpoon(.25*a),this.catchingFish.setPosition(this.harpoon.getWorldPosition().add(new p(-this.map.position.x,-this.map.position.y,0)).add(new p(-v.getVisibleSize().width/2,-v.getVisibleSize().height/2,0))),4==this.cur&&(this.guide4.active=!0);return void(this.hammerTimer>0&&(this.weaponMask.active=!0,this.hammerTimer-=1,this.weaponMask.getComponent(g).setContentSize(new b(200,36*this.hammerTimer)),0==this.hammerTimer&&(this.weaponMask.active=!1,this.hammerAttack=1,this.setAttack())))}}}}retract(t){this.harpoon.active?(this.setharpoon(-3e3*t),this.ropeLong<0&&(this.catchBody.active=!1,this.shootBody.active=!1,this.harpoon.active=!1,this.rope.active=!1,this.ropeLong=0,this.harpoon.setPosition(this.harpoonOrigin),this.retractBody.active=!0,this.retractBody.getComponent(F).sprite=this.retractBody.getComponent(n),this.retractBody.getComponent(F).index=0,this.retractBody.getComponent(F).sprite.spriteFrame=this.retractBody.getComponent(F).spriteFrames[0])):this.retractTimer>0?this.retractTimer-=t:(this.retractTimer=.3,this.playerState=Ce.MOVE,this.retractBody.active=!1,this.light.active=!0,2==this.boosting?this.boostBody.active=!0:this.moveBody.active=!0)}setharpoon(t){this.harpoon.setPosition(this.harpoon.getPosition().add(new p(Math.cos(this.harpoon.angle*(Math.PI/180))*t,Math.sin(this.harpoon.angle*(Math.PI/180))*t,0))),this.ropeLong+=t,this.ropeUT.contentSize=new w.Size(this.ropeLong,4),this.rope.setPosition(new p(this.ropeLong/2,this.rope.position.y))}catch(){if(this.catchProgress+=this.catchDifficulty,this.pBar.progress=this.catchProgress,this.fishBar.setPosition(new p(600*this.catchProgress-300,this.fishBar.position.y,0)),this.catchProgress>1){C.instance.catchAudio.play(),this.catchProgress=.3,this.bar.active=!1,this.playerState=Ce.RETRACT,this.catchSuccess=this.boxWeight<this.boxMaxWeight;let t=this.catchingFish.getComponent(B),e=t.index,i=P.fishBaseData.data[e],a=t.precent*i.weight;if(4==this.cur&&(this.guide4.active=!1,this.guide5.active=!0,this.cur++),this.catchSuccess){let s=0,o=0,r="",n=P.rarityBaseData.data[t.rarityIndex].rarity;0!=i.baseCoins?(s=Math.round(t.precent*i.baseCoins*P.rarityBaseData.data[t.rarityIndex].reward),r="coins",o=s):(s=Math.round(t.precent*i.baseDiamonds*P.rarityBaseData.data[t.rarityIndex].reward),r="diamonds",o=500*s),P.endData.catches.push({identifiers:this.fishIdentifer.toString(),fishNameEn:i.fishNameEn,weight:a,price:s,type:r,rarity:n}),this.fishIdentifer++,P.userData.data.experience+=o;let h=0;for(;h<10&&(h++,P.userData.data.level<P.levelBaseData.data.length)&&P.userData.data.experience>=P.levelBaseData.data[P.userData.data.level].experienceRequired;)P.userData.data.level++,P.userData.data.experience-=P.levelBaseData.data[P.userData.data.level-1].experienceRequired;this.game.generalUI.updateLevel(),P.getInstance().post("https://api.xdiving.io/api/level/add-experience",{experience:o},(t=>{console.log("增加经验:",t)}),(t=>{console.log(`增加经验失败: ${t}`)})),"Swordfish"==i.fishNameEn&&(this.catchSwordfish=!0),this.catchingFish.destroy(),this.boxWeight+=a,this.boxWeightLabel.string=Math.round(this.boxWeight).toString()+"/"+this.boxMaxWeight.toString()+"KG",this.boxWeight>this.boxMaxWeight&&(this.overWeight=1,this.boxWeightLabel.color=T(255,0,0)),this.catchWeightLabel.string=a.toFixed(2)+"KG",this.catchRarityLabel.string=n,this.catchRarityLabel.outlineColor=T(P.rarityBaseData.data[t.rarityIndex].color);let l=P.rarityBaseData.data[t.rarityIndex].size;this.catchRarityLabel.node.setScale(l,l,1),this.catchSprite.spriteFrame=this.game.fishImages[e],this.catchNameLabel.string=i.fishNameEn,this.catchFrame.active=!0,"Crucian"==i.fishNameEn&&this.finishQuest(0),"Sardine"==i.fishNameEn&&this.finishQuest(2),"Angler"==i.fishNameEn&&this.finishQuest(4),"Swordfish"==i.fishNameEn&&this.finishQuest(6),"WhaleShark"==i.fishNameEn&&this.finishQuest(8),"Flyingfish"==i.fishNameEn&&this.finishQuest(9),"Tuna"==i.fishNameEn&&this.finishQuest(10),"Octopus"==i.fishNameEn&&this.finishQuest(11),"Moonfish"==i.fishNameEn&&this.finishQuest(12),this.finishQuest(13)}else this.catchingFish.getComponent(B).beingCatched=!1,this.overFrame.active=!0}}finishQuest(t){if(P.questData.data[t].questStatus<3){P.questData.data[t].progress++,P.questData.data[t].progress>=P.questBaseData.data[t].quantity&&(P.questData.data[t].questStatus=3);const e={identifier:t+9006};P.getInstance().post("https://api.xdiving.io/api/quest/user/progress",e,(t=>{console.log("任务更新:",t),console.log(e)}),(t=>{console.log(`任务更新失败: ${t}`)}))}}barMove(t){this.catchProgress-=.1*t,this.pBar.progress=this.catchProgress,this.fishBar.setPosition(new p(600*this.catchProgress-300,this.fishBar.position.y,0)),this.catchProgress<0&&(4==this.cur&&(this.guide4.active=!1,this.guide5.active=!0,this.cur++),this.catchProgress=.3,this.bar.active=!1,this.playerState=Ce.RETRACT,this.catchingFish.getComponent(B).beingCatched=!1)}setFastSpeed(){this.fastSpeed=this.overWeight*this.boosting*this.multiplier*this.baseSpeed}setAttack(){this.attack=this.baseAttack*this.hammerAttack}mapHide(){this.openMap.active=!this.openMap.active,this.littleMap.active=!this.littleMap.active,this.littlePos.setPosition(new p(.02*this.node.position.x,.02*this.node.position.y-96,0))}hide(){C.instance.buttonAudio.play(),this.overFrame.active=!1}back(){this.consuming=!1,this.playerState=Ce.WIN,P.endData.endReason="NORMALEND",P.boxData.data=P.endData.catches,this.catchSwordfish&&(P.userData.data.swordfishCatched=!0);for(const t of P.endData.treasures)if("Gold"==t.rewardType)P.userData.data.coins+=t.quantity;else for(let e of P.propBaseData.data)if(e.propNameEn==t.rewardType){P.propData.data[e.propId-1].quantity+=t.quantity;break}this.endPost()}switchAudio(){C.instance.BGM.stop(),C.instance.BGM.play()}win(t){this.backTimer+=t,0==this.blackGround.node.active&&(C.instance.backAudio.play(),this.blackGroundA=0,this.blackGround.node.active=!0),this.blackGroundA+=160*t,this.blackGround.color=T(255,255,255,this.blackGroundA),this.backTimer>1.6&&(this.backTimer=-100,this.switchAudio(),m.loadScene("Box"))}oxygenNotIncluded(){this.playerState=Ce.DIE,this.firstDie=!1,this.consuming=!1,this.light.active=!1,this.moveBody.active=!1,this.shootBody.active=!1,this.catchBody.active=!1,this.boostBody.active=!1,this.retractBody.active=!1,this.boostFollow.active=!1,this.boostCanvas.active=!1,this.bar.active=!1,this.catchFrame.active=!1,this.treasureFrame.active=!1,this.overFrame.active=!1,this.deathFrame.active=!0,P.endData.catches=[],P.endData.treasures=[],P.endData.endReason="DEATH",this.endPost()}end(){C.instance.buttonAudio.play(),this.deathFrame.active=!1,this.confirm=!0,this.node.angle=90,this.dyingBody.active=!0}die(t){this.confirm&&(this.dieTimer+=t,this.dieTimer>1.6&&(0==this.blackGround.node.active&&(C.instance.backAudio.play(),this.blackGroundA=0,this.blackGround.node.active=!0),this.blackGroundA+=160*t,this.blackGround.color=T(255,255,255,this.blackGroundA)),this.dieTimer>3.2&&(this.dieTimer=-100,this.switchAudio(),m.loadScene("Menu")))}endPost(){P.userData.data.guideFinish=!0,P.endData.userId=this.userId,P.endData.mainPropId=this.game.curPropIndex+1,P.endData.maxDepth=this.maxDepth,P.getInstance().post("https://api.xdiving.io/api/fish-catch/game-end",P.endData,(t=>{console.log("结束数据:",t),console.log(P.endData)}),(t=>{console.log(`结束数据POST失败: ${t}`)}))}display(t){5==this.cur&&(this.guideTimer>0?this.guideTimer-=t:this.guide5.active=!1),this.catchFrame.active&&(this.displayTimer>0?this.displayTimer-=t:(this.catchFrame.active=!1,this.displayTimer=1)),this.treasureFrame.active&&(this.displayTimer>0?this.displayTimer-=t:(this.treasureFrame.active=!1,this.displayTimer=1)),this.blackFrame.active&&(this.blackDisplayTimer>0?this.blackDisplayTimer-=t:this.blackFrame.active=!1),this.oxygen<20&&(this.redFrameARise?(this.redFrameA+=255*(40-this.oxygen)/60*t,this.redFrameA>255*(40-this.oxygen)/60&&(this.redFrameARise=!1)):(this.redFrameA-=255*(40-this.oxygen)/60*t,this.redFrameA<5&&(this.redFrameARise=!0)),this.game.redFrame.color=T(255,255,255,this.redFrameA)),this.bloodSkeleton.node.active&&(this.bloodTimer>0?this.bloodTimer-=t:(this.bloodTimer=1,this.bloodSkeleton.node.active=!1))}consume(t){if(this.consuming){if(this.oxygen>0){this.oxygen-=this.multiplier*t;let e=Math.round(this.oxygen);this.oxygenNumLabel.string=e.toString(),this.oxygenEnough&&this.oxygen<this.maxOxygen/2&&(this.oxygenEnough=!1,this.blackFrame.active=!0,this.game.redOxygen.active=!0,this.game.redOxygenTimer=0)}else this.oxygenNotIncluded();2==this.boosting&&(this.boostTimer>0?this.boostTimer-=this.multiplier*t:(this.boostTimer=20,this.boosting=1,C.instance.boostAudio.stop(),this.setFastSpeed(),this.boostBody.active&&(this.moveBody.active=!0,this.boostBody.active=!1),this.boostFollow.active=!1,this.boostCanvas.active=!1))}}moveSound(){this._speedType==x.STOP?1==C.instance.moveAudio.playing&&C.instance.moveAudio.stop():0==C.instance.moveAudio.playing&&C.instance.moveAudio.play()}update(t){switch(this.playerState){case Ce.DIVE:this.dive(t);break;case Ce.MOVE:this.move(t);break;case Ce.SHOOT:this.shoot(t);break;case Ce.CATCH:this.barMove(t);break;case Ce.RETRACT:this.retract(t);break;case Ce.DIE:this.die(t);break;case Ce.WIN:this.win(t)}this.consume(t),this.display(t),this.moveSound()}}).prototype,"game",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zt=e(At.prototype,"map",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nt=e(At.prototype,"moveBody",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Et=e(At.prototype,"shootBody",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It=e(At.prototype,"catchBody",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lt=e(At.prototype,"retractBody",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gt=e(At.prototype,"boostBody",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rt=e(At.prototype,"dyingBody",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ot=e(At.prototype,"diveBody",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wt=e(At.prototype,"light",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qt=e(At.prototype,"harpoon",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ht=e(At.prototype,"rope",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vt=e(At.prototype,"bloodSkeleton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qt=e(At.prototype,"boostFollow",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_t=e(At.prototype,"boostCanvas",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ut=e(At.prototype,"weaponMask",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$t=e(At.prototype,"bar",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jt=e(At.prototype,"pBar",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kt=e(At.prototype,"fishBar",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jt=e(At.prototype,"overFrame",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yt=e(At.prototype,"deathFrame",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xt=e(At.prototype,"catchFrame",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zt=e(At.prototype,"catchSprite",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=e(At.prototype,"catchNameLabel",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=e(At.prototype,"catchWeightLabel",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=e(At.prototype,"catchRarityLabel",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=e(At.prototype,"treasureFrame",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se=e(At.prototype,"treasureGold",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oe=e(At.prototype,"treasureProp",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=e(At.prototype,"treasurePropSprite",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=e(At.prototype,"treasurePropSprites",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),he=e(At.prototype,"treasureCoinNumLabel",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=e(At.prototype,"treasureCoinNumLabel2",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=e(At.prototype,"treasurePropNumLabel",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=e(At.prototype,"boxWeightLabel",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pe=e(At.prototype,"depthNumLabel",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=e(At.prototype,"oxygenNumLabel",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=e(At.prototype,"openMap",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=e(At.prototype,"littleMap",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=e(At.prototype,"littlePos",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ye=e(At.prototype,"guideGround",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=e(At.prototype,"guide1",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=e(At.prototype,"guide2",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=e(At.prototype,"guide3",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),we=e(At.prototype,"guide31",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=e(At.prototype,"guide32",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xe=e(At.prototype,"guide4",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),De=e(At.prototype,"guide5",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ke=e(At.prototype,"blackFrame",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=e(At.prototype,"blackGround",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=At))||Ct));a._RF.pop()}}}));

System.register("chunks:///_virtual/PropContent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./Sound.ts"],(function(t){var e,a,n,i,o,r,s,l,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){n=t.cclegacy,i=t.Label,o=t._decorator,r=t.Component,s=t.color},function(t){l=t.Manager},function(t){u=t.Sound}],execute:function(){var p,c,d,b,h,y,f,g,D,L,m;n._RF.push({},"3b208Gn4ZdJ34REfEgAu5eX","PropContent",void 0);const{ccclass:x,property:P}=o;t("PropContent",(p=x("PropContent"),c=P(i),d=P(i),b=P(i),h=P(i),p((g=e((f=class extends r{constructor(){super(...arguments),a(this,"nameLabel",g,this),a(this,"costLabel",D,this),a(this,"quantityLabel",L,this),a(this,"descriptionLabel",m,this),this.menu=null,this.index=0}buyProp(){if(l.propBaseData.data[this.index].costGold<l.userData.data.coins){u.instance.buttonAudio.play(),l.userData.data.coins-=l.propBaseData.data[this.index].costGold,l.propData.data[this.index].quantity++,this.menu.updateDataDisplay();let t={userId:l.userData.data.userId,propId:this.index+1};l.getInstance().post("https://api.xdiving.io/api/prop/purchase",t,(e=>{console.log("购买数据:",e),console.log(t)}),(t=>{console.log(`购买数据POST失败: ${t}`)}))}}updateDataDisplay(){this.quantityLabel.string="Owned:"+l.propData.data[this.index].quantity.toString(),l.propBaseData.data[this.index].costGold>l.userData.data.coins&&(this.costLabel.color=s(255,0,0))}update(t){}}).prototype,"nameLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(f.prototype,"costLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(f.prototype,"quantityLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(f.prototype,"descriptionLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=f))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/Quest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Sound.ts","./GeneralUI.ts","./QuestContent.ts","./Manager.ts"],(function(e){var t,a,n,i,s,o,r,l,u,c,d,h,p,b,g,m,f,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.initializerDefineProperty},function(e){n=e.cclegacy,i=e.Prefab,s=e.Node,o=e.Label,r=e.SpriteFrame,l=e._decorator,u=e.Component,c=e.Color,d=e.director,h=e.randomRangeInt,p=e.instantiate,b=e.sys},function(e){g=e.Sound},function(e){m=e.GeneralUI},function(e){f=e.QuestContent},function(e){C=e.Manager}],execute:function(){var y,v,w,q,N,D,U,T,k,I,L,Q,S,R,A,x,z,B,G,F,P,_,M,W,j,H,X,E,$,O,Y,J,K;n._RF.push({},"743572TG+9HrLaRA9aQejPW","Quest",void 0);const{ccclass:V,property:Z}=l;e("Quest",(y=V("Quest"),v=Z(m),w=Z(i),q=Z(s),N=Z(s),D=Z(s),U=Z(o),T=Z(s),k=Z(s),I=Z(s),L=Z(o),Q=Z(s),S=Z(s),R=Z(s),A=Z(s),x=Z([r]),y((G=t((B=class extends u{constructor(){super(...arguments),a(this,"generalUI",G,this),a(this,"questContentPrefab",F,this),a(this,"tasksNode",P,this),a(this,"tasksChooseNode",_,this),a(this,"tasksUnChooseNode",M,this),a(this,"tasksLabel",W,this),a(this,"achievementNode",j,this),a(this,"achievementChooseNode",H,this),a(this,"achievementUnChooseNode",X,this),a(this,"achievementLabel",E,this),a(this,"dailyContentNode",$,this),a(this,"challengeContentNode",O,this),a(this,"partnerContentNode",Y,this),a(this,"achievementContentNode",J,this),a(this,"spriteFrames",K,this)}start(){this.generalUI.updateDisplay(),this.initQuest(),this.switchTag(!0)}switchTasks(){g.instance.buttonAudio.play(),this.switchTag(!0)}switchAchievement(){g.instance.buttonAudio.play(),this.switchTag(!1)}switchTag(e){this.tasksNode.active=e,this.tasksChooseNode.active=e,this.tasksUnChooseNode.active=!e,this.achievementNode.active=!e,this.achievementChooseNode.active=!e,this.achievementUnChooseNode.active=e,e?(this.tasksLabel.color=c.WHITE,this.achievementLabel.color=c.GRAY):(this.achievementLabel.color=c.WHITE,this.tasksLabel.color=c.GRAY)}initQuest(){let e=[],t=[],a=[];for(let n=0;n<C.questData.data.length;n++)if(C.questData.data[n].questStatus<5){C.questData.data[n].identifier;let i=this.createQuestContent(n);switch(C.questData.data[n].questStatus){case 1:case 2:t.push(i);break;case 3:a.push(i);break;case 4:e.push(i)}}this.addQuestNodesToContent(a),this.addQuestNodesToContent(t),this.addQuestNodesToContent(e)}addQuestNodesToContent(e){for(let t=0;t<e.length;t++){const a=e[t].getComponent(f);switch(C.questBaseData.data[a.index].type){case"Daily Tasks":this.dailyContentNode.addChild(e[t]);break;case"Challenge Tasks":this.challengeContentNode.addChild(e[t]);break;case"Partner Tasks":this.partnerContentNode.addChild(e[t]);break;case"Achievements":this.achievementContentNode.addChild(e[t])}}}go(e){g.instance.buttonAudio.play();let t=e.index;if(3==C.questData.data[t].questStatus){if(C.questData.data[t].questStatus=4,e.buttonLabel.string="✔",e.button.interactable=!1,"Diamond"==C.questBaseData.data[t].rewardType?C.userData.data.diamonds+=C.questBaseData.data[t].rewardQuantity:C.userData.data.coins+=C.questBaseData.data[t].rewardQuantity,this.generalUI.updateDisplay(),console.log("get"),"Achievements"==C.questBaseData.data[t].type){let e=t+1;"Achievements"==C.questBaseData.data[e].type&&(C.questData.data[e].questStatus=1,this.achievementContentNode.addChild(this.createQuestContent(e)))}let a={identifier:t+9006};C.getInstance().post("https://api.xdiving.io/api/quest/identifier",a,(e=>{console.log("任务领取:",e),console.log(a)}),(e=>{console.log(`任务领取失败: ${e}`)}))}else 1==t?d.loadScene("Equip"):16==t?this.shareToFriend(e):17==t?this.shareToGroup(e):18==t||21==t?(this.generalUI.jumpTG(),this.finishQuest(t,e)):19==t||22==t?(this.generalUI.jumpX(),this.finishQuest(t,e)):20==t?d.loadScene("Topup"):23==t||24==t?d.loadScene("Referral"):d.loadScene("Menu")}finishQuest(e,t){C.questData.data[e].progress++,C.questData.data[e].questStatus=3,t.progressLabel.string="("+C.questData.data[e].progress.toString()+"/"+C.questBaseData.data[e].quantity.toString()+")",t.buttonLabel.string="CLAIM";const a={identifier:e+9006};C.getInstance().post("https://api.xdiving.io/api/quest/user/progress",a,(e=>{console.log("任务更新:",e),console.log(a)}),(e=>{console.log(`任务更新失败: ${e}`)}))}refresh(e){g.instance.buttonAudio.play();let t=e.index,a=h(9,12),n=0;for(;n<100&&(n++,a==t);)a=h(9,12);C.questData.data[t].questStatus=5,C.questData.data[a].questStatus=1,this.challengeContentNode.removeAllChildren();let i=this.createQuestContent(a);this.challengeContentNode.addChild(i);let s={identifier:t+9006,newIdentifier:a+9006};C.getInstance().post("https://api.xdiving.io/api/quest/refresh",s,(e=>{console.log("任务刷新:",e),console.log(s)}),(e=>{console.log(`任务刷新失败: ${e}`)}))}createQuestContent(e){console.log(e);let t=p(this.questContentPrefab),a=t.getComponent(f);switch(a.quest=this,a.index=e,a.sprite.spriteFrame=this.spriteFrames[e],a.descriptLabel.string=C.questBaseData.data[e].descript.replace("@",C.questBaseData.data[e].quantity.toString()),a.progressLabel.string="("+C.questData.data[e].progress.toString()+"/"+C.questBaseData.data[e].quantity.toString()+")",a.rewardLabel.string="X "+C.questBaseData.data[e].rewardQuantity.toString(),C.questBaseData.data[e].rewardType){case"Gold":a.diamondNode.active=!1;break;case"Diamond":a.coinNode.active=!1}switch(C.questData.data[e].questStatus){case 1:a.buttonLabel.string="GO";break;case 2:a.buttonLabel.string="GO",a.refreshNode.active=!0;break;case 3:a.buttonLabel.string="CLAIM";break;case 4:a.buttonLabel.string="✔",a.button.interactable=!1}return t}update(e){}shareToFriend(e){g.instance.buttonAudio.play();const t="https://t.me/xdiving_bot/xdiving_bot?startapp="+C.inviteCodeData.data.invitationCode,a="Come and play X-Diver with me!";if(window.Telegram&&window.Telegram.WebApp){const e=window.Telegram.WebApp;if("function"==typeof e.shareUrl)try{e.shareUrl(t,a)}catch(n){console.warn("shareUrl 方法调用失败，使用备用方案:",n);const i="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);e.openTelegramLink(i)}else{const n="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);e.openTelegramLink(n)}}else{const e="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);b.openURL(e)}this.finishQuest(16,e)}shareToGroup(e){g.instance.buttonAudio.play();const t="https://t.me/xdiving_bot/xdiving_bot?startapp="+C.inviteCodeData.data.invitationCode,a="Recommend an incredibly fun game X-Diver！";if(window.Telegram&&window.Telegram.WebApp){const e=window.Telegram.WebApp;if("function"==typeof e.shareUrl)try{e.shareUrl(t,a)}catch(n){console.warn("shareUrl 方法调用失败，使用备用方案:",n);const i="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);e.openTelegramLink(i)}else{const n="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);e.openTelegramLink(n)}}else{const e="https://t.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(a);b.openURL(e)}this.finishQuest(17,e)}back(){g.instance.buttonAudio.play(),d.loadScene("Menu")}}).prototype,"generalUI",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(B.prototype,"questContentPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(B.prototype,"tasksNode",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(B.prototype,"tasksChooseNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(B.prototype,"tasksUnChooseNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(B.prototype,"tasksLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(B.prototype,"achievementNode",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(B.prototype,"achievementChooseNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(B.prototype,"achievementUnChooseNode",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(B.prototype,"achievementLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(B.prototype,"dailyContentNode",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(B.prototype,"challengeContentNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(B.prototype,"partnerContentNode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(B.prototype,"achievementContentNode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(B.prototype,"spriteFrames",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z=B))||z));n._RF.pop()}}}));

System.register("chunks:///_virtual/QuestContent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,o,l,u,s,a;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){r=e.cclegacy,n=e.Sprite,o=e.Label,l=e.Node,u=e.Button,s=e._decorator,a=e.Component}],execute:function(){var c,b,p,h,f,d,g,y,m,w,L,z,N,Q,C,v,x,_,q,D,P;r._RF.push({},"d83d0Z3xVNPTouIQnLTsVjQ","QuestContent",void 0);const{ccclass:j,property:B}=s;e("QuestContent",(c=j("QuestContent"),b=B(n),p=B(o),h=B(o),f=B(l),d=B(l),g=B(o),y=B(u),m=B(o),w=B(l),c((N=t((z=class extends a{constructor(){super(...arguments),i(this,"sprite",N,this),i(this,"descriptLabel",Q,this),i(this,"progressLabel",C,this),i(this,"coinNode",v,this),i(this,"diamondNode",x,this),i(this,"rewardLabel",_,this),i(this,"button",q,this),i(this,"buttonLabel",D,this),i(this,"refreshNode",P,this),this.quest=null,this.index=1}go(){this.quest.go(this)}refresh(){this.quest.refresh(this)}start(){}update(e){}}).prototype,"sprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(z.prototype,"descriptLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(z.prototype,"progressLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(z.prototype,"coinNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(z.prototype,"diamondNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(z.prototype,"rewardLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(z.prototype,"button",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(z.prototype,"buttonLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(z.prototype,"refreshNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=z))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/recharge-service.ts",["cc","./Manager.ts"],(function(e){var r,t;return{setters:[function(e){r=e.cclegacy},function(e){t=e.Manager}],execute:function(){r._RF.push({},"da453ri7JFFTZ1LkjQxwU54","recharge-service",void 0);let s=e("RechargeOrderStatus",function(e){return e.PENDING="pending",e.PAID="paid",e.EXPIRED="expired",e.FAILED="failed",e.CONFIRMED="confirmed",e}({}));class n{constructor(){this.currentOrder=null,this.checkInterval=null,this.walletTest=null}static getInstance(){return n.instance||(n.instance=new n),n.instance}setWalletTest(e){this.walletTest=e}async createOrder(e,r){if(!this.walletTest||!this.walletTest.isWalletConnected())throw new Error("请先连接钱包");const n=this.walletTest.getWalletAddress();if(!n)throw new Error("无法获取钱包地址");const a=t.userData?.data?.userId;if(!a)throw new Error("用户未登录");return new Promise(((i,d)=>{const c={userId:a,topupId:e,amount:r,walletAddress:n};t.getInstance().post("https://api.xdiving.io/api/topup/create-order",c,(t=>{const d={orderId:t.orderId||t.data?.orderId,topupId:e,amount:t.amount||t.data?.amount||r,receiveAddress:t.receiveAddress||t.data?.receiveAddress,userAddress:n,userId:a,status:s.PENDING,expireTime:t.expireTime||t.data?.expireTime||Date.now()+18e5,createdAt:Date.now()};this.currentOrder=d,this.startOrderStatusCheck(),i(d)}),(e=>{d(new Error(`创建订单失败: ${e}`))}))}))}async checkOrderStatus(e){const r=e||this.currentOrder?.orderId;return r?new Promise(((e,s)=>{t.getInstance().get(`https://api.xdiving.io/api/topup/order-status?orderId=${r}`,(r=>{const t=r.data||r,s={orderId:t.orderId,topupId:t.topupId||this.currentOrder?.topupId||0,amount:t.amount,receiveAddress:t.receiveAddress||this.currentOrder?.receiveAddress||"",userAddress:t.userAddress||this.currentOrder?.userAddress||"",userId:t.userId||this.currentOrder?.userId||0,status:t.status,expireTime:t.expireTime,txHash:t.txHash,paidAmount:t.paidAmount,paidTime:t.paidTime,createdAt:t.createdAt||this.currentOrder?.createdAt||Date.now()};this.currentOrder&&this.currentOrder.orderId===s.orderId&&(this.currentOrder=s),e(s)}),(e=>{s(new Error(`查询订单状态失败: ${e}`))}))})):null}async sendPayment(e){if(!this.walletTest||!this.walletTest.isWalletConnected())throw new Error("请先连接钱包");if(Date.now()>e.expireTime)throw new Error("订单已过期，请重新创建订单");if(e.status!==s.PENDING)throw new Error(`订单状态错误: ${e.status}`);try{const r=Math.floor(1e6*e.amount).toString(),t=this.walletTest.gameFi;if(!t)throw new Error("GameFi SDK 未初始化");if("function"==typeof t.sendTransaction){const s={to:e.receiveAddress,value:"0",data:this.buildJettonTransferData(e.receiveAddress,r)},n=await t.sendTransaction(s);return n.txHash||n.hash}throw new Error("当前 SDK 不支持 Jetton Transfer，需要手动实现")}catch(e){const r=e instanceof Error?e.message:String(e);throw new Error(`发送支付交易失败: ${r}`)}}buildJettonTransferData(e,r){return console.warn("buildJettonTransferData 需要 TON 库支持，当前返回空数据"),""}startOrderStatusCheck(){this.checkInterval||(this.checkInterval=setInterval((()=>{if(this.currentOrder)return Date.now()>this.currentOrder.expireTime?(this.currentOrder.status=s.EXPIRED,void this.stopOrderStatusCheck()):void this.checkOrderStatus().then((e=>{e&&(e.status!==s.PAID&&e.status!==s.CONFIRMED||this.stopOrderStatusCheck())})).catch((e=>{console.error("查询订单状态失败:",e)}));this.stopOrderStatusCheck()}),5e3))}stopOrderStatusCheck(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}getCurrentOrder(){return this.currentOrder}clearCurrentOrder(){this.stopOrderStatusCheck(),this.currentOrder=null}getRemainingTime(e){const r=e.expireTime-Date.now();if(r<=0)return"已过期";const t=Math.floor(r/6e4),s=Math.floor(r%6e4/1e3);return`${t}:${s<10?"0"+s:s.toString()}`}}e("RechargeService",n),n.instance=null,r._RF.pop()}}}));

System.register("chunks:///_virtual/Referral.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Manager.ts","./ReferralContent.ts","./Sound.ts","./GeneralUI.ts"],(function(e){var t,i,n,r,a,o,s,l,c,u,d,p,h,b,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){n=e.cclegacy,r=e.Node,a=e.Prefab,o=e.Label,s=e._decorator,l=e.Component,c=e.director,u=e.instantiate,d=e.sys},function(e){p=e.Manager},function(e){h=e.ReferralContent},function(e){b=e.Sound},function(e){f=e.GeneralUI}],execute:function(){var m,g,y,v,C,T,w,F,L,I,U,x,D,R,k,S,z;n._RF.push({},"87c0bbykLhDwquU3gD1VSSj","Referral",void 0);const{ccclass:A,property:_}=s;e("Referral",(m=A("Referral"),g=_(f),y=_(r),v=_(a),C=_(o),T=_(o),w=_(r),F=_(r),m((U=t((I=class extends l{constructor(){super(...arguments),i(this,"generalUI",U,this),i(this,"contentNode",x,this),i(this,"referralContent",D,this),i(this,"numLabel",R,this),i(this,"linkLabel",k,this),i(this,"successFrame",S,this),this.successTimer=1,i(this,"failFrame",z,this),this.failTimer=1,this.displayLoaded=!1,this.url=""}start(){this.generalUI.updateDisplay(),c.preloadScene("Menu"),this.numLabel.string="Friend List("+p.inviteUserData.data.length.toString()+")",this.url="https://t.me/xdiving_bot/xdiving_bot?startapp="+p.inviteCodeData.data.invitationCode,this.linkLabel.string=this.url}refresh(){this.displayLoaded=!1,p.loadFinish=0,p.getInstance().loadAllUserData(p.userData.data.userId),this.updateInvitee(),this.generalUI.updateDisplay()}updateInvitee(){this.contentNode.destroyAllChildren();for(const e of p.inviteUserData.data){let t=u(this.referralContent);this.contentNode.addChild(t),t.getComponent(h).userId.string=e.inviteeUserId.toString(),e.firstPlayed&&(t.getComponent(h).diamond.string="+1")}}copy(){b.instance.buttonAudio.play(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(this.url).then((()=>{console.log("链接复制成功: ",this.url),this.successFrame.active=!0})).catch((e=>{console.error("复制失败，尝试备用方法: ",e),this.fallbackCopyTextToClipboard()})):this.fallbackCopyTextToClipboard()}fallbackCopyTextToClipboard(){const e=document.createElement("textarea");e.value=this.url,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);try{document.execCommand("copy")?(console.log("链接复制成功 (备用方法): ",this.url),this.successFrame.active=!0):(console.error("备用复制方法失败"),this.failFrame.active=!0)}catch(e){console.error("备用复制方法出错: ",e)}document.body.removeChild(e)}update(e){0==this.displayLoaded&&p.getInstance().getFinish()&&(this.displayLoaded=!0,this.updateInvitee()),this.successFrame.active&&(this.successTimer>0?this.successTimer-=e:(this.successFrame.active=!1,this.successTimer=1)),this.failFrame.active&&(this.failTimer>0?this.failTimer-=e:(this.failFrame.active=!1,this.failTimer=1))}back(){b.instance.buttonAudio.play(),c.loadScene("Menu")}jump(){b.instance.buttonAudio.play();const e="https://t.me/share/url?url="+encodeURIComponent(this.url);window.Telegram&&window.Telegram.WebApp?window.Telegram.WebApp.openTelegramLink(e):d.openURL(e)}}).prototype,"generalUI",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(I.prototype,"contentNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(I.prototype,"referralContent",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(I.prototype,"numLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(I.prototype,"linkLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(I.prototype,"successFrame",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(I.prototype,"failFrame",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=I))||L));n._RF.pop()}}}));

System.register("chunks:///_virtual/ReferralContent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,o,i,a;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){n=e.cclegacy,o=e.Label,i=e._decorator,a=e.Component}],execute:function(){var l,c,s,u,p,f,d;n._RF.push({},"8ca2c59LsZOIa5+/no2qg9x","ReferralContent",void 0);const{ccclass:b,property:y}=i;e("ReferralContent",(l=b("ReferralContent"),c=y(o),s=y(o),l((f=t((p=class extends a{constructor(){super(...arguments),r(this,"userId",f,this),r(this,"diamond",d,this)}start(){}update(e){}}).prototype,"userId",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(p.prototype,"diamond",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=p))||u));n._RF.pop()}}}));

System.register("chunks:///_virtual/Sound.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,o,n,r,u,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){o=t.cclegacy,n=t.AudioSource,r=t._decorator,u=t.Component,l=t.director}],execute:function(){var a,s,c,d,b,p,h,f,y,A,m,g,z,w,v,S,B,G,M,k,_,D;o._RF.push({},"1f2542JBvdJhaGL54mGMkoN","Sound",void 0);const{ccclass:L,property:P}=r;t("Sound",(a=L("Sound"),s=P(n),c=P(n),d=P(n),b=P(n),p=P(n),h=P(n),f=P(n),y=P(n),A=P(n),a(((D=class t extends u{constructor(){super(...arguments),e(this,"BGM",z,this),e(this,"buttonAudio",w,this),e(this,"stayAudio",v,this),e(this,"moveAudio",S,this),e(this,"boostAudio",B,this),e(this,"shootAudio",G,this),e(this,"catchAudio",M,this),e(this,"treasureAudio",k,this),e(this,"backAudio",_,this)}onLoad(){t.instance?this.destroy():(t.instance=this,l.addPersistRootNode(this.node))}start(){this.BGM.play()}update(t){}}).instance=null,z=i((g=D).prototype,"BGM",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=i(g.prototype,"buttonAudio",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(g.prototype,"stayAudio",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=i(g.prototype,"moveAudio",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=i(g.prototype,"boostAudio",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(g.prototype,"shootAudio",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(g.prototype,"catchAudio",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(g.prototype,"treasureAudio",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=i(g.prototype,"backAudio",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=g))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-wallet-manager.ts",["cc"],(function(n){var e,t,o,r;return{setters:[function(n){e=n.cclegacy,t=n._decorator,o=n.Component,r=n.director}],execute:function(){var c,i;e._RF.push({},"b9256hv1AhFXLv+Yk4Fjzr0","telegram-wallet-manager",void 0);const{ccclass:s}=t;n("TelegramWalletManager",s("TelegramWalletManager")(((i=class n extends o{constructor(){super(...arguments),this.gameFi=null,this.isInitializing=!1,this.initError=null,this.walletChangeCallbacks=[]}start(){if(n.instance&&n.instance!==this)return console.log("TelegramWalletManager 已存在，销毁当前实例"),void this.node.destroy();n.instance=this,r.addPersistRootNode(this.node),this.setupGlobalErrorHandlers(),setTimeout((()=>{this.initGameFi().catch((n=>{console.error("TelegramWalletManager 初始化失败:",n)}))}),0)}onDestroy(){n.instance===this&&(n.instance=null)}static getInstance(){return n.instance}getGameFi(){return this.gameFi}isInitialized(){return!!this.gameFi}getIsInitializing(){return this.isInitializing}getInitError(){return this.initError}onWalletChange(n){this.walletChangeCallbacks.push(n),this.gameFi?.wallet&&n(this.gameFi.wallet)}offWalletChange(n){const e=this.walletChangeCallbacks.indexOf(n);e>-1&&this.walletChangeCallbacks.splice(e,1)}notifyWalletChange(n){this.walletChangeCallbacks.forEach((e=>{try{e(n)}catch(n){console.error("钱包状态变化回调执行失败:",n)}}))}async initGameFi(){if(this.isInitializing)return;if(this.gameFi)return void console.log("GameFi SDK 已经初始化，跳过重复初始化");this.isInitializing=!0,this.initError=null;const n=setTimeout((()=>{this.isInitializing&&(this.isInitializing=!1,this.initError="初始化超时")}),9e4);try{await Promise.race([this.loadTonConnectUI(),new Promise(((n,e)=>setTimeout((()=>e(new Error("CDN 加载超时（60秒）"))),6e4)))]);let e=0;const t=20,o=window;for(;e<t&&!o.TonConnectUI&&!o.TonConnectUISDK;)await new Promise((n=>setTimeout(n,100))),e++;this.gameFi=await Promise.race([this.createGameFiWrapper(),new Promise(((n,e)=>setTimeout((()=>e(new Error("创建包装器超时（10秒）"))),1e4)))]);try{const n=this.gameFi.restoreConnection;n&&"function"==typeof n&&await Promise.race([n(),new Promise(((n,e)=>setTimeout((()=>e(new Error("恢复连接超时"))),5e3)))])}catch(n){const e=n instanceof Error?n.message:String(n);e.includes("CORS")||e.includes("go-bridge")?console.log("恢复连接时遇到 CORS 限制（本地开发环境正常，生产环境不会有此问题）"):e.includes("unpause")||e.includes("Resource recreation")?console.log("恢复连接时遇到 SDK 内部状态问题（不影响使用）:",e):console.warn("恢复连接失败（不影响使用）:",n)}this.gameFi.onWalletChange((n=>{this.notifyWalletChange(n)})),clearTimeout(n),this.initError=null,console.log("✅ TON Connect 初始化成功！")}catch(e){clearTimeout(n);const t=e instanceof Error?e.message:String(e);this.initError=t,console.error("❌ TON Connect 初始化失败:",t)}finally{this.isInitializing=!1}}async loadTonConnectUI(){var n=this;return new Promise(((e,t)=>{const o=window;if(o.TonConnectUI||o.TonConnectUISDK)return void e();if(Array.from(document.querySelectorAll('script[src*="tonconnect"]')).length>0){console.log("检测到已存在的 TON Connect 脚本标签，等待加载完成...");let n=0;const t=50,r=setInterval((()=>{n++,o.TonConnectUI||o.TonConnectUISDK?(clearInterval(r),e()):n>=t&&(clearInterval(r),console.warn("等待已存在脚本加载超时，将尝试加载新脚本"))}),100);if(o.TonConnectUI||o.TonConnectUISDK)return}const r=()=>{if(o.TonConnectUI||o.TonConnectUISDK)return o.__tonconnectUILoading=!1,void e();o.__tonconnectUILoading=!0;const r=["https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js","https://unpkg.com/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js"];let c=[],i=[];const s=a=>{if(a>=r.length){i.forEach((n=>{n.parentNode&&n.parentNode.removeChild(n)})),o.__tonconnectUILoading=!1;const n=`所有 CDN 源都加载失败\n\n尝试的 CDN:\n${r.map(((n,e)=>`${e+1}. ${n}`)).join("\n")}\n\n错误信息:\n${c.join("\n")}\n\n可能原因:\n1. 网络连接问题\n2. CDN 服务不可用\n3. 防火墙或代理阻止访问`;return void t(new Error(n))}const l=r[a];if(document.querySelector(`script[src="${l}"]`)){console.log(`脚本已存在: ${l}，跳过重复加载`);let n=0;const t=30,r=setInterval((()=>{n++,o.TonConnectUI||o.TonConnectUISDK?(clearInterval(r),o.__tonconnectUILoading=!1,e()):n>=t&&(clearInterval(r),s(a+1))}),100);return}const d=document.createElement("script");d.src=l,d.async=!1,d.defer=!1,d.crossOrigin="anonymous",d.type="text/javascript",d.referrerPolicy="no-referrer";let u=!1,f=null;d.onload=()=>{if(u)return;f&&(clearTimeout(f),f=null);const t=function(r){if(void 0===r&&(r=0),u)return;let i=!1;if((o.TonConnectUI||o.TONConnectUI||o.TonConnectUISDK)&&(i=!0),!i&&o.TonConnectUISDK&&(o.TonConnectUISDK.TonConnectUI||o.TonConnectUISDK.default)&&(i=!0),!i&&r<60){const n=Object.keys(o);for(const e of n){const n=e.toLowerCase();if(n.includes("tonconnect")||n.includes("ton")&&n.includes("connect")){const n=o[e];if("object"==typeof n&&null!==n&&(n.TonConnectUI||n.default&&"function"==typeof n.default)){i=!0;break}}}}if(i)u=!0,o.__tonconnectUILoading=!1,e();else if(r<60)setTimeout((()=>t(r+1)),500);else{u=!0;const e=n.getWindowDebugInfo(o);c.push(`${l}: 脚本加载成功但未找到 TonConnectUI 构造函数（检查了60次）\n调试信息: ${e}`),d.parentNode&&d.parentNode.removeChild(d),s(a+1)}};"undefined"!=typeof requestAnimationFrame?requestAnimationFrame((()=>{setTimeout((()=>t(0)),100)})):setTimeout((()=>t(0)),100)},d.onerror=n=>{if(u)return;u=!0,f&&(clearTimeout(f),f=null);const e=n?.message||"加载失败";c.push(`${l}: ${e}`),d.parentNode&&d.parentNode.removeChild(d),s(a+1)},f=setTimeout((()=>{u||(u=!0,c.push(`${l}: 脚本加载超时（30秒）`),d.parentNode&&d.parentNode.removeChild(d),s(a+1))}),3e4),i.push(d);const h=()=>{document.head?document.head.appendChild(d):document.body?document.body.appendChild(d):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{document.head?document.head.appendChild(d):document.body&&document.body.appendChild(d)})):setTimeout((()=>{document.head?document.head.appendChild(d):document.body&&document.body.appendChild(d)}),100)};"complete"===document.readyState||"interactive"===document.readyState?h():(window.addEventListener("load",h,{once:!0}),(document.head||document.body)&&h())};s(0)};if(o.__tonconnectUILoading){let n=0;const t=20,c=setInterval((()=>{n++,o.TonConnectUI||o.TonConnectUISDK||o.TonConnect?(clearInterval(c),o.__tonconnectUILoading=!1,e()):n>=t&&(clearInterval(c),o.__tonconnectUILoading=!1,console.log("等待其他加载完成超时（2秒），将尝试自己加载"),r())}),100)}else r()}))}async createGameFiWrapper(){const n=window;let e=null,t="查找 TonConnectUI 构造函数:\n";if(n.TonConnectUI?(e=n.TonConnectUI,t+="- ✅ 找到 win.TonConnectUI\n"):n.TONConnectUI?(e=n.TONConnectUI,t+="- ✅ 找到 win.TONConnectUI\n"):n.TonConnectUISDK&&(n.TonConnectUISDK.TonConnectUI?(e=n.TonConnectUISDK.TonConnectUI,t+="- ✅ 找到 win.TonConnectUISDK.TonConnectUI\n"):n.TonConnectUISDK.default&&(e=n.TonConnectUISDK.default,t+="- ✅ 找到 win.TonConnectUISDK.default\n")),!e){t+="- 遍历 window 对象查找...\n";const o=Object.keys(n).filter((n=>n.toLowerCase().includes("ton")||n.toLowerCase().includes("connect")));t+=`- 找到 ${o.length} 个相关键: ${o.slice(0,10).join(", ")}\n`;for(const r of o){const o=n[r];if("function"==typeof o){e=o,t+=`- ✅ 使用 ${r} 作为构造函数\n`;break}if("object"==typeof o&&null!==o){if(o.TonConnectUI){e=o.TonConnectUI,t+=`- ✅ 使用 ${r}.TonConnectUI\n`;break}if(o.default&&"function"==typeof o.default){e=o.default,t+=`- ✅ 使用 ${r}.default\n`;break}}}}if(!e){throw new Error(`未找到 TonConnectUI 构造函数\n\n${t}\n\n请检查:\n1. CDN 脚本是否成功加载（@tonconnect/ui@2.0.1）\n2. 浏览器控制台是否有错误\n3. 网络连接是否正常\n4. 是否在 Telegram 环境中运行\n\n提示: 所有平台（Windows/Mac/iOS）都统一使用 UI 模式`)}if(!("function"==typeof e&&e.prototype&&e.prototype.constructor===e)){const n=typeof e,t=e?String(e).substring(0,100):"null/undefined";throw new Error(`TonConnectUI 不是构造函数\n\n调试信息:\n- 类型: ${n}\n- 值: ${t}\n- 是否有 prototype: ${e&&e.prototype?"是":"否"}\n\n可能原因:\n1. CDN 脚本加载不完整\n2. 脚本执行顺序问题\n3. 浏览器兼容性问题\n\n建议:\n1. 检查浏览器控制台是否有脚本加载错误\n2. 尝试刷新页面\n3. 检查网络连接\n4. 确认 CDN 可访问: https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js`)}const o={manifestUrl:this.getManifestUrl()},r=window.customElements;let c=null;if(r&&r.get("tc-root"))if(console.log('检测到 "tc-root" 自定义元素已注册，TON Connect UI 可能已初始化'),n.__tonConnectUIInstance){console.log("找到全局 TON Connect UI 实例引用，检查实例是否可用...");const e=n.__tonConnectUIInstance,t=void 0!==e.modal&&null!==e.modal,o=void 0!==e.connector&&null!==e.connector,r=void 0!==e.provider&&null!==e.provider;t||o||r?(console.log("已存在的实例可用，重用该实例"),c=e):console.warn("已存在的实例缺少必要属性，尝试创建新实例")}else console.log("未找到已存在的 UI 实例，尝试创建新实例");if(!c)try{void 0!==r&&r.define&&await new Promise((n=>{"complete"===document.readyState?n(void 0):(window.addEventListener("load",(()=>n(void 0)),{once:!0}),setTimeout((()=>n(void 0)),1e3))}));try{c=new e(o),n.__tonConnectUIInstance=c}catch(n){const e=n instanceof Error?n.message:String(n);throw new Error(`TonConnectUI 构造函数调用失败: ${e}`)}await new Promise((n=>setTimeout(n,200)));const t=void 0!==c.modal&&null!==c.modal,i=void 0!==c.connector&&null!==c.connector,s=void 0!==c.provider&&null!==c.provider;if(!t&&!i&&!s)throw new Error("TonConnectUI 实例初始化不完整（缺少 modal/connector/provider），请检查 CDN 脚本是否正确加载")}catch(e){const t=e instanceof Error?e.message:String(e);if(!(t.includes("tc-root")||t.includes("already been used")||t.includes("CustomElementRegistry")))throw e;if(console.warn("创建新实例失败（自定义元素已注册），尝试使用已存在的实例"),!n.__tonConnectUIInstance)throw new Error(`TON Connect UI 已初始化，无法创建新实例\n\n错误: ${t}\n\n可能原因:\n1. 页面刷新后脚本未完全清理\n2. 多次初始化 TON Connect UI\n\n建议:\n1. 刷新页面清除状态（推荐）\n2. 检查是否有多个组件同时初始化 TON Connect UI`);c=n.__tonConnectUIInstance,console.log("使用全局保存的实例")}const i=void 0!==c.provider&&null!==c.provider,s=void 0!==c.modal&&null!==c.modal,a=void 0!==c.connector&&null!==c.connector;if(i&&!s&&!a)return await this.createGameFiWrapperFromSDKInstance(c);if(void 0!==c.walletsList&&!s&&!a)return await this.createGameFiWrapperFromSDKInstance(c);const l={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{const n=void 0!==c.provider&&null!==c.provider,e=void 0!==c.modal&&null!==c.modal,t=void 0!==c.connector&&null!==c.connector;if(n&&!e&&!t){if("function"==typeof c.connect)try{return void await c.connect()}catch(n){console.warn("tonConnectInstance.connect() 失败，尝试其他方法:",n)}if(c.provider&&"function"==typeof c.provider.connect)try{return void await c.provider.connect()}catch(n){console.warn("provider.connect() 失败，尝试其他方法:",n)}}if(c.modal&&"function"==typeof c.modal.open)try{return void c.modal.open()}catch(n){console.warn("modal.open() 失败，尝试其他方法:",n)}if(c.connector){if("function"==typeof c.connector.connect)try{return void await c.connector.connect()}catch(n){console.warn("connector.connect() 失败，尝试其他方法:",n)}if("function"==typeof c.connector.openModal)try{return void c.connector.openModal()}catch(n){console.warn("connector.openModal() 失败，尝试其他方法:",n)}}if("function"==typeof c.open)try{return void c.open()}catch(n){console.warn("tonConnectInstance.open() 失败，尝试其他方法:",n)}if(c.singleWalletModal&&"function"==typeof c.singleWalletModal.open)try{return void c.singleWalletModal.open()}catch(n){console.warn("singleWalletModal.open() 失败，尝试其他方法:",n)}if(c.ui&&"function"==typeof c.ui.open)try{return void c.ui.open()}catch(n){console.warn("ui.open() 失败，尝试其他方法:",n)}if("function"==typeof c.openModal)try{return void c.openModal()}catch(n){console.warn("openModal() 失败，尝试其他方法:",n)}const o=Object.keys(c||{}).filter((n=>"function"==typeof c[n])).join(", "),r=c.modal?`modal 方法: ${Object.keys(c.modal||{}).join(", ")}`:"modal 不存在",i=c.connector?`connector 方法: ${Object.keys(c.connector||{}).join(", ")}`:"connector 不存在",s=c.provider?"provider 类型: "+typeof c.provider:"provider 不存在",a=c.ui?`ui 方法: ${Object.keys(c.ui||{}).join(", ")}`:"ui 不存在";throw new Error(`无法打开连接界面\n\n可用方法: ${o}\n${r}\n${i}\n${s}\n${a}\n\n提示: 检测到 SDK 实例，但连接方法不可用。请检查 TON Connect SDK 版本或尝试刷新页面。`)},disconnectWallet:async()=>{if(c.connector&&"function"==typeof c.connector.disconnect)await c.connector.disconnect();else{if("function"!=typeof c.disconnect)throw new Error("无法断开连接");await c.disconnect()}},onWalletChange:n=>{c.connector&&"function"==typeof c.connector.onStatusChange?c.connector.onStatusChange((async e=>{const t=e?this.convertToWallet(e):null;l.wallet=t,l.walletAccount=e?.account||null;const o=this.getUserFriendlyAddressFromWallet(e);l.walletAddress=o||await this.convertToUserFriendlyAddress(e?.account?.address),n(t)})):"function"==typeof c.onStatusChange&&c.onStatusChange((async e=>{const t=e?this.convertToWallet(e):null;l.wallet=t,l.walletAccount=e?.account||null;const o=this.getUserFriendlyAddressFromWallet(e);l.walletAddress=o||await this.convertToUserFriendlyAddress(e?.account?.address),n(t)}))}};return l.restoreConnection=async()=>{"function"==typeof c.restoreConnection&&await c.restoreConnection();const n=c.walletInfo||c.wallet;n&&(l.wallet=this.convertToWallet(n),l.walletAccount=n.account,l.walletAddress=await this.convertToUserFriendlyAddress(n.account?.address))},l._tonConnectInstance=c,l}async createGameFiWrapperFromSDKInstance(n){const e={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{try{if("function"==typeof n.connect)return void await n.connect();if(n.provider&&"function"==typeof n.provider.connect)return void await n.provider.connect();const e=Object.keys(n||{}).filter((e=>"function"==typeof n[e])).join(", ");throw new Error(`TonConnect SDK 没有可用的连接方法\n\n可用方法: ${e}\n\n提示: TonConnect SDK 使用 connect() 方法连接钱包`)}catch(n){const e=n instanceof Error?n.message:String(n);if(e.includes("jsBridgeKey")||e.includes("in operator"))throw new Error(`连接失败: ${e}\n\n提示: 请直接使用 connect() 方法，不要传递参数`);throw new Error(`连接失败: ${e}`)}},disconnectWallet:async()=>{if("function"!=typeof n.disconnect)throw new Error("无法断开连接");await n.disconnect()},onWalletChange:t=>{"function"==typeof n.onStatusChange&&n.onStatusChange((async n=>{const o=n?this.convertToWallet(n):null;e.wallet=o,e.walletAccount=n?.account||null;const r=this.getUserFriendlyAddressFromWallet(n);e.walletAddress=r||await this.convertToUserFriendlyAddress(n?.account?.address),t(o)}))}};return e.restoreConnection=async()=>{"function"==typeof n.restoreConnection&&await n.restoreConnection();const t=n.wallet;t&&(e.wallet=this.convertToWallet(t),e.walletAccount=t.account,e.walletAddress=await this.convertToUserFriendlyAddress(t.account?.address))},e._tonConnect=n,n.wallet&&(e.wallet=this.convertToWallet(n.wallet),e.walletAccount=n.wallet.account,e.walletAddress=this.convertToUserFriendlyAddressSync(n.wallet.account?.address),this.convertToUserFriendlyAddress(n.wallet.account?.address).then((n=>{e.walletAddress=n}))),e}async createGameFiWrapperFromSDK(n){const e=this.getManifestUrl(),t={manifestUrl:e};if(!e||!e.startsWith("http"))throw new Error(`manifest URL 无效: ${e}\n\n请确保 tonconnect-manifest.json 文件在服务器根目录可访问`);let o;try{o=new n(t)}catch(n){const t=n instanceof Error?n.message:String(n);throw new Error(`创建 TonConnect 实例失败: ${t}\n\n请检查:\n1. manifest URL 是否正确: ${e}\n2. manifest 文件是否可访问\n3. 网络连接是否正常`)}const r={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{try{if("function"==typeof o.connect)return await new Promise((n=>setTimeout(n,100))),void await o.connect();if(o.provider&&"function"==typeof o.provider.connect)return void await o.provider.connect();throw new Error("TonConnect SDK 没有可用的连接方法")}catch(n){const t=n instanceof Error?n.message:String(n);if(t.includes("jsBridgeKey")||t.includes("in operator")){if(o.provider&&"function"==typeof o.provider.connect)try{return void await o.provider.connect()}catch(n){throw new Error(`连接失败: ${t}\n\n这是 @tonconnect/sdk@3.3.1 在 Telegram Web App 中的已知 bug。\n\n建议:\n1. 尝试在普通浏览器中测试（非 Telegram 环境）\n2. 检查 manifest 文件: ${e}\n3. 考虑使用 @tonconnect/ui@2.0.1（更适合 Telegram）\n4. 查看浏览器控制台的完整错误堆栈以获取更多信息`)}throw new Error(`连接失败: ${t}\n\n这是 @tonconnect/sdk@3.3.1 在 Telegram Web App 中的已知 bug。\n\n建议:\n1. 尝试在普通浏览器中测试（非 Telegram 环境）\n2. 检查 manifest 文件: ${e}\n3. 考虑使用 @tonconnect/ui@2.0.1（更适合 Telegram）\n4. 查看浏览器控制台的完整错误堆栈以获取更多信息`)}const r=Object.keys(o||{}).filter((n=>"function"==typeof o[n])).join(", ");throw new Error(`连接失败: ${t}\n\n可用方法: ${r}\n\n提示: TonConnect SDK 需要先获取钱包列表，然后连接`)}},disconnectWallet:async()=>{await o.disconnect()},onWalletChange:n=>{o.onStatusChange((async e=>{const t=e?this.convertToWallet(e):null;r.wallet=t,r.walletAccount=e?.account||null;const o=this.getUserFriendlyAddressFromWallet(e);r.walletAddress=o||await this.convertToUserFriendlyAddress(e?.account?.address),n(t)}))}};return r.restoreConnection=async()=>{await o.restoreConnection();const n=o.wallet;n&&(r.wallet=this.convertToWallet(n),r.walletAccount=n.account,r.walletAddress=await this.convertToUserFriendlyAddress(n.account?.address))},r._tonConnect=o,o.wallet&&(r.wallet=this.convertToWallet(o.wallet),r.walletAccount=o.wallet.account,r.walletAddress=this.convertToUserFriendlyAddressSync(o.wallet.account?.address),this.convertToUserFriendlyAddress(o.wallet.account?.address).then((n=>{r.walletAddress=n}))),r}getWindowDebugInfo(n){const e=Object.keys(n).filter((n=>{const e=n.toLowerCase();return e.includes("ton")||e.includes("connect")}));return`Window 对象中的 TON 相关键 (${e.length} 个): ${e.slice(0,20).join(", ")}`}getUserFriendlyAddressFromWallet(n){if(!n||!n.account)return null;const e=n.account,t=e.address;return t&&(t.startsWith("UQ")||t.startsWith("EQ")||t.startsWith("0Q"))?t:e.userFriendlyAddress&&(e.userFriendlyAddress.startsWith("UQ")||e.userFriendlyAddress.startsWith("EQ"))?e.userFriendlyAddress:e.bounceableAddress&&(e.bounceableAddress.startsWith("UQ")||e.bounceableAddress.startsWith("EQ"))?e.bounceableAddress:n.userFriendlyAddress&&(n.userFriendlyAddress.startsWith("UQ")||n.userFriendlyAddress.startsWith("EQ"))?n.userFriendlyAddress:null}async convertToUserFriendlyAddress(n){if(!n)return null;if(n.startsWith("UQ")||n.startsWith("EQ")||n.startsWith("0Q"))return n;if(n.startsWith("0:")||n.startsWith("-1:"))try{const e=`https://tonapi.io/v2/accounts/${n}`,t=await fetch(e);if(t.ok){const n=await t.json();if(n.address&&(n.address.startsWith("UQ")||n.address.startsWith("EQ")||n.address.startsWith("0Q")))return n.address}}catch(n){console.warn("地址格式转换失败:",n)}return n}convertToUserFriendlyAddressSync(n){return n?(n.startsWith("UQ")||n.startsWith("EQ")||n.startsWith("0Q"),n):null}convertToWallet(n){return{account:{address:n.account?.address||"",chain:n.account?.chain||-239},device:n.device?{appName:n.device.appName||"",appVersion:n.device.appVersion||"",maxProtocolVersion:n.device.maxProtocolVersion||0,platform:n.device.platform||""}:void 0}}getManifestUrl(){return`${window.location.origin}/tonconnect-manifest.json`}setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",(n=>{console.error("未处理的 Promise 拒绝:",n.reason)}))}}).instance=null,c=i))||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-wallet-test.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Sound.ts"],(function(n){var t,e,o,i,c,r,s,a,l;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.initializerDefineProperty},function(n){o=n.cclegacy,i=n.Button,c=n.Label,r=n.Node,s=n._decorator,a=n.Component},function(n){l=n.Sound}],execute:function(){var d,u,h,f,w,p,m,C,g,T,y,v,I,b,S,U,W,D,F;o._RF.push({},"89ac1oZtedN0755x+ihZanx","telegram-wallet-test",void 0);const{ccclass:$,property:E}=s;n("TelegramWalletTest",(d=$("TelegramWalletTest"),u=E(i),h=E(i),f=E(c),w=E(c),p=E(c),m=E(r),C=E(r),g=E(r),d((v=t((y=class extends a{constructor(){super(...arguments),e(this,"connectBtn",v,this),e(this,"disconnectBtn",I,this),e(this,"infoLabel",b,this),e(this,"addressLabel",S,this),e(this,"connectLabel",U,this),e(this,"walletNode",W,this),e(this,"successFrame",D,this),this.successTimer=1,e(this,"failFrame",F,this),this.failTimer=1,this.gameFi=null,this.isInitializing=!1,this.initError=null}async start(){this.setupGlobalErrorHandlers(),this.walletNode&&(this.walletNode.active=!1),this.connectBtn&&this.connectBtn.node.on(i.EventType.CLICK,this.connectWallet,this),this.disconnectBtn&&this.disconnectBtn.node.on(i.EventType.CLICK,this.disconnectWallet,this),await this.initGameFi()}onDestroy(){}async initGameFi(){if(this.isInitializing)return void this.showInfo("正在初始化中，请稍候...");if(this.gameFi)return void console.log("GameFi SDK 已经初始化，跳过重复初始化");this.isInitializing=!0,this.initError=null;const n=setTimeout((()=>{if(this.isInitializing){this.isInitializing=!1;const n="初始化超时（90秒）\n\n可能原因:\n1. 网络连接缓慢\n2. CDN 无法访问\n3. 脚本加载失败\n\n建议:\n1. 检查网络连接\n2. 刷新页面重试\n3. 检查浏览器控制台错误";this.showInfo(n),this.initError="初始化超时"}}),9e4);try{this.showInfo("正在加载 TON Connect UI..."),await Promise.race([this.loadTonConnectUI(),new Promise(((n,t)=>setTimeout((()=>t(new Error("CDN 加载超时（60秒）\n\n可能原因:\n1. 网络连接缓慢\n2. 所有 CDN 源都无法访问\n3. 防火墙或代理阻止访问\n\n建议:\n1. 检查网络连接\n2. 尝试刷新页面\n3. 检查浏览器控制台的详细错误"))),6e4)))]),await new Promise((n=>setTimeout(n,500))),this.gameFi=await Promise.race([this.createGameFiWrapper(),new Promise(((n,t)=>setTimeout((()=>t(new Error("创建包装器超时（10秒）"))),1e4)))]);try{const n=this.gameFi.restoreConnection;n&&"function"==typeof n&&await Promise.race([n(),new Promise(((n,t)=>setTimeout((()=>t(new Error("恢复连接超时"))),5e3)))])}catch(n){const t=n instanceof Error?n.message:String(n);t.includes("CORS")||t.includes("go-bridge")?console.log("恢复连接时遇到 CORS 限制（本地开发环境正常，生产环境不会有此问题）"):t.includes("unpause")||t.includes("Resource recreation")?console.log("恢复连接时遇到 SDK 内部状态问题（不影响使用）:",t):console.warn("恢复连接失败（不影响使用）:",n)}this.gameFi.onWalletChange((n=>{this.onWalletStatusChange(n)})),clearTimeout(n),this.initError=null,this.showInfo("✅ TON Connect 初始化成功！"),this.updateUI(),setTimeout((()=>{this.infoLabel&&this.gameFi&&(this.infoLabel.node.active=!1)}),3e3)}catch(t){clearTimeout(n);const e=t instanceof Error?t.message:String(t);this.initError=e;const o=`❌ TON Connect 初始化失败\n\n错误: ${e}\n\n请检查:\n1. 网络连接是否正常\n2. CDN 是否可访问\n3. manifest 文件是否可访问\n4. 浏览器控制台是否有更多错误\n\n提示: 可以尝试刷新页面或重新初始化`,i=await this.copyToClipboard(o);this.showInfo(o+(i?"\n\n(错误信息已复制到剪贴板)":"\n\n(无法自动复制，请手动复制错误信息)"))}finally{this.isInitializing=!1}}async retryInit(){this.gameFi=null,this.initError=null,await this.initGameFi()}async testCDNAccessibility(){const n=["https://cdn.jsdelivr.net","https://unpkg.com","https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js"],t=[];let e=!1;for(const o of n)try{await fetch(o,{method:"HEAD",mode:"no-cors"});t.push(`✅ ${o}: 可访问`),e=!0}catch(n){t.push(`❌ ${o}: ${n instanceof Error?n.message:String(n)}`)}return{accessible:e,details:t.join("\n")}}async loadTonConnectUI(){return new Promise(((n,t)=>{const e=window;if(e.TonConnectUI||e.TonConnectUISDK||e.TonConnect)return void n();if(Array.from(document.querySelectorAll('script[src*="tonconnect"]')).length>0){console.log("检测到已存在的 TON Connect 脚本标签，等待加载完成...");let t=0;const o=50,i=setInterval((()=>{t++,e.TonConnectUI||e.TonConnectUISDK||e.TonConnect?(clearInterval(i),n()):t>=o&&(clearInterval(i),console.warn("等待已存在脚本加载超时，将尝试加载新脚本"))}),100);if(e.TonConnectUI||e.TonConnectUISDK||e.TonConnect)return}const o=()=>{if(e.TonConnectUI||e.TonConnectUISDK||e.TonConnect)return e.__tonconnectUILoading=!1,void n();e.__tonconnectUILoading=!0;const o=["https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js","https://unpkg.com/@tonconnect/ui@2.0.1/dist/tonconnect-ui.min.js","https://cdn.jsdelivr.net/npm/@tonconnect/sdk@3.3.1/dist/tonconnect-sdk.min.js","https://unpkg.com/@tonconnect/sdk@3.3.1/dist/tonconnect-sdk.min.js"];let i=[],c=[];const r=s=>{if(s>=o.length){c.forEach((n=>{n.parentNode&&n.parentNode.removeChild(n)})),e.__tonconnectUILoading=!1;const n=`所有 CDN 源都加载失败\n\n尝试的 CDN:\n${o.map(((n,t)=>`${t+1}. ${n}`)).join("\n")}\n\n错误信息:\n${i.join("\n")}\n\n可能原因:\n1. 网络连接问题\n2. CDN 服务不可用\n3. 防火墙或代理阻止访问`;return void t(new Error(n))}const a=o[s];if(document.querySelector(`script[src="${a}"]`)){console.log(`脚本已存在: ${a}，跳过重复加载`);let t=0;const o=30,i=setInterval((()=>{t++,e.TonConnectUI||e.TonConnectUISDK||e.TonConnect?(clearInterval(i),e.__tonconnectUILoading=!1,n()):t>=o&&(clearInterval(i),r(s+1))}),100);return}const l=document.createElement("script");l.src=a,l.async=!1,l.crossOrigin="anonymous",l.type="text/javascript";let d=!1;l.onload=()=>{if(d)return;let t=0;const o=setInterval((()=>{t++;let c=!1;if((e.TonConnectUI||e.TONConnectUI||e.TonConnect||e.TonConnectSDK||e.TonConnectUISDK&&(e.TonConnectUISDK.TonConnectUI||e.TonConnectUISDK.default))&&(c=!0),!c){const n=Object.keys(e);for(const t of n){const n=t.toLowerCase();if((n.includes("tonconnect")||n.includes("ton")&&n.includes("connect"))&&"object"==typeof e[t]&&null!==e[t]){if(e[t].TonConnectUI){c=!0;break}if(e[t].default&&"function"==typeof e[t].default){c=!0;break}}}}if(c)clearInterval(o),d=!0,e.__tonconnectUILoading=!1,n();else if(t>=30){clearInterval(o),d=!0;const n=this.getWindowDebugInfo(e);i.push(`${a}: 脚本加载成功但未找到 TonConnectUI 构造函数\n调试信息: ${n}`),r(s+1)}}),500)},l.onerror=n=>{if(d)return;d=!0;const t=n?.message||"加载失败";i.push(`${a}: ${t}`),l.parentNode&&l.parentNode.removeChild(l),r(s+1)},setTimeout((()=>{d||(d=!0,i.push(`${a}: 脚本加载超时（20秒）`),l.parentNode&&l.parentNode.removeChild(l),r(s+1))}),2e4),c.push(l),document.head.appendChild(l)};r(0)};if(e.__tonconnectUILoading){let t=0;const i=20,c=setInterval((()=>{t++,e.TonConnectUI||e.TonConnectUISDK||e.TonConnect?(clearInterval(c),e.__tonconnectUILoading=!1,n()):t>=i&&(clearInterval(c),e.__tonconnectUILoading=!1,console.log("等待其他加载完成超时（2秒），将尝试自己加载"),o())}),100)}else o()}))}async createGameFiWrapper(){const n=window;let t=null,e="查找 TonConnectUI 构造函数:\n";if(n.TonConnectUI?(t=n.TonConnectUI,e+="- ✅ 找到 win.TonConnectUI\n"):n.TONConnectUI?(t=n.TONConnectUI,e+="- ✅ 找到 win.TONConnectUI\n"):n.TonConnectUISDK&&(n.TonConnectUISDK.TonConnectUI?(t=n.TonConnectUISDK.TonConnectUI,e+="- ✅ 找到 win.TonConnectUISDK.TonConnectUI\n"):n.TonConnectUISDK.default&&(t=n.TonConnectUISDK.default,e+="- ✅ 找到 win.TonConnectUISDK.default\n")),!t){e+="- 遍历 window 对象查找...\n";const o=Object.keys(n).filter((n=>n.toLowerCase().includes("ton")||n.toLowerCase().includes("connect")));e+=`- 找到 ${o.length} 个相关键: ${o.slice(0,10).join(", ")}\n`;for(const i of o){const o=n[i];if("function"==typeof o){t=o,e+=`- ✅ 使用 ${i} 作为构造函数\n`;break}if("object"==typeof o&&null!==o){if(o.TonConnectUI){t=o.TonConnectUI,e+=`- ✅ 使用 ${i}.TonConnectUI\n`;break}if(o.default&&"function"==typeof o.default){t=o.default,e+=`- ✅ 使用 ${i}.default\n`;break}}}}if(!t){if(n.TonConnect)return await this.createGameFiWrapperFromSDK(n.TonConnect);if(n.TonConnectSDK&&n.TonConnectSDK.TonConnect)return await this.createGameFiWrapperFromSDK(n.TonConnectSDK.TonConnect);if(n.TonConnectSDK&&n.TonConnectSDK.default)return await this.createGameFiWrapperFromSDK(n.TonConnectSDK.default)}if(!t){throw new Error(`未找到 TonConnectUI 或 TonConnect SDK\n\n${e}\n\n请检查:\n1. CDN 脚本是否成功加载\n2. 浏览器控制台是否有错误\n3. 网络连接是否正常\n\n提示: 代码会自动尝试使用 TonConnect SDK 作为备用方案`)}const o={manifestUrl:this.getManifestUrl()},i=window.customElements;let c=null;if(i&&i.get("tc-root")){console.log('检测到 "tc-root" 自定义元素已注册，TON Connect UI 可能已初始化');const n=window;if(n.__tonConnectUIInstance)console.log("找到全局 TON Connect UI 实例引用，重用该实例"),c=n.__tonConnectUIInstance;else{if(console.log("未找到已存在的 UI 实例，切换到 TonConnect SDK 模式（避免自定义元素冲突）"),n.TonConnect)return await this.createGameFiWrapperFromSDK(n.TonConnect);console.warn("TonConnect SDK 不可用，尝试创建新 UI 实例（可能会失败）")}}if(!c)try{c=new t(o);window.__tonConnectUIInstance=c}catch(n){const t=n instanceof Error?n.message:String(n);if(!(t.includes("tc-root")||t.includes("already been used")||t.includes("CustomElementRegistry"))){const t=window;if(t.TonConnect)return await this.createGameFiWrapperFromSDK(t.TonConnect);throw n}{console.warn("创建新实例失败（自定义元素已注册），尝试使用已存在的实例");const n=window;if(!n.__tonConnectUIInstance){const n=window;if(n.TonConnect)return console.log("切换到 TonConnect SDK 模式（避免自定义元素冲突）"),await this.createGameFiWrapperFromSDK(n.TonConnect);throw new Error(`TON Connect UI 已初始化，无法创建新实例\n\n错误: ${t}\n\n可能原因:\n1. 页面刷新后脚本未完全清理\n2. 多次初始化 TON Connect UI\n\n建议:\n1. 刷新页面清除状态（推荐）\n2. 检查是否有多个组件同时初始化 TON Connect UI\n3. 如果问题持续，考虑使用 TonConnect SDK 模式`)}c=n.__tonConnectUIInstance,console.log("使用全局保存的实例")}}const r=void 0!==c.provider&&null!==c.provider,s=void 0!==c.modal&&null!==c.modal,a=void 0!==c.connector&&null!==c.connector;if(r&&!s&&!a)return await this.createGameFiWrapperFromSDKInstance(c);if(void 0!==c.walletsList&&!s&&!a)return await this.createGameFiWrapperFromSDKInstance(c);const l={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{const n=void 0!==c.provider&&null!==c.provider,t=void 0!==c.modal&&null!==c.modal,e=void 0!==c.connector&&null!==c.connector;if(n&&!t&&!e){if("function"==typeof c.connect)return void await c.connect();if(c.provider&&"function"==typeof c.provider.connect)return void await c.provider.connect()}if(c.modal&&"function"==typeof c.modal.open)return void c.modal.open();if(c.connector){if("function"==typeof c.connector.connect)return void await c.connector.connect();if("function"==typeof c.connector.openModal)return void c.connector.openModal()}if("function"==typeof c.open)return void c.open();if(c.singleWalletModal&&"function"==typeof c.singleWalletModal.open)return void c.singleWalletModal.open();const o=Object.keys(c||{}).join(", "),i=c.modal?`modal 方法: ${Object.keys(c.modal||{}).join(", ")}`:"modal 不存在",r=c.connector?`connector 方法: ${Object.keys(c.connector||{}).join(", ")}`:"connector 不存在",s=c.provider?"provider 类型: "+typeof c.provider:"provider 不存在";throw new Error(`无法打开连接界面\n\n可用方法: ${o}\n${i}\n${r}\n${s}\n\n提示: 检测到 SDK 实例，但连接方法不可用`)},disconnectWallet:async()=>{if(c.connector&&"function"==typeof c.connector.disconnect)await c.connector.disconnect();else{if("function"!=typeof c.disconnect)throw new Error("无法断开连接");await c.disconnect()}},onWalletChange:n=>{c.connector&&"function"==typeof c.connector.onStatusChange?c.connector.onStatusChange((t=>{const e=t?this.convertToWallet(t):null;l.wallet=e,l.walletAccount=t?.account||null,l.walletAddress=t?.account?.address||null,n(e)})):"function"==typeof c.onStatusChange&&c.onStatusChange((t=>{const e=t?this.convertToWallet(t):null;l.wallet=e,l.walletAccount=t?.account||null,l.walletAddress=t?.account?.address||null,n(e)}))}};return l.restoreConnection=async()=>{"function"==typeof c.restoreConnection&&await c.restoreConnection();const n=c.walletInfo||c.wallet;n&&(l.wallet=this.convertToWallet(n),l.walletAccount=n.account,l.walletAddress=n.account?.address||null)},l._tonConnectInstance=c,l}async createGameFiWrapperFromSDKInstance(n){const t={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{try{if("function"==typeof n.connect)return void await n.connect();if(n.provider&&"function"==typeof n.provider.connect)return void await n.provider.connect();const t=Object.keys(n||{}).filter((t=>"function"==typeof n[t])).join(", ");throw new Error(`TonConnect SDK 没有可用的连接方法\n\n可用方法: ${t}\n\n提示: TonConnect SDK 使用 connect() 方法连接钱包`)}catch(n){const t=n instanceof Error?n.message:String(n);if(t.includes("jsBridgeKey")||t.includes("in operator"))throw new Error(`连接失败: ${t}\n\n提示: 请直接使用 connect() 方法，不要传递参数`);throw new Error(`连接失败: ${t}`)}},disconnectWallet:async()=>{if("function"!=typeof n.disconnect)throw new Error("无法断开连接");await n.disconnect()},onWalletChange:e=>{"function"==typeof n.onStatusChange&&n.onStatusChange((n=>{const o=n?this.convertToWallet(n):null;t.wallet=o,t.walletAccount=n?.account||null,t.walletAddress=n?.account?.address||null,e(o)}))}};return t.restoreConnection=async()=>{"function"==typeof n.restoreConnection&&await n.restoreConnection();const e=n.wallet;e&&(t.wallet=this.convertToWallet(e),t.walletAccount=e.account,t.walletAddress=e.account?.address||null)},t._tonConnect=n,n.wallet&&(t.wallet=this.convertToWallet(n.wallet),t.walletAccount=n.wallet.account,t.walletAddress=n.wallet.account?.address||null),t}async createGameFiWrapperFromSDK(n){const t=this.getManifestUrl(),e=window,o=(void 0!==e.Telegram&&e.Telegram.WebApp,{manifestUrl:t});if(!t||!t.startsWith("http"))throw new Error(`manifest URL 无效: ${t}\n\n请确保 tonconnect-manifest.json 文件在服务器根目录可访问`);let i;try{i=new n(o)}catch(n){const e=n instanceof Error?n.message:String(n);throw new Error(`创建 TonConnect 实例失败: ${e}\n\n请检查:\n1. manifest URL 是否正确: ${t}\n2. manifest 文件是否可访问\n3. 网络连接是否正常`)}const c={wallet:null,walletAccount:null,walletAddress:null,connectWallet:async()=>{try{if("function"==typeof i.connect)return await new Promise((n=>setTimeout(n,100))),void await i.connect();if(i.provider&&"function"==typeof i.provider.connect)return void await i.provider.connect();throw new Error("TonConnect SDK 没有可用的连接方法")}catch(n){const e=n instanceof Error?n.message:String(n);if(e.includes("jsBridgeKey")||e.includes("in operator")){if(i.provider&&"function"==typeof i.provider.connect)try{return void await i.provider.connect()}catch(n){throw new Error(`连接失败: ${e}\n\n这是 @tonconnect/sdk@3.3.1 在 Telegram Web App 中的已知 bug。\n\n建议:\n1. 尝试在普通浏览器中测试（非 Telegram 环境）\n2. 检查 manifest 文件: ${t}\n3. 考虑使用 @tonconnect/ui@2.0.1（更适合 Telegram）\n4. 查看浏览器控制台的完整错误堆栈以获取更多信息`)}throw new Error(`连接失败: ${e}\n\n这是 @tonconnect/sdk@3.3.1 在 Telegram Web App 中的已知 bug。\n\n建议:\n1. 尝试在普通浏览器中测试（非 Telegram 环境）\n2. 检查 manifest 文件: ${t}\n3. 考虑使用 @tonconnect/ui@2.0.1（更适合 Telegram）\n4. 查看浏览器控制台的完整错误堆栈以获取更多信息`)}const o=Object.keys(i||{}).filter((n=>"function"==typeof i[n])).join(", ");throw new Error(`连接失败: ${e}\n\n可用方法: ${o}\n\n提示: TonConnect SDK 需要先获取钱包列表，然后连接`)}},disconnectWallet:async()=>{await i.disconnect()},onWalletChange:n=>{i.onStatusChange((t=>{const e=t?this.convertToWallet(t):null;c.wallet=e,c.walletAccount=t?.account||null,c.walletAddress=t?.account?.address||null,n(e)}))}};return c.restoreConnection=async()=>{await i.restoreConnection();const n=i.wallet;n&&(c.wallet=this.convertToWallet(n),c.walletAccount=n.account,c.walletAddress=n.account?.address||null)},c._tonConnect=i,i.wallet&&(c.wallet=this.convertToWallet(i.wallet),c.walletAccount=i.wallet.account,c.walletAddress=i.wallet.account?.address||null),c}getWindowDebugInfo(n){const t=Object.keys(n).filter((n=>{const t=n.toLowerCase();return t.includes("ton")||t.includes("connect")}));return`Window 对象中的 TON 相关键 (${t.length} 个): ${t.slice(0,20).join(", ")}`}convertToWallet(n){return{account:{address:n.account?.address||"",chain:n.account?.chain||-239},device:n.device?{appName:n.device.appName||"",appVersion:n.device.appVersion||"",maxProtocolVersion:n.device.maxProtocolVersion||0,platform:n.device.platform||""}:void 0}}async connectWallet(){if(!this.gameFi){let n="GameFi SDK 未初始化\n\n";if(this.isInitializing)return n+="正在初始化中，请稍候...\n\n",n+="提示: 初始化可能需要一些时间，请稍候再试",void this.showInfo(n);this.initError?(n+=`初始化失败: ${this.initError}\n\n`,n+="建议:\n",n+="1. 检查网络连接\n",n+="2. 刷新页面重试\n",n+="3. 检查浏览器控制台的错误信息\n",n+="4. 确认 manifest 文件可访问"):(n+="初始化未完成或失败\n\n",n+="请检查:\n",n+="1. 网络连接是否正常\n",n+="2. CDN 是否可访问\n",n+="3. 浏览器控制台是否有错误");const t=await this.copyToClipboard(n);return this.showInfo(n+(t?"\n\n(错误信息已复制到剪贴板)":"\n\n(无法自动复制，请手动复制错误信息)")),void(!this.isInitializing&&this.initError&&setTimeout((()=>{if(this.infoLabel){const n=this.infoLabel.string+"\n\n提示: 可以尝试刷新页面或等待自动重试";this.showInfo(n)}}),2e3))}if(this.gameFi?.wallet&&this.walletNode)this.walletNode.active=!0;else try{await this.gameFi.connectWallet()}catch(n){const t=`连接钱包失败: ${n instanceof Error?n.message:String(n)}`,e=await this.copyToClipboard(t);this.showInfo(t+(e?"\n\n(错误信息已复制到剪贴板)":"\n\n(无法自动复制，请手动复制错误信息)")),this.updateUI()}}async disconnectWallet(){if(this.gameFi)try{await this.gameFi.disconnectWallet(),this.showInfo("钱包已断开"),this.walletNode&&(this.walletNode.active=!1),this.updateUI()}catch(n){const t=`断开失败: ${n instanceof Error?n.message:String(n)}`,e=await this.copyToClipboard(t);this.showInfo(t+(e?"\n\n(错误信息已复制到剪贴板)":"\n\n(无法自动复制，请手动复制错误信息)"))}}onWalletStatusChange(n){if(n&&n.account){const t=n.account.address,e=`${t.slice(0,6)}...${t.slice(-4)}`;this.showInfo(`✅ 钱包连接成功\n地址: ${e}`)}else this.showInfo("钱包已断开"),this.walletNode&&(this.walletNode.active=!1);this.updateUI()}updateUI(){if(!this.gameFi)return;const n=this.gameFi.wallet,t=!(!n||!n.account);if(this.connectBtn&&(this.connectBtn.interactable=!0),this.disconnectBtn&&(this.disconnectBtn.interactable=t),this.addressLabel&&t&&n&&n.account&&n.account.address){const t=n.account.address;t.startsWith("0:")||t.startsWith("-1:")?this.convertToBounceableAddress(t).then((n=>{this.addressLabel&&(this.addressLabel.string=n)})).catch((()=>{this.addressLabel&&(this.addressLabel.string=t)})):this.addressLabel.string=t}if(this.connectLabel)if(t&&n&&n.account&&n.account.address){const t=n.account.address,e=this.getShortAddress(t,4,4);this.connectLabel.string=e}else this.connectLabel.string="connect wallet"}getWalletAddress(n){void 0===n&&(n="user-friendly");const t=this.gameFi?.walletAddress||null;return t?t.startsWith("UQ")||t.startsWith("EQ")||t.startsWith("0Q")?t:t.startsWith("0:")||t.startsWith("-1:")?"raw"===n?t:this.convertToBounceableAddressSync(t):t:null}async getWalletAddressAsync(n){void 0===n&&(n="user-friendly");const t=this.gameFi?.walletAddress||null;return t?t.startsWith("UQ")||t.startsWith("EQ")||t.startsWith("0Q")?t:t.startsWith("0:")||t.startsWith("-1:")?"raw"===n?t:await this.convertToBounceableAddress(t):t:null}async convertToBounceableAddress(n){try{if(n.startsWith("UQ")||n.startsWith("EQ")||n.startsWith("0Q"))return n;try{const t=`https://tonapi.io/v2/accounts/${n}`,e=await fetch(t);if(e.ok){const n=await e.json();if(n.address)return n.address}}catch(n){console.warn("使用 API 转换地址失败，尝试本地转换:",n)}const t=n.split(":");if(2===t.length){parseInt(t[0]);if(64===t[1].replace(/\.\.\./g,"").length)return console.warn("地址格式转换需要 TON SDK，返回原地址。建议安装 @ton/core 库"),n}return n}catch(t){return console.warn("地址格式转换失败，返回原地址:",t),n}}convertToBounceableAddressSync(n){return n.startsWith("UQ")||n.startsWith("EQ")||n.startsWith("0Q"),n}getShortAddress(n,t,e){if(void 0===t&&(t=4),void 0===e&&(e=4),!n)return"";let o=n;return(n.startsWith("0:")||n.startsWith("-1:"))&&(o=this.convertToBounceableAddressSync(n)),o.length<=t+e?o:`${o.slice(0,t)}...${o.slice(-e)}`}isWalletConnected(){return!!this.gameFi?.wallet}showInfo(n){this.infoLabel&&(this.infoLabel.string=n,this.infoLabel.node.active=!0)}async copyToClipboard(n){try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(n),!0}catch(n){if("NotAllowedError"!==n.name)throw n}const t=document.createElement("textarea");t.value=n,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{return document.execCommand("copy"),document.body.removeChild(t),!0}catch(n){return document.body.removeChild(t),!1}}catch(n){return!1}}setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",(async n=>{const t=n.reason,e=t?.message||String(t);if(e.includes("Access to storage is not allowed")||e.includes("storage"))return void n.preventDefault();if(e.includes("slice")&&e.includes("undefined"))return void n.preventDefault();const o=`未处理的错误:\n${e}\n\n错误对象: ${String(t)}`;await this.copyToClipboard(o),this.showInfo(o+"\n\n(错误信息已复制到剪贴板)")}))}getManifestUrl(){return`${window.location.origin}/tonconnect-manifest.json`}copy(){l.instance.buttonAudio.play(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(this.addressLabel.string).then((()=>{console.log("链接复制成功: "),this.successFrame.active=!0})).catch((n=>{console.error("复制失败，尝试备用方法: ",n),this.fallbackCopyTextToClipboard()})):this.fallbackCopyTextToClipboard()}fallbackCopyTextToClipboard(){const n=document.createElement("textarea");n.value=this.addressLabel.string,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999);try{document.execCommand("copy")?(console.log("链接复制成功 (备用方法): "),this.successFrame.active=!0):(console.error("备用复制方法失败"),this.failFrame.active=!0)}catch(n){console.error("备用复制方法出错: ",n)}document.body.removeChild(n)}walletHide(){l.instance.buttonAudio.play(),this.walletNode.active=!this.walletNode.active}update(n){this.successFrame&&this.successFrame.active&&(this.successTimer>0?this.successTimer-=n:(this.successFrame.active=!1,this.successTimer=1)),this.failFrame&&this.failFrame.active&&(this.failTimer>0?this.failTimer-=n:(this.failFrame.active=!1,this.failTimer=1))}}).prototype,"connectBtn",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(y.prototype,"disconnectBtn",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(y.prototype,"infoLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(y.prototype,"addressLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(y.prototype,"connectLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(y.prototype,"walletNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(y.prototype,"successFrame",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(y.prototype,"failFrame",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=y))||T));o._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-wallet-ui.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Sound.ts","./telegram-wallet-manager.ts"],(function(t){var e,a,i,s,n,r,o,l,c,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){i=t.cclegacy,s=t.Button,n=t.Label,r=t.Node,o=t._decorator,l=t.Component},function(t){c=t.Sound},function(t){h=t.TelegramWalletManager}],execute:function(){var d,u,g,f,m,w,b,p,y,I,v,C,L,T,W,S,E,F,k;i._RF.push({},"9027dOJcTtJzY/hhpaIgyJE","telegram-wallet-ui",void 0);const{ccclass:A,property:M}=o;t("TelegramWalletUI",(d=A("TelegramWalletUI"),u=M(s),g=M(s),f=M(n),m=M(n),w=M(n),b=M(r),p=M(r),y=M(r),d((C=e((v=class extends l{constructor(){super(...arguments),a(this,"connectBtn",C,this),a(this,"disconnectBtn",L,this),a(this,"infoLabel",T,this),a(this,"addressLabel",W,this),a(this,"connectLabel",S,this),a(this,"walletNode",E,this),a(this,"successFrame",F,this),this.successTimer=1,a(this,"failFrame",k,this),this.failTimer=1,this.manager=null,this.walletChangeCallback=null,this.initStatusCheckInterval=null}start(){this.tryInitManager()}tryInitManager(t){void 0===t&&(t=0);if(this.manager=h.getInstance(),!this.manager)return t<10?void setTimeout((()=>{this.tryInitManager(t+1)}),100):void this.showError("TelegramWalletManager 初始化失败","未找到 TelegramWalletManager 实例",{"重试次数":`${t}/10`,"重试延迟":"100ms","当前场景":"Menu","预期场景":"Entry（应该在 Entry 场景中创建）"},["确保在 Entry 场景中已创建 TelegramWalletManager 组件","检查 Entry 场景是否正确加载","检查 TelegramWalletManager 是否被正确添加到场景节点","刷新页面重试","检查浏览器控制台是否有其他错误信息"]);this.initUI(),this.startInitStatusCheck()}startInitStatusCheck(){this.initStatusCheckInterval&&clearInterval(this.initStatusCheckInterval),this.initStatusCheckInterval=setInterval((()=>{if(this.manager)if(this.manager.isInitialized()){const t=this.manager.getGameFi();if(t){const e=t.wallet,a=!(!e||!e.account);a||this.infoLabel&&!this.infoLabel.string.includes("初始化成功")&&this.showInfo("✅ 初始化成功\n等待连接钱包..."),a&&this.stopInitStatusCheck()}}else this.manager.getIsInitializing()&&this.infoLabel&&!this.infoLabel.string.includes("初始化中")&&this.showInfo("正在初始化中，请稍候...")}),500)}stopInitStatusCheck(){this.initStatusCheckInterval&&(clearInterval(this.initStatusCheckInterval),this.initStatusCheckInterval=null)}initUI(){this.manager&&(this.walletNode&&(this.walletNode.active=!1),this.infoLabel&&(this.infoLabel.node.active=!0,this.manager.isInitialized()?this.showInfo("✅ 初始化成功"):this.showInfo("等待连接钱包...")),this.connectBtn&&this.connectBtn.node.on(s.EventType.CLICK,this.connectWallet,this),this.disconnectBtn&&this.disconnectBtn.node.on(s.EventType.CLICK,this.disconnectWallet,this),this.walletChangeCallback=t=>{this.onWalletStatusChange(t)},this.manager.onWalletChange(this.walletChangeCallback),this.updateUI())}onDestroy(){this.stopInitStatusCheck(),this.manager&&this.walletChangeCallback&&this.manager.offWalletChange(this.walletChangeCallback)}async connectWallet(){if(!this.manager)return void await this.showError("钱包管理器未初始化","TelegramWalletManager 实例不存在",{"操作":"连接钱包","Manager状态":"null"},["确保在 Entry 场景中已创建 TelegramWalletManager","等待 Manager 初始化完成","刷新页面重试"]);const t=this.manager.getGameFi();if(!t)return this.manager.getIsInitializing()?void this.showInfo("正在初始化中，请稍候...\n\n提示: 初始化可能需要一些时间，请稍候再试"):void(this.manager.getInitError()?await this.showError("GameFi SDK 初始化失败",this.manager.getInitError()||"未知错误",{"操作":"连接钱包","初始化状态":"失败","Manager状态":"已创建但 SDK 未初始化"},["检查网络连接是否正常","确认 manifest 文件可访问（tonconnect-manifest.json）","检查 CDN 是否可访问（@tonconnect/ui）","刷新页面重试","检查浏览器控制台的详细错误信息","确认是否在 HTTPS 环境下运行（Telegram Mini App 需要 HTTPS）"]):await this.showError("GameFi SDK 未初始化","SDK 初始化未完成或失败",{"操作":"连接钱包","初始化状态":"未完成","Manager状态":"已创建","是否正在初始化":this.manager.getIsInitializing()?"是":"否"},["等待初始化完成（可能需要几秒钟）","检查网络连接是否正常","检查 CDN 是否可访问","刷新页面重试","检查浏览器控制台是否有错误信息"]));if(t.wallet&&this.walletNode)this.walletNode.active=!0;else try{await t.connectWallet()}catch(e){await this.showError("连接钱包失败",e,{"操作":"connectWallet()","GameFi状态":t?"已初始化":"未初始化","钱包状态":t?.wallet?"已连接":"未连接","钱包地址":t?.walletAddress||"无"},["检查是否在 Telegram 环境中运行","确认钱包应用已安装（如 Tonkeeper）","检查网络连接是否正常","尝试刷新页面后重试","检查浏览器控制台的详细错误信息","确认 manifest 文件配置正确"]),this.updateUI()}}async disconnectWallet(){if(!this.manager)return void await this.showError("钱包管理器未初始化","TelegramWalletManager 实例不存在",{"操作":"断开钱包","Manager状态":"null"},["确保在 Entry 场景中已创建 TelegramWalletManager","刷新页面重试"]);const t=this.manager.getGameFi();if(t)try{await t.disconnectWallet(),this.showInfo("钱包已断开"),this.walletNode&&(this.walletNode.active=!1),this.updateUI()}catch(e){await this.showError("断开钱包失败",e,{"操作":"disconnectWallet()","GameFi状态":t?"已初始化":"未初始化","钱包状态":t?.wallet?"已连接":"未连接","钱包地址":t?.walletAddress||"无"},["检查网络连接是否正常","尝试刷新页面后重试","检查浏览器控制台的详细错误信息","如果问题持续，可以尝试重新连接钱包"])}else await this.showError("GameFi SDK 未初始化","无法断开连接，SDK 未初始化",{"操作":"断开钱包","GameFi状态":"未初始化"},["等待 SDK 初始化完成","刷新页面重试"])}onWalletStatusChange(t){if(t&&t.account){const e=t.account.address,a=`${e.slice(0,6)}...${e.slice(-4)}`;this.showInfo(`✅ 钱包连接成功\n地址: ${a}`)}else this.showInfo("钱包已断开"),this.walletNode&&(this.walletNode.active=!1);this.updateUI()}updateUI(){if(!this.manager)return void(this.infoLabel&&(this.infoLabel.node.active=!0));const t=this.manager.getGameFi();if(!t)return void(this.infoLabel&&(this.infoLabel.node.active=!0,this.manager.isInitialized()?this.showInfo("✅ 初始化成功"):this.manager.getIsInitializing()?this.showInfo("正在初始化中，请稍候..."):this.showInfo("等待初始化...")));if(this.infoLabel&&(!this.infoLabel.string||this.infoLabel.string.includes("等待")||this.infoLabel.string.includes("初始化中"))){const e=t.wallet;!(!e||!e.account)||this.showInfo("✅ 初始化成功\n等待连接钱包...")}const e=t.wallet,a=!(!e||!e.account);if(this.connectBtn&&(this.connectBtn.interactable=!0),this.disconnectBtn&&(this.disconnectBtn.interactable=a),this.addressLabel&&a&&e&&e.account&&e.account.address){const t=e.account.address;t.startsWith("0:")||t.startsWith("-1:")?this.convertToBounceableAddress(t).then((t=>{this.addressLabel&&(this.addressLabel.string=t)})).catch((()=>{this.addressLabel&&(this.addressLabel.string=t)})):this.addressLabel.string=t}if(this.connectLabel)if(a&&e&&e.account&&e.account.address){const t=e.account.address;if(t.startsWith("0:")||t.startsWith("-1:"))this.convertToBounceableAddress(t).then((t=>{if(this.connectLabel){const e=this.getShortAddress(t,4,4);this.connectLabel.string=e}})).catch((e=>{if(console.warn("地址格式转换失败（显示短地址）:",e),this.connectLabel){const e=this.getShortAddress(t,4,4);this.connectLabel.string=e}}));else{const e=this.getShortAddress(t,4,4);this.connectLabel.string=e}}else this.connectLabel.string="connect wallet"}async convertToBounceableAddress(t){try{if(t.startsWith("UQ")||t.startsWith("EQ")||t.startsWith("0Q"))return t;try{const e=`https://tonapi.io/v2/accounts/${t}`,a=await fetch(e);if(a.ok){const e=await a.json();if(e.address){const a=e.address;if(a.startsWith("UQ")||a.startsWith("EQ")||a.startsWith("0Q"))return a;if(e.raw_address){const e=`https://toncenter.com/api/v2/addressInformation?address=${t}`;try{const t=await fetch(e);if(t.ok){const e=await t.json();if(e.result&&e.result.address)return e.result.address}}catch(t){console.warn("备用 API 转换失败:",t)}}}}}catch(t){console.warn("使用 tonapi.io API 转换地址失败:",t)}try{const e=`https://toncenter.com/api/v2/addressInformation?address=${t}`,a=await fetch(e);if(a.ok){const t=await a.json();if(t.result&&t.result.address){const e=t.result.address;if(e.startsWith("UQ")||e.startsWith("EQ")||e.startsWith("0Q"))return e}}}catch(t){console.warn("使用 toncenter.com API 转换地址失败:",t)}return console.warn("地址格式转换失败，返回原地址。建议检查网络连接或使用 TON SDK"),t}catch(e){return console.warn("地址格式转换异常，返回原地址:",e),t}}convertToBounceableAddressSync(t){return t.startsWith("UQ")||t.startsWith("EQ")||t.startsWith("0Q"),t}getShortAddress(t,e,a){if(void 0===e&&(e=4),void 0===a&&(a=4),!t)return"";let i=t;return(t.startsWith("0:")||t.startsWith("-1:"))&&(i=this.convertToBounceableAddressSync(t)),i.length<=e+a?i:`${i.slice(0,e)}...${i.slice(-a)}`}getWalletAddress(){if(!this.manager)return null;const t=this.manager.getGameFi();return t&&t.walletAddress||null}isWalletConnected(){if(!this.manager)return!1;const t=this.manager.getGameFi();return!!t&&!!t.wallet}showInfo(t){this.infoLabel&&(this.infoLabel.string=t,this.infoLabel.node.active=!0)}async showError(t,e,a,i){const s=(new Date).toLocaleString("zh-CN"),n=e instanceof Error?e.message:String(e),r=e instanceof Error?e.stack:void 0;let o=`❌ ${t}\n\n`;if(o+=`时间: ${s}\n`,o+=`错误: ${n}\n`,a){o+="\n上下文信息:\n";for(const t in a)a.hasOwnProperty(t)&&(o+=`  ${t}: ${a[t]}\n`)}r&&(o+=`\n堆栈信息:\n${r}\n`),i&&i.length>0&&(o+="\n建议操作:\n",i.forEach(((t,e)=>{o+=`${e+1}. ${t}\n`}))),this.showInfo(o),await this.copyToClipboard(o)}async copyToClipboard(t){try{return navigator.clipboard&&navigator.clipboard.writeText?(await navigator.clipboard.writeText(t),console.log("错误信息已复制到剪贴板"),!0):this.fallbackCopyToClipboard(t)}catch(e){return console.warn("复制到剪贴板失败，尝试备用方法:",e),this.fallbackCopyToClipboard(t)}}fallbackCopyToClipboard(t){try{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select(),e.setSelectionRange(0,99999);const a=document.execCommand("copy");return document.body.removeChild(e),a?(console.log("错误信息已复制到剪贴板（备用方法）"),!0):(console.warn("备用复制方法失败"),!1)}catch(t){return console.error("备用复制方法出错:",t),!1}}async copy(){if(!this.addressLabel)return void await this.showError("复制地址失败","addressLabel 未设置",{"操作":"复制钱包地址","组件状态":"addressLabel 为 null"},["检查 UI 组件绑定是否正确","确保 addressLabel 已正确添加到场景中","检查组件属性配置"]);c.instance.buttonAudio.play();const t=this.addressLabel.string;if(!t||""===t.trim())return void await this.showError("复制地址失败","钱包地址为空",{"操作":"复制钱包地址","地址值":t||"空字符串"},["确保钱包已连接","检查钱包地址是否正确获取","尝试重新连接钱包"]);await this.copyToClipboard(t)?this.successFrame&&(this.successFrame.active=!0):(await this.showError("复制地址失败","无法复制到剪贴板",{"操作":"复制钱包地址","地址":t,"浏览器支持":navigator.clipboard?"是":"否"},["检查浏览器权限设置","尝试手动复制地址","检查浏览器是否支持剪贴板 API","尝试使用其他浏览器"]),this.failFrame&&(this.failFrame.active=!0))}walletHide(){c.instance.buttonAudio.play(),this.walletNode&&(this.walletNode.active=!this.walletNode.active)}update(t){this.successFrame&&this.successFrame.active&&(this.successTimer>0?this.successTimer-=t:(this.successFrame.active=!1,this.successTimer=1)),this.failFrame&&this.failFrame.active&&(this.failTimer>0?this.failTimer-=t:(this.failFrame.active=!1,this.failTimer=1))}}).prototype,"connectBtn",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(v.prototype,"disconnectBtn",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(v.prototype,"infoLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(v.prototype,"addressLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(v.prototype,"connectLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(v.prototype,"walletNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(v.prototype,"successFrame",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(v.prototype,"failFrame",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=v))||I));i._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-web.ts",["cc"],(function(e){var t,r,n;return{setters:[function(e){t=e.cclegacy,r=e.sys,n=e._decorator}],execute:function(){var s,p;t._RF.push({},"68b65S0LtJOxLvHyVr6pR6d","telegram-web",void 0);const{ccclass:o,property:a}=n,i=new Promise(((e,t)=>{if(r.platform===r.Platform.MOBILE_BROWSER||r.platform===r.Platform.DESKTOP_BROWSER){const r=document.createElement("script");r.src="https://telegram.org/js/telegram-web-app.js",r.async=!0,r.onload=()=>{const t=setInterval((()=>{window.Telegram&&window.Telegram.WebApp&&(e(window.Telegram.WebApp),clearInterval(t))}),100)},r.onerror=()=>t(new Error("Unable to load TelegramWebApp SDK, please check logs.")),document.head.appendChild(r)}}));e("TelegramWebApp",o("TelegramWebApp")(((p=class e{constructor(){this._tgWebAppJS=null}static get Instance(){return e._instance||(e._instance=new e),e._instance}async init(){return this._tgWebAppJS=await i,this._tgWebAppJS?Promise.resolve({success:!0}):Promise.resolve({success:!1})}openTelegramLink(e){this._tgWebAppJS?this._tgWebAppJS.openTelegramLink(e):console.error("telegram web app is not inited!")}share(e,t){const r="https://t.me/share/url?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t||"");this.openTelegramLink(r)}shareToStory(e,t,r,n){if(!this._tgWebAppJS)return void console.error("telegram web app is not inited!");const s={text:t,widget_link:{url:r,name:n}};this._tgWebAppJS.shareToStory(e,s)}getTelegramWebApp(){return this._tgWebAppJS}getTelegramWebAppInitData(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe:(console.error("telegram web app is not inited!"),null)}getTelegramUser(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe.user:(console.error("telegram web app is not inited!"),null)}getTelegramInitData(){return this._tgWebAppJS?this._tgWebAppJS.initData:(console.error("telegram web app is not inited!"),null)}openInvoice(e,t){if(!this._tgWebAppJS)return console.error("telegram web app is not inited!"),null;this._tgWebAppJS.openInvoice(e,t)}alert(e){this._tgWebAppJS.showAlert(e)}})._instance=void 0,s=p))||s);t._RF.pop()}}}));

System.register("chunks:///_virtual/Topup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Sound.ts","./GeneralUI.ts","./TopupContent.ts","./Manager.ts"],(function(t){var e,n,i,o,a,r,s,l,c,u,p,d,b,h,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.initializerDefineProperty},function(t){i=t.cclegacy,o=t.Node,a=t.Prefab,r=t.SpriteFrame,s=t.Label,l=t._decorator,c=t.Component,u=t.director,p=t.instantiate},function(t){d=t.Sound},function(t){b=t.GeneralUI},function(t){h=t.TopupContent},function(t){g=t.Manager}],execute:function(){var f,y,m,T,C,L,v,x,S,D,U,w,I;i._RF.push({},"f990f9wUEBCXoDxjx6fix3M","Topup",void 0);const{ccclass:k,property:M}=l;t("Topup",(f=k("Topup"),y=M(b),m=M(o),T=M(a),C=M([r]),L=M(s),f((S=e((x=class extends c{constructor(){super(...arguments),n(this,"generalUI",S,this),n(this,"contentNode",D,this),n(this,"topupContentPrefab",U,this),n(this,"spriteFrames",w,this),n(this,"resultLabel",I,this)}start(){this.generalUI.updateDisplay(),this.resultLabel&&this.resultLabel.node&&(this.resultLabel.node.active=!1),u.preloadScene("Menu"),this.initTopup()}initTopup(){for(let t=0;t<g.topupBaseData.data.length;t++){let e=p(this.topupContentPrefab),n=g.topupBaseData.data[t],i=e.getComponent(h);i.topup=this,i.identifier=t+1,i.sprite.spriteFrame=this.spriteFrames[t],i.typeLabel.string=n.type;const o=n.quantity.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");i.quantityLabel.string="X"+o,i.priceLabel.string=n.priceUsdt.toString()+" USDT",this.contentNode.addChild(e)}}update(t){}async purchase(t){d.instance.buttonAudio.play();const e=t=>{this.resultLabel&&(this.resultLabel.string=t,this.resultLabel.node&&(this.resultLabel.node.active=t&&t.trim().length>0)),console.log(t)};e("Purchase: "+t.identifier);const n=g.getInstance();if(!n||!n.isWalletConnected())return e("请先连接钱包"),void this.connectWallet();const i=g.topupBaseData.data[t.identifier-1],o=i.priceUsdt;try{const a="UQDiN5m0Yky67vaeKWuMkQoqnz7ksxJcK0IVSCvEtm7cJYh1";e("正在发送交易...");const r={messages:[{address:a,amount:"10000000"}],validUntil:Math.floor(Date.now()/1e3)+300},s=await n.sendTransaction(r);if(s&&s.boc){let r="========== 充值信息 ==========\n";r+="交易已发送成功！\n",r+="收款地址: "+a+"\n",r+="充值金额: "+o+" USDT (测试中发送 0.01 TON)\n",r+="充值套餐ID: "+t.identifier+"\n",r+="充值套餐类型: "+i.type+"\n",r+="用户钱包地址: "+(n.getWalletAddress()||"未知")+"\n",r+="\n正在解析交易哈希...\n",e(r);const l=await n.parseTransactionHash(s.boc);l?(r+="交易哈希: "+l+"\n",r+="交易查看: https://tonscan.org/tx/"+l+"\n"):r+="提示: 交易哈希解析中，可能需要等待几秒钟后查询地址交易历史\n",r+="==============================",e(r)}else e("交易结果异常: "+JSON.stringify(s))}catch(t){e("发送交易失败: "+(t?.toString()||String(t)))}}connectWallet(){g.getInstance().connectWallet()}copyResult(){if(d.instance.buttonAudio.play(),!this.resultLabel||!this.resultLabel.string||!this.resultLabel.string.trim())return;const t=this.resultLabel.string;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then((()=>{console.log("复制成功")})).catch((e=>{console.error("复制失败，尝试备用方法: ",e),this.fallbackCopyTextToClipboard(t)})):this.fallbackCopyTextToClipboard(t)}fallbackCopyTextToClipboard(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);try{document.execCommand("copy")?console.log("复制成功 (备用方法)"):console.error("备用复制方法失败")}catch(t){console.error("备用复制方法出错: ",t)}document.body.removeChild(e)}back(){d.instance.buttonAudio.play(),u.loadScene("Menu")}}).prototype,"generalUI",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(x.prototype,"contentNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(x.prototype,"topupContentPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(x.prototype,"spriteFrames",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),I=e(x.prototype,"resultLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=x))||v));i._RF.pop()}}}));

System.register("chunks:///_virtual/TopupContent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,o,u,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){r=e.cclegacy,n=e.Sprite,o=e.Label,u=e._decorator,l=e.Component}],execute:function(){var p,a,s,c,b,f,h,y,g,L,d;r._RF.push({},"82f307GgONJfbuyuIzvetxY","TopupContent",void 0);const{ccclass:m,property:z}=u;e("TopupContent",(p=m("TopupContent"),a=z(n),s=z(o),c=z(o),b=z(o),p((y=t((h=class extends l{constructor(){super(...arguments),this.topup=null,i(this,"sprite",y,this),i(this,"typeLabel",g,this),i(this,"quantityLabel",L,this),i(this,"priceLabel",d,this),this.identifier=1}purchase(){this.topup.purchase(this)}}).prototype,"sprite",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(h.prototype,"typeLabel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(h.prototype,"quantityLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(h.prototype,"priceLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=h))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/Treasure.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,r,n,o,s;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){r=e.cclegacy,n=e.Node,o=e._decorator,s=e.Component}],execute:function(){var u,a,c,l,p,h,f,b,d;r._RF.push({},"54a53nb4L9BQYyBNw9+8Mf0","Treasure",void 0);const{ccclass:g,property:y}=o;e("Treasure",(u=g("Treasure"),a=y(n),c=y(n),l=y(n),u((f=i((h=class extends s{constructor(){super(...arguments),t(this,"close",f,this),t(this,"opening",b,this),t(this,"opened",d,this),this.openTimer=.45}update(e){this.opening.active&&(this.openTimer>0?this.openTimer-=e:(this.opening.active=!1,this.opened.active=!0))}}).prototype,"close",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(h.prototype,"opening",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=i(h.prototype,"opened",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=h))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/usdt-balance-test.ts",["./rollupPluginModLoBabelHelpers.js","cc","./telegram-wallet-test.ts"],(function(t){var e,a,s,n,l,i,c,r;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){s=t.cclegacy,n=t.Button,l=t.Label,i=t._decorator,c=t.Component},function(t){r=t.TelegramWalletTest}],execute:function(){var o,u,h,b,d,p,f,T,g,w,S;s._RF.push({},"994eaoSvOZDg4bd3hCLH9Aq","usdt-balance-test",void 0);const{ccclass:L,property:B}=i;t("USDTBalanceTest",(o=L("USDTBalanceTest"),u=B(n),h=B(l),b=B(l),d=B(r),o((T=e((f=class extends c{constructor(){super(...arguments),a(this,"checkBalanceBtn",T,this),a(this,"balanceLabel",g,this),a(this,"statusLabel",w,this),a(this,"walletTest",S,this)}async start(){this.checkBalanceBtn&&this.checkBalanceBtn.node.on("click",this.checkBalance,this),this.statusLabel&&(this.statusLabel.string="等待连接..."),this.balanceLabel&&(this.balanceLabel.string="--")}async checkBalance(){if(!this.walletTest)return void this.updateStatus("错误: 未找到 TelegramWalletTest 组件");if(!this.walletTest.isWalletConnected())return this.updateStatus("请先连接钱包"),void(this.balanceLabel&&(this.balanceLabel.string="--"));const t=this.walletTest.getWalletAddress();if(t){this.updateStatus("查询中..."),this.balanceLabel&&(this.balanceLabel.string="查询中...");try{const e=await this.getUSDTBalance(t);null!==e?(this.updateStatus("查询成功"),this.balanceLabel&&(this.balanceLabel.string=`${e} USDT`)):(this.updateStatus("未找到 USDT 余额"),this.balanceLabel&&(this.balanceLabel.string="0 USDT"))}catch(t){const e=t instanceof Error?t.message:String(t);this.updateStatus(`查询失败: ${e}`),this.balanceLabel&&(this.balanceLabel.string="查询失败"),console.error("查询 USDT 余额失败:",t)}}else this.updateStatus("错误: 无法获取钱包地址")}async getUSDTBalance(t){try{const e="EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs",a=`https://tonapi.io/v2/accounts/${t}/jettons`,s=await fetch(a);if(!s.ok)throw new Error(`API 请求失败: ${s.status} ${s.statusText}`);const n=await s.json();if(n.balances&&Array.isArray(n.balances))for(const t of n.balances){const a=t.jetton?.address;if(a){if(a.includes(e)||a.toLowerCase().includes("usdt")||"USDT"===t.jetton?.symbol){const e=t.balance||"0",a=parseFloat(e);return(a/1e6).toFixed(6)}}}return"0"}catch(e){console.error("查询 USDT 余额失败:",e);const a=e instanceof Error?e.message:String(e);try{return await this.getUSDTBalanceFallback(t)}catch(t){throw console.error("备用 API 也失败:",t),new Error(`查询 USDT 余额失败: ${a}`)}}}async getUSDTBalanceFallback(t){const e=`https://toncenter.com/api/v2/getAddressInformation?address=${t}`,a=await fetch(e);if(!a.ok)throw new Error(`备用 API 请求失败: ${a.status}`);await a.json();return console.warn("toncenter.com 不直接支持 Jetton 余额查询，返回 0"),"0"}async checkTONBalance(){if(!this.walletTest||!this.walletTest.isWalletConnected())return void this.updateStatus("请先连接钱包");const t=this.walletTest.getWalletAddress();if(t){this.updateStatus("查询 TON 余额中...");try{const e=`https://tonapi.io/v2/accounts/${t}`,a=await fetch(e);if(!a.ok)throw new Error(`API 请求失败: ${a.status} ${a.statusText}`);const s=(await a.json()).balance||"0",n=parseFloat(s)/1e9;this.updateStatus("查询成功"),this.balanceLabel&&(this.balanceLabel.string=`${n.toFixed(9)} TON`)}catch(t){const e=t instanceof Error?t.message:String(t);this.updateStatus(`查询失败: ${e}`),console.error("查询 TON 余额失败:",t)}}else this.updateStatus("错误: 无法获取钱包地址")}updateStatus(t){this.statusLabel&&(this.statusLabel.string=t),console.log(`[USDT Balance Test] ${t}`)}onDestroy(){this.checkBalanceBtn&&this.checkBalanceBtn.node.off("click",this.checkBalance,this)}}).prototype,"checkBalanceBtn",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=e(f.prototype,"balanceLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(f.prototype,"statusLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(f.prototype,"walletTest",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});